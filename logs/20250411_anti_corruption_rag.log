2025-04-11 10:46:09,135 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 10:46:09,185 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 10:46:09,187 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 10:46:09,188 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 10:46:09,195 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 10:46:09,196 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 10:46:09,197 - src.core.query_system.query_engine - INFO - Initializing QueryEngine with:
2025-04-11 10:46:09,197 - src.core.query_system.query_engine - INFO -   - Embedding Model: intfloat/multilingual-e5-large-instruct
2025-04-11 10:46:09,197 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 10:46:09,197 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 10:46:09,197 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 10:46:09,197 - src.core.query_system.query_engine - INFO -   - Reranking Enabled: True
2025-04-11 10:46:09,198 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.29 GB, VMS: 37.52 GB
2025-04-11 10:46:09,294 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 10:46:09,295 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 10:46:09,416 - src.core.query_system.query_engine - ERROR - Failed to connect or get collections from Qdrant: [Errno 111] Connection refused
2025-04-11 11:37:43,326 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:37:43,360 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 11:37:43,365 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 11:37:43,366 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 11:37:43,373 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 11:37:43,375 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 11:37:43,377 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 11:37:43,378 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:37:43,379 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 11:37:43,380 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:37:43,381 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:37:43,382 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 11:37:43,383 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 11:37:43,384 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.55 GB
2025-04-11 11:37:43,462 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 11:37:43,464 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:37:52,928 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:37:53,023 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 11:37:53,264 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 11:37:54,276 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 11:37:54,278 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 11:37:54,281 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:37:54,282 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:37:54,284 - __main__ - INFO - Data clearing successful.
2025-04-11 11:37:54,344 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 11:37:54,782 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:39:07,194 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:39:11,943 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:39:11,997 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:39:11,999 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 11:39:12,000 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf']
2025-04-11 11:39:12,002 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 11:39:33,076 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 11:39:33,078 - __main__ - INFO - Saved Aphrodite process info: PID=23479
2025-04-11 11:39:33,079 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 11:39:33,080 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=4
2025-04-11 11:39:33,087 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 11:39:33,090 - __main__ - INFO - Loading regular document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:39:33,091 - src.core.document_processing.document_loader - INFO - Loading document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (Type: .pdf)
2025-04-11 11:39:33,092 - src.core.document_processing.document_loader - INFO - Processing with Docling: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:39:33,093 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf...
2025-04-11 11:39:44,953 - src.core.document_processing.document_loader - INFO - Exporting The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf content to Markdown...
2025-04-11 11:39:45,005 - src.core.document_processing.document_loader - INFO - Docling processing successful for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf. Word count: 4135, Page count: 10
2025-04-11 11:39:45,009 - __main__ - INFO - Document loaded: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf, Content items: 1
2025-04-11 11:39:45,011 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 11:39:45,013 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 11:39:45,014 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.23 GB, VMS: 40.20 GB
2025-04-11 11:39:45,015 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 11:39:45,017 - __main__ - INFO - Loading chunking model...
2025-04-11 11:39:45,017 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:39:45,018 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 11:39:45,019 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 11:39:45,021 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 11:39:45,022 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 11:39:50,754 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 11:39:50,756 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 5.73 seconds
2025-04-11 11:39:50,757 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.58 GB, VMS: 41.71 GB
2025-04-11 11:39:50,758 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 11:39:50,759 - __main__ - INFO - Chunking document 1/1: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:39:50,760 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (ID: a85b0305-9955-4c47-b495-ec3a64cc1e74, Type: .pdf)
2025-04-11 11:39:50,761 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf.
2025-04-11 11:39:50,762 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 28181 chars) using Markdown Header + Semantic chunking.
2025-04-11 11:39:50,764 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 7 initial structural chunks.
2025-04-11 11:39:51,175 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 37 potential chunks.
2025-04-11 11:39:51,176 - src.core.document_processing.document_chunker - WARNING - Chunk (length 10037) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 11:39:51,178 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 26 basic chunks.
2025-04-11 11:39:51,179 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 1 oversized chunks.
2025-04-11 11:39:51,181 - src.core.document_processing.document_chunker - INFO - Final processing created 62 chunks from text of length 28181.
2025-04-11 11:39:51,182 - src.core.document_processing.document_chunker - INFO - Chunking for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf completed in 0.42s.
2025-04-11 11:39:51,183 - src.core.document_processing.document_chunker - INFO - Created 62 total chunks: 0 spreadsheet rows, 36 semantic chunks, 0 sentence fallback chunks, 26 basic fallback chunks.
2025-04-11 11:39:51,184 - src.core.document_processing.document_chunker - INFO - Average chunk size: 454.5 characters.
2025-04-11 11:39:51,185 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:39:51,186 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.20 GB, Total: 8.00 GB
2025-04-11 11:39:51,187 - __main__ - INFO - Created 62 chunks for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:39:51,188 - __main__ - INFO - Shutting down chunking model...
2025-04-11 11:39:51,189 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:39:51,190 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 11:39:51,191 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 11:39:51,192 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 11:39:51,197 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 11:39:51,951 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 11:39:51,953 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:39:51,954 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:39:51,955 - __main__ - INFO - Total chunks generated: 62
2025-04-11 11:39:51,956 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:39:51,957 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-3B-Instruct, debug=True, using advanced deduplication.
2025-04-11 11:39:51,958 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:39:51,960 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:39:51,961 - __main__ - INFO - Starting entity extraction on 62 chunks (0 visual chunks)
2025-04-11 11:39:51,962 - src.core.extraction.entity_extractor - INFO - Adding 62 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 11:39:51,963 - src.core.extraction.entity_extractor - INFO - Added 62 chunks to queue. Processing now.
2025-04-11 11:39:51,963 - src.core.extraction.entity_extractor - INFO - Processing all 62 chunks...
2025-04-11 11:39:51,964 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:39:51,966 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:39:51,971 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:41:02,259 - src.core.extraction.entity_extractor - INFO - Model Qwen/Qwen2.5-3B-Instruct loaded successfully for extraction.
2025-04-11 11:41:02,261 - src.core.extraction.entity_extractor - INFO - Processing 62 chunks (0 spreadsheet rows)
2025-04-11 11:41:02,262 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 11:41:02,262 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (62 chunks)
2025-04-11 11:41:02,264 - src.core.extraction.entity_extractor - INFO - Sending batch of 62 prompts to service
2025-04-11 11:41:26,653 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 11:41:26,654 - src.core.extraction.entity_extractor - INFO - Service request/response took 24.39s
2025-04-11 11:41:26,659 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.00s. Total batch time: 24.40s
2025-04-11 11:41:26,660 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=62, Parse Errors=0, Missing Outputs=0
2025-04-11 11:41:26,661 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 24.40s
2025-04-11 11:41:26,662 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 11:41:26,663 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 116 entities, 44 relationships.
2025-04-11 11:41:26,664 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 11:41:26,664 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 116 raw entities...
2025-04-11 11:41:26,682 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 11:41:26,691 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 11:41:26,827 - src.core.extraction.entity_extractor - INFO - Generated 494 candidate pairs across all types.
2025-04-11 11:41:26,828 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 11:41:26,901 - src.core.extraction.entity_extractor - INFO - Found 123 potential duplicate pairs after comparison.
2025-04-11 11:41:26,903 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 11:41:26,905 - src.core.extraction.entity_extractor - INFO - Found 67 clusters (including singletons).
2025-04-11 11:41:26,906 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 11:41:26,912 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 67.
2025-04-11 11:41:26,913 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 11:41:26,914 - src.core.extraction.entity_extractor - INFO - Updating 44 raw relationships with canonical entity IDs...
2025-04-11 11:41:26,915 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 43, Updated IDs in 31, Skipped 1 (self-loops or missing mappings).
2025-04-11 11:41:26,916 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 11:41:26,917 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 11:41:26,918 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 3 duplicates. Final count: 40.
2025-04-11 11:41:26,918 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 67 entities, 40 relationships.
2025-04-11 11:41:26,939 - src.core.extraction.entity_extractor - INFO - Saved 67 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:41:26,941 - src.core.extraction.entity_extractor - INFO - Saved 40 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:41:26,942 - __main__ - INFO - Entity extraction complete. Modified chunks: 62
2025-04-11 11:41:27,022 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:41:27,025 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 11:41:27,026 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:41:27,027 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:41:27,027 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 11:41:27,028 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 11:41:27,029 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.61 GB, VMS: 41.71 GB
2025-04-11 11:41:27,030 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:41:27,032 - __main__ - INFO - Loading indexing model...
2025-04-11 11:41:27,033 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 11:41:27,034 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 11:42:03,203 - src.core.indexing.document_indexer - ERROR - Error loading embedding model BAAI/bge-m3: An error occurred while downloading using `hf_transfer`. Consider disabling HF_HUB_ENABLE_HF_TRANSFER for better error handling.
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 428, in http_get
    hf_transfer.download(
Exception: Failed too many failures in parallel (3): Request: error sending request for url (https://cdn-lfs-us-1.hf.co/repos/23/2c/232ca60237b0bb19bb6c28c5a6c8af79f2e423333a9626aad445543b80fbf31e/1eebfb28493f67bba03ce0ef64bfdc7fc5a3bd9d7493f818bb1d78cd798416b4?response-content-disposition=inline%3B+filename*%3DUTF-8%27%27model.onnx_data%3B+filename%3D%22model.onnx_data%22%3B&Expires=1744371691&Policy=eyJTdGF0ZW1lbnQiOlt7IkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTc0NDM3MTY5MX19LCJSZXNvdXJjZSI6Imh0dHBzOi8vY2RuLWxmcy11cy0xLmhmLmNvL3JlcG9zLzIzLzJjLzIzMmNhNjAyMzdiMGJiMTliYjZjMjhjNWE2YzhhZjc5ZjJlNDIzMzMzYTk2MjZhYWQ0NDU1NDNiODBmYmYzMWUvMWVlYmZiMjg0OTNmNjdiYmEwM2NlMGVmNjRiZmRjN2ZjNWEzYmQ5ZDc0OTNmODE4YmIxZDc4Y2Q3OTg0MTZiND9yZXNwb25zZS1jb250ZW50LWRpc3Bvc2l0aW9uPSoifV19&Signature=tmJndeAYF1HnTmpoepKUrM7VaB1G5aVidKOAXqcVueTYsZAYBvV-LqwlXrhShH-6OnefEPvwi9KlCY4s0SNGvnzzlLlkSsuwpJwgr00q%7EZIm83vM4bU6mAuuFI%7EQRSGIS5LiKm1RWAJWCFVjOPfRDriLzcyWfSrNOOuL78MzM1c%7EaKHSThMRGCGWduks9Ww3Lm9D03zbsdHFT3XjLOQGXIMQKXTRn9MyWUxnoija56ZYLPMCFON825JJDyw4KGJPOmJNzsr3lnSA3Q2E6BLZ0R55pjzrWoAGTjBVXhOiNP81Zbnm5kaLVPuJ3Wt5jyU341wYx5zABH-zacdNx-fCPg__&Key-Pair-Id=K24J24Z295AEI9) (no permits available)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/indexing/document_indexer.py", line 207, in load_model
    self.embedding_model_instance = BGEM3FlagModel(
                                    ^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/FlagEmbedding/inference/embedder/encoder_only/m3.py", line 95, in __init__
    EncoderOnlyEmbedderM3Runner.get_model(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/FlagEmbedding/finetune/embedder/encoder_only/m3/runner.py", line 63, in get_model
    model_name_or_path = snapshot_download(
                         ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/_snapshot_download.py", line 294, in snapshot_download
    _inner_hf_hub_download(file)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/_snapshot_download.py", line 270, in _inner_hf_hub_download
    return hf_hub_download(
           ^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 862, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1011, in _hf_hub_download_to_cache_dir
    _download_to_tmp_and_move(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1547, in _download_to_tmp_and_move
    http_get(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 439, in http_get
    raise RuntimeError(
RuntimeError: An error occurred while downloading using `hf_transfer`. Consider disabling HF_HUB_ENABLE_HF_TRANSFER for better error handling.
2025-04-11 11:42:03,242 - __main__ - ERROR - Fatal error processing documents: An error occurred while downloading using `hf_transfer`. Consider disabling HF_HUB_ENABLE_HF_TRANSFER for better error handling.
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 428, in http_get
    hf_transfer.download(
Exception: Failed too many failures in parallel (3): Request: error sending request for url (https://cdn-lfs-us-1.hf.co/repos/23/2c/232ca60237b0bb19bb6c28c5a6c8af79f2e423333a9626aad445543b80fbf31e/1eebfb28493f67bba03ce0ef64bfdc7fc5a3bd9d7493f818bb1d78cd798416b4?response-content-disposition=inline%3B+filename*%3DUTF-8%27%27model.onnx_data%3B+filename%3D%22model.onnx_data%22%3B&Expires=1744371691&Policy=eyJTdGF0ZW1lbnQiOlt7IkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTc0NDM3MTY5MX19LCJSZXNvdXJjZSI6Imh0dHBzOi8vY2RuLWxmcy11cy0xLmhmLmNvL3JlcG9zLzIzLzJjLzIzMmNhNjAyMzdiMGJiMTliYjZjMjhjNWE2YzhhZjc5ZjJlNDIzMzMzYTk2MjZhYWQ0NDU1NDNiODBmYmYzMWUvMWVlYmZiMjg0OTNmNjdiYmEwM2NlMGVmNjRiZmRjN2ZjNWEzYmQ5ZDc0OTNmODE4YmIxZDc4Y2Q3OTg0MTZiND9yZXNwb25zZS1jb250ZW50LWRpc3Bvc2l0aW9uPSoifV19&Signature=tmJndeAYF1HnTmpoepKUrM7VaB1G5aVidKOAXqcVueTYsZAYBvV-LqwlXrhShH-6OnefEPvwi9KlCY4s0SNGvnzzlLlkSsuwpJwgr00q%7EZIm83vM4bU6mAuuFI%7EQRSGIS5LiKm1RWAJWCFVjOPfRDriLzcyWfSrNOOuL78MzM1c%7EaKHSThMRGCGWduks9Ww3Lm9D03zbsdHFT3XjLOQGXIMQKXTRn9MyWUxnoija56ZYLPMCFON825JJDyw4KGJPOmJNzsr3lnSA3Q2E6BLZ0R55pjzrWoAGTjBVXhOiNP81Zbnm5kaLVPuJ3Wt5jyU341wYx5zABH-zacdNx-fCPg__&Key-Pair-Id=K24J24Z295AEI9) (no permits available)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/ui/app.py", line 787, in process_documents_with_spreadsheet_options
    document_indexer.load_model()
  File "/home/t/lm_rag/src/core/indexing/document_indexer.py", line 207, in load_model
    self.embedding_model_instance = BGEM3FlagModel(
                                    ^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/FlagEmbedding/inference/embedder/encoder_only/m3.py", line 95, in __init__
    EncoderOnlyEmbedderM3Runner.get_model(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/FlagEmbedding/finetune/embedder/encoder_only/m3/runner.py", line 63, in get_model
    model_name_or_path = snapshot_download(
                         ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/_snapshot_download.py", line 294, in snapshot_download
    _inner_hf_hub_download(file)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/_snapshot_download.py", line 270, in _inner_hf_hub_download
    return hf_hub_download(
           ^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 862, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1011, in _hf_hub_download_to_cache_dir
    _download_to_tmp_and_move(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1547, in _download_to_tmp_and_move
    http_get(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 439, in http_get
    raise RuntimeError(
RuntimeError: An error occurred while downloading using `hf_transfer`. Consider disabling HF_HUB_ENABLE_HF_TRANSFER for better error handling.
2025-04-11 11:42:03,874 - __main__ - INFO - Document processing call completed
2025-04-11 11:42:32,908 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:42:33,470 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 11:42:33,473 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 11:42:33,627 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 11:42:33,686 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 11:42:33,689 - __main__ - INFO - Loaded 67 entities and 40 relationships.
2025-04-11 11:42:34,407 - __main__ - INFO - Building NetworkX graphs for analysis...
2025-04-11 11:42:34,409 - __main__ - INFO - Created entity lookup with 67 valid entities.
2025-04-11 11:42:34,410 - __main__ - INFO - Analysis graphs built: Directed (67 nodes, 40 edges), Undirected (67 nodes, 38 edges). Skipped 0 edges.
2025-04-11 11:42:34,416 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 11:42:45,199 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:42:45,332 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 11:42:45,477 - src.core.query_system.query_engine - WARNING - Qdrant collection 'anticorruption_rag_e5_instruct' does not exist, skipping deletion.
2025-04-11 11:42:45,479 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:42:45,480 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:42:45,481 - __main__ - INFO - Data clearing successful.
2025-04-11 11:42:45,537 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 11:42:45,538 - __main__ - INFO - Aphrodite service remains running after data clear.
2025-04-11 11:42:45,998 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:42:46,204 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 11:42:46,207 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 11:42:46,262 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 11:43:35,576 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:43:40,878 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:43:42,470 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:43:42,533 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:43:42,535 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 11:43:42,537 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf']
2025-04-11 11:43:42,539 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 11:43:42,540 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=4
2025-04-11 11:43:42,545 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 11:43:42,547 - __main__ - INFO - Loading regular document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:43:42,549 - src.core.document_processing.document_loader - INFO - Loading document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (Type: .pdf)
2025-04-11 11:43:42,551 - src.core.document_processing.document_loader - INFO - Processing with Docling: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:43:42,553 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf...
2025-04-11 11:43:56,779 - src.core.document_processing.document_loader - INFO - Exporting The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf content to Markdown...
2025-04-11 11:43:56,810 - src.core.document_processing.document_loader - INFO - Docling processing successful for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf. Word count: 4135, Page count: 10
2025-04-11 11:43:56,813 - __main__ - INFO - Document loaded: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf, Content items: 1
2025-04-11 11:43:56,814 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 11:43:56,815 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 11:43:56,817 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.96 GB, VMS: 47.87 GB
2025-04-11 11:43:56,818 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:43:56,819 - __main__ - INFO - Loading chunking model...
2025-04-11 11:43:56,819 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:43:56,820 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 11:43:56,821 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 11:43:56,822 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 11:43:56,823 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 11:44:01,144 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 11:44:01,145 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.32 seconds
2025-04-11 11:44:01,147 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 3.04 GB, VMS: 48.00 GB
2025-04-11 11:44:01,148 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:44:01,149 - __main__ - INFO - Chunking document 1/1: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:44:01,150 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (ID: 07d9afce-008a-4c3f-b9c4-1dbe0cee4992, Type: .pdf)
2025-04-11 11:44:01,151 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf.
2025-04-11 11:44:01,152 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 28181 chars) using Markdown Header + Semantic chunking.
2025-04-11 11:44:01,153 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 7 initial structural chunks.
2025-04-11 11:44:01,825 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 37 potential chunks.
2025-04-11 11:44:01,826 - src.core.document_processing.document_chunker - WARNING - Chunk (length 10037) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 11:44:01,828 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 26 basic chunks.
2025-04-11 11:44:01,829 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 1 oversized chunks.
2025-04-11 11:44:01,830 - src.core.document_processing.document_chunker - INFO - Final processing created 62 chunks from text of length 28181.
2025-04-11 11:44:01,832 - src.core.document_processing.document_chunker - INFO - Chunking for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf completed in 0.68s.
2025-04-11 11:44:01,833 - src.core.document_processing.document_chunker - INFO - Created 62 total chunks: 0 spreadsheet rows, 36 semantic chunks, 0 sentence fallback chunks, 26 basic fallback chunks.
2025-04-11 11:44:01,834 - src.core.document_processing.document_chunker - INFO - Average chunk size: 454.5 characters.
2025-04-11 11:44:01,835 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 3.04 GB, VMS: 48.00 GB
2025-04-11 11:44:01,837 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.08 GB, Total: 8.00 GB
2025-04-11 11:44:01,838 - __main__ - INFO - Created 62 chunks for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:44:01,839 - __main__ - INFO - Shutting down chunking model...
2025-04-11 11:44:01,840 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:44:01,841 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 11:44:01,842 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 11:44:01,843 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 11:44:01,847 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 11:44:02,709 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 11:44:02,712 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 3.04 GB, VMS: 47.99 GB
2025-04-11 11:44:02,714 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:44:02,715 - __main__ - INFO - Total chunks generated: 62
2025-04-11 11:44:02,718 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:44:02,720 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-3B-Instruct, debug=True, using advanced deduplication.
2025-04-11 11:44:02,722 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 3.04 GB, VMS: 47.99 GB
2025-04-11 11:44:02,725 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:44:02,727 - __main__ - INFO - Starting entity extraction on 62 chunks (0 visual chunks)
2025-04-11 11:44:02,729 - src.core.extraction.entity_extractor - INFO - Adding 62 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 11:44:02,731 - src.core.extraction.entity_extractor - INFO - Added 62 chunks to queue. Processing now.
2025-04-11 11:44:02,733 - src.core.extraction.entity_extractor - INFO - Processing all 62 chunks...
2025-04-11 11:44:02,736 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 3.04 GB, VMS: 47.99 GB
2025-04-11 11:44:02,738 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:44:02,742 - src.core.extraction.entity_extractor - INFO - Extraction model Qwen/Qwen2.5-3B-Instruct already loaded.
2025-04-11 11:44:02,744 - src.core.extraction.entity_extractor - INFO - Processing 62 chunks (0 spreadsheet rows)
2025-04-11 11:44:02,745 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 11:44:02,746 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (62 chunks)
2025-04-11 11:44:02,749 - src.core.extraction.entity_extractor - INFO - Sending batch of 62 prompts to service
2025-04-11 11:45:04,710 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 11:45:04,711 - src.core.extraction.entity_extractor - INFO - Service request/response took 61.96s
2025-04-11 11:45:04,713 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 1e73bc1b-931b-49fc-a2d4-3baf5906bc06: Unterminated string starting at: line 1 column 8374 (char 8373). Content: '{ "entity_relationship_list": [ { "from_entity_type": "LOCATION", "from_entity_name": "Jalan Sudirma...'
2025-04-11 11:45:04,714 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk cece0c4e-7b78-40e7-a0b9-35a745c51029: Unterminated string starting at: line 1 column 8422 (char 8421). Content: '{ "entity_relationship_list": [ { "from_entity_type": "COMMERCIAL_COMPANY", "from_entity_name": "Ind...'
2025-04-11 11:45:04,716 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.00s. Total batch time: 61.97s
2025-04-11 11:45:04,717 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=60, Parse Errors=2, Missing Outputs=0
2025-04-11 11:45:04,718 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 61.97s
2025-04-11 11:45:04,719 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 11:45:04,720 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 72 entities, 30 relationships.
2025-04-11 11:45:04,720 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 11:45:04,721 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 72 raw entities...
2025-04-11 11:45:04,723 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 11:45:04,727 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 11:45:04,848 - src.core.extraction.entity_extractor - INFO - Generated 314 candidate pairs across all types.
2025-04-11 11:45:04,849 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 11:45:04,889 - src.core.extraction.entity_extractor - INFO - Found 64 potential duplicate pairs after comparison.
2025-04-11 11:45:04,891 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 11:45:04,892 - src.core.extraction.entity_extractor - INFO - Found 44 clusters (including singletons).
2025-04-11 11:45:04,893 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 11:45:04,896 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 44.
2025-04-11 11:45:04,897 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 11:45:04,898 - src.core.extraction.entity_extractor - INFO - Updating 30 raw relationships with canonical entity IDs...
2025-04-11 11:45:04,899 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 30, Updated IDs in 24, Skipped 0 (self-loops or missing mappings).
2025-04-11 11:45:04,900 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 11:45:04,901 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 11:45:04,902 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 0 duplicates. Final count: 30.
2025-04-11 11:45:04,902 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 44 entities, 30 relationships.
2025-04-11 11:45:04,904 - src.core.extraction.entity_extractor - INFO - Saved 44 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:45:04,906 - src.core.extraction.entity_extractor - INFO - Saved 30 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:45:04,907 - __main__ - INFO - Entity extraction complete. Modified chunks: 62
2025-04-11 11:45:04,986 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:45:04,988 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 11:45:04,989 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:45:04,990 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:45:04,991 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 11:45:04,992 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 11:45:04,993 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 3.04 GB, VMS: 47.99 GB
2025-04-11 11:45:04,994 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:45:04,995 - __main__ - INFO - Loading indexing model...
2025-04-11 11:45:04,995 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 11:45:04,996 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 11:46:11,870 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 11:46:11,872 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 66.88 seconds
2025-04-11 11:46:11,881 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.69 GB, VMS: 51.58 GB
2025-04-11 11:46:11,883 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:46:12,047 - __main__ - INFO - Indexing 62 chunks
2025-04-11 11:46:12,048 - src.core.indexing.document_indexer - INFO - Starting indexing process for 62 chunks...
2025-04-11 11:46:12,049 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 11:46:12,050 - src.core.indexing.document_indexer - INFO - Indexing 62 chunks to BM25
2025-04-11 11:46:12,086 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 11:46:12,161 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 11:46:12,164 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 11:46:12,174 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (62 documents).
2025-04-11 11:46:12,175 - src.core.indexing.document_indexer - INFO - Indexing 62 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 11:46:12,229 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 11:46:13,737 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 11:46:13,738 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 11:46:13,739 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 62 texts (dense, sparse, colbert)...
2025-04-11 11:46:29,085 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 11:46:29,095 - src.core.indexing.document_indexer - INFO - Embeddings generated in 15.36s
2025-04-11 11:46:29,096 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 11:46:29,995 - src.core.indexing.document_indexer - INFO - Upserting 62 points to Qdrant in 1 batches...
2025-04-11 11:47:04,951 - src.core.indexing.document_indexer - ERROR - Error upserting batch 1: timed out
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 103, in handle_request
    return self._connection.handle_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 136, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 88, in handle_request
    self._send_request_body(**kwargs)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 159, in _send_request_body
    self._send_event(event, timeout=timeout)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 166, in _send_event
    self._network_stream.write(bytes_to_send, timeout=timeout)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 135, in write
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.WriteTimeout: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.WriteTimeout: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/indexing/document_indexer.py", line 503, in _index_to_qdrant
    client.upsert(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 1567, in upsert
    return self._client.upsert(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 1908, in upsert
    http_result = self.openapi_client.points_api.upsert_points(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/points_api.py", line 987, in upsert_points
    return self._build_for_upsert_points(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/points_api.py", line 512, in _build_for_upsert_points
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: timed out
2025-04-11 11:47:05,013 - src.core.indexing.document_indexer - INFO - Finished upserting points to Qdrant collection 'anticorruption_rag_e5_instruct'.
2025-04-11 11:47:05,015 - src.core.indexing.document_indexer - INFO - Indexing completed successfully for 62 chunks (Qdrant and BM25)
2025-04-11 11:47:05,016 - src.core.indexing.document_indexer - INFO - ===== STARTING EMBEDDING MODEL UNLOAD =====
2025-04-11 11:47:05,018 - src.core.indexing.document_indexer - INFO - Attempting to unload BGE-M3 (FlagEmbedding) model components...
2025-04-11 11:47:06,190 - src.core.indexing.document_indexer - INFO - Deleted BGE-M3 model and tokenizer references.
2025-04-11 11:47:07,171 - src.core.indexing.document_indexer - INFO - Clearing CUDA cache...
2025-04-11 11:47:07,200 - src.core.indexing.document_indexer - INFO - Running garbage collection...
2025-04-11 11:47:07,672 - src.core.indexing.document_indexer - INFO - ===== EMBEDDING MODEL UNLOAD COMPLETE =====
2025-04-11 11:47:07,684 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 3.04 GB, VMS: 49.47 GB
2025-04-11 11:47:07,698 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.48 GB, Total: 8.00 GB
2025-04-11 11:47:07,917 - __main__ - INFO - Document processing completed successfully!
2025-04-11 11:47:07,920 - __main__ - INFO - Document processing call completed
2025-04-11 11:47:52,753 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:47:52,987 - src.utils.deepseek_manager - INFO - DeepSeek manager initialized with model: deepseek-reasoner
2025-04-11 11:47:53,920 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:47:54,263 - src.core.query_system.query_engine - INFO - No points found matching filter: text='None', doc='None'
2025-04-11 11:47:54,265 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 11:47:54,405 - src.core.query_system.query_engine - INFO - No points found matching filter: text='None', doc='None'
2025-04-11 11:47:54,725 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 11:48:04,477 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:48:04,549 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 11:48:04,749 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 11:48:05,750 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 11:48:05,752 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 11:48:05,754 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:48:05,756 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:48:05,758 - __main__ - INFO - Data clearing successful.
2025-04-11 11:48:05,818 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 11:48:05,820 - __main__ - INFO - Aphrodite service remains running after data clear.
2025-04-11 11:48:06,492 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:48:06,731 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 11:48:06,733 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 11:48:06,798 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 11:51:39,742 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:51:39,777 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 11:51:39,782 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 11:51:39,783 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 11:51:39,794 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 11:51:39,797 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 11:51:39,798 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 11:51:39,799 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:51:39,800 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 11:51:39,801 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:51:39,802 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:51:39,803 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 11:51:39,804 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 11:51:39,805 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 11:51:39,892 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 11:51:39,894 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:51:54,571 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:51:56,148 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:51:56,208 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:51:56,210 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 11:51:56,212 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf']
2025-04-11 11:51:56,215 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 11:52:10,442 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 11:52:10,442 - __main__ - INFO - Saved Aphrodite process info: PID=34491
2025-04-11 11:52:10,443 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 11:52:10,444 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 11:52:10,473 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 11:52:10,475 - __main__ - INFO - Loading regular document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:52:10,476 - src.core.document_processing.document_loader - INFO - Loading document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (Type: .pdf)
2025-04-11 11:52:10,477 - src.core.document_processing.document_loader - INFO - Processing with Docling: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:52:10,478 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf...
2025-04-11 11:52:21,156 - src.core.document_processing.document_loader - INFO - Exporting The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf content to Markdown...
2025-04-11 11:52:21,200 - src.core.document_processing.document_loader - INFO - Docling processing successful for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf. Word count: 4135, Page count: 10
2025-04-11 11:52:21,204 - __main__ - INFO - Document loaded: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf, Content items: 1
2025-04-11 11:52:21,205 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 11:52:21,206 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 11:52:21,207 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.23 GB, VMS: 40.19 GB
2025-04-11 11:52:21,208 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 11:52:21,209 - __main__ - INFO - Loading chunking model...
2025-04-11 11:52:21,210 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:52:21,211 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 11:52:21,212 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 11:52:21,212 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 11:52:21,213 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 11:52:26,025 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 11:52:26,026 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.81 seconds
2025-04-11 11:52:26,027 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.58 GB, VMS: 41.71 GB
2025-04-11 11:52:26,028 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 11:52:26,029 - __main__ - INFO - Chunking document 1/1: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:52:26,030 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (ID: cbaf8809-8b5d-4740-ae4b-4eec847e00ab, Type: .pdf)
2025-04-11 11:52:26,031 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf.
2025-04-11 11:52:26,032 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 28181 chars) using Markdown Header + Semantic chunking.
2025-04-11 11:52:26,034 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 7 initial structural chunks.
2025-04-11 11:52:26,418 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 37 potential chunks.
2025-04-11 11:52:26,419 - src.core.document_processing.document_chunker - WARNING - Chunk (length 10037) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 11:52:26,421 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 26 basic chunks.
2025-04-11 11:52:26,422 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 1 oversized chunks.
2025-04-11 11:52:26,424 - src.core.document_processing.document_chunker - INFO - Final processing created 62 chunks from text of length 28181.
2025-04-11 11:52:26,425 - src.core.document_processing.document_chunker - INFO - Chunking for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf completed in 0.40s.
2025-04-11 11:52:26,426 - src.core.document_processing.document_chunker - INFO - Created 62 total chunks: 0 spreadsheet rows, 36 semantic chunks, 0 sentence fallback chunks, 26 basic fallback chunks.
2025-04-11 11:52:26,427 - src.core.document_processing.document_chunker - INFO - Average chunk size: 454.5 characters.
2025-04-11 11:52:26,428 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:52:26,429 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.20 GB, Total: 8.00 GB
2025-04-11 11:52:26,430 - __main__ - INFO - Created 62 chunks for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:52:26,431 - __main__ - INFO - Shutting down chunking model...
2025-04-11 11:52:26,432 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:52:26,433 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 11:52:26,434 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 11:52:26,435 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 11:52:26,440 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 11:52:27,038 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 11:52:27,040 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:52:27,042 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:52:27,043 - __main__ - INFO - Total chunks generated: 62
2025-04-11 11:52:27,044 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:52:27,045 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-3B-Instruct, debug=True, using advanced deduplication.
2025-04-11 11:52:27,046 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:52:27,047 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:52:27,048 - __main__ - INFO - Starting entity extraction on 62 chunks (0 visual chunks)
2025-04-11 11:52:27,049 - src.core.extraction.entity_extractor - INFO - Adding 62 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 11:52:27,050 - src.core.extraction.entity_extractor - INFO - Added 62 chunks to queue. Processing now.
2025-04-11 11:52:27,051 - src.core.extraction.entity_extractor - INFO - Processing all 62 chunks...
2025-04-11 11:52:27,051 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:52:27,053 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:52:27,054 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:53:40,575 - src.core.extraction.entity_extractor - INFO - Model Qwen/Qwen2.5-3B-Instruct loaded successfully for extraction.
2025-04-11 11:53:40,577 - src.core.extraction.entity_extractor - INFO - Processing 62 chunks (0 spreadsheet rows)
2025-04-11 11:53:40,578 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 11:53:40,579 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (62 chunks)
2025-04-11 11:53:40,581 - src.core.extraction.entity_extractor - INFO - Sending batch of 62 prompts to service
2025-04-11 11:54:06,884 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 11:54:06,885 - src.core.extraction.entity_extractor - INFO - Service request/response took 26.30s
2025-04-11 11:54:06,888 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.00s. Total batch time: 26.31s
2025-04-11 11:54:06,889 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=62, Parse Errors=0, Missing Outputs=0
2025-04-11 11:54:06,890 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 26.31s
2025-04-11 11:54:06,891 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 11:54:06,892 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 116 entities, 44 relationships.
2025-04-11 11:54:06,893 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 11:54:06,894 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 116 raw entities...
2025-04-11 11:54:06,904 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 11:54:06,913 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 11:54:07,023 - src.core.extraction.entity_extractor - INFO - Generated 494 candidate pairs across all types.
2025-04-11 11:54:07,025 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 11:54:07,099 - src.core.extraction.entity_extractor - INFO - Found 123 potential duplicate pairs after comparison.
2025-04-11 11:54:07,100 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 11:54:07,102 - src.core.extraction.entity_extractor - INFO - Found 67 clusters (including singletons).
2025-04-11 11:54:07,103 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 11:54:07,108 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 67.
2025-04-11 11:54:07,109 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 11:54:07,110 - src.core.extraction.entity_extractor - INFO - Updating 44 raw relationships with canonical entity IDs...
2025-04-11 11:54:07,111 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 43, Updated IDs in 34, Skipped 1 (self-loops or missing mappings).
2025-04-11 11:54:07,112 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 11:54:07,113 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 11:54:07,114 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 3 duplicates. Final count: 40.
2025-04-11 11:54:07,115 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 67 entities, 40 relationships.
2025-04-11 11:54:07,117 - src.core.extraction.entity_extractor - INFO - Saved 67 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:54:07,118 - src.core.extraction.entity_extractor - INFO - Saved 40 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:54:07,119 - __main__ - INFO - Entity extraction complete. Modified chunks: 62
2025-04-11 11:54:07,220 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:54:07,222 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 11:54:07,223 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:54:07,224 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:54:07,225 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 11:54:07,226 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 11:54:07,227 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.59 GB, VMS: 41.71 GB
2025-04-11 11:54:07,228 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:54:07,229 - __main__ - INFO - Loading indexing model...
2025-04-11 11:54:07,230 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 11:54:07,231 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 11:54:08,596 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 11:54:08,597 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.37 seconds
2025-04-11 11:54:08,598 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.61 GB, VMS: 43.83 GB
2025-04-11 11:54:08,599 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:54:08,658 - __main__ - INFO - Indexing 62 chunks
2025-04-11 11:54:08,659 - src.core.indexing.document_indexer - INFO - Starting indexing process for 62 chunks...
2025-04-11 11:54:08,659 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 11:54:08,660 - src.core.indexing.document_indexer - INFO - Indexing 62 chunks to BM25
2025-04-11 11:54:08,674 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 11:54:08,726 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 11:54:08,728 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 11:54:08,736 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (62 documents).
2025-04-11 11:54:08,737 - src.core.indexing.document_indexer - INFO - Indexing 62 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 11:54:08,805 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 11:54:09,203 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 11:54:09,204 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 11:54:09,205 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 62 texts (dense, sparse, colbert)...
2025-04-11 11:54:18,074 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 11:54:18,078 - src.core.indexing.document_indexer - INFO - Embeddings generated in 8.87s
2025-04-11 11:54:18,079 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 11:54:18,747 - src.core.indexing.document_indexer - INFO - Upserting 62 points to Qdrant in 2 batches...
2025-04-11 11:55:44,306 - src.core.indexing.document_indexer - ERROR - Error upserting batch 1: timed out
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 103, in handle_request
    return self._connection.handle_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 136, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 88, in handle_request
    self._send_request_body(**kwargs)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 159, in _send_request_body
    self._send_event(event, timeout=timeout)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/http11.py", line 166, in _send_event
    self._network_stream.write(bytes_to_send, timeout=timeout)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 135, in write
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.WriteTimeout: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.WriteTimeout: timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/indexing/document_indexer.py", line 503, in _index_to_qdrant
    client.upsert(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 1567, in upsert
    return self._client.upsert(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 1908, in upsert
    http_result = self.openapi_client.points_api.upsert_points(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/points_api.py", line 987, in upsert_points
    return self._build_for_upsert_points(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/points_api.py", line 512, in _build_for_upsert_points
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: timed out
2025-04-11 11:56:40,425 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:56:40,426 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:56:40,425 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:56:40,426 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:56:40,462 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 11:56:40,463 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 11:56:40,462 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 11:56:40,463 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 11:56:40,482 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 11:56:40,482 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 11:56:40,483 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 11:56:40,484 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 11:56:40,497 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 11:56:40,497 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 11:56:40,500 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 11:56:40,501 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 11:56:40,500 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 11:56:40,501 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 11:56:40,503 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 11:56:40,504 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 11:56:40,505 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:56:40,506 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:56:40,507 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 11:56:40,508 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 11:56:40,509 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:56:40,510 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:56:40,511 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:56:40,513 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:56:40,514 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 11:56:40,515 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 11:56:40,516 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 11:56:40,517 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 11:56:40,520 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.62 GB
2025-04-11 11:56:40,535 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.62 GB
2025-04-11 11:56:40,623 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 11:56:40,624 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 11:56:40,626 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:56:40,627 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:56:40,626 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:56:40,627 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:57:09,374 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:57:11,153 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 11:57:11,228 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:57:11,230 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 11:57:11,232 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf']
2025-04-11 11:57:11,234 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 11:57:25,419 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 11:57:25,420 - __main__ - INFO - Saved Aphrodite process info: PID=44138
2025-04-11 11:57:25,422 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 11:57:25,423 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 11:57:25,428 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 11:57:25,431 - __main__ - INFO - Loading regular document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:57:25,432 - src.core.document_processing.document_loader - INFO - Loading document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (Type: .pdf)
2025-04-11 11:57:25,433 - src.core.document_processing.document_loader - INFO - Processing with Docling: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:57:25,434 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf...
2025-04-11 11:57:39,770 - src.core.document_processing.document_loader - INFO - Exporting The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf content to Markdown...
2025-04-11 11:57:39,833 - src.core.document_processing.document_loader - INFO - Docling processing successful for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf. Word count: 4135, Page count: 10
2025-04-11 11:57:39,836 - __main__ - INFO - Document loaded: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf, Content items: 1
2025-04-11 11:57:39,838 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 11:57:39,840 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 11:57:39,842 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.24 GB, VMS: 40.20 GB
2025-04-11 11:57:39,843 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 11:57:39,844 - __main__ - INFO - Loading chunking model...
2025-04-11 11:57:39,845 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:57:39,846 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 11:57:39,847 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 11:57:39,848 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 11:57:39,849 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 11:57:46,297 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 11:57:46,299 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 6.45 seconds
2025-04-11 11:57:46,300 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.72 GB
2025-04-11 11:57:46,301 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 11:57:46,302 - __main__ - INFO - Chunking document 1/1: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:57:46,303 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (ID: 0216f334-8283-4166-9ee0-03392eb1bee6, Type: .pdf)
2025-04-11 11:57:46,304 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf.
2025-04-11 11:57:46,305 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 28181 chars) using Markdown Header + Semantic chunking.
2025-04-11 11:57:46,307 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 7 initial structural chunks.
2025-04-11 11:57:46,673 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 37 potential chunks.
2025-04-11 11:57:46,674 - src.core.document_processing.document_chunker - WARNING - Chunk (length 10037) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 11:57:46,676 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 26 basic chunks.
2025-04-11 11:57:46,677 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 1 oversized chunks.
2025-04-11 11:57:46,678 - src.core.document_processing.document_chunker - INFO - Final processing created 62 chunks from text of length 28181.
2025-04-11 11:57:46,679 - src.core.document_processing.document_chunker - INFO - Chunking for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf completed in 0.38s.
2025-04-11 11:57:46,680 - src.core.document_processing.document_chunker - INFO - Created 62 total chunks: 0 spreadsheet rows, 36 semantic chunks, 0 sentence fallback chunks, 26 basic fallback chunks.
2025-04-11 11:57:46,681 - src.core.document_processing.document_chunker - INFO - Average chunk size: 454.5 characters.
2025-04-11 11:57:46,683 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.72 GB
2025-04-11 11:57:46,684 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.20 GB, Total: 8.00 GB
2025-04-11 11:57:46,685 - __main__ - INFO - Created 62 chunks for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 11:57:46,686 - __main__ - INFO - Shutting down chunking model...
2025-04-11 11:57:46,687 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 11:57:46,687 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 11:57:46,688 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 11:57:46,689 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 11:57:46,694 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 11:57:47,340 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 11:57:47,342 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.59 GB, VMS: 41.72 GB
2025-04-11 11:57:47,344 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:57:47,345 - __main__ - INFO - Total chunks generated: 62
2025-04-11 11:57:47,346 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:57:47,346 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-3B-Instruct, debug=True, using advanced deduplication.
2025-04-11 11:57:47,348 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.59 GB, VMS: 41.72 GB
2025-04-11 11:57:47,349 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:57:47,350 - __main__ - INFO - Starting entity extraction on 62 chunks (0 visual chunks)
2025-04-11 11:57:47,350 - src.core.extraction.entity_extractor - INFO - Adding 62 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 11:57:47,351 - src.core.extraction.entity_extractor - INFO - Added 62 chunks to queue. Processing now.
2025-04-11 11:57:47,352 - src.core.extraction.entity_extractor - INFO - Processing all 62 chunks...
2025-04-11 11:57:47,353 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.59 GB, VMS: 41.72 GB
2025-04-11 11:57:47,354 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:57:47,357 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:58:57,338 - src.core.extraction.entity_extractor - INFO - Model Qwen/Qwen2.5-3B-Instruct loaded successfully for extraction.
2025-04-11 11:58:57,339 - src.core.extraction.entity_extractor - INFO - Processing 62 chunks (0 spreadsheet rows)
2025-04-11 11:58:57,340 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 11:58:57,341 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (62 chunks)
2025-04-11 11:58:57,342 - src.core.extraction.entity_extractor - INFO - Sending batch of 62 prompts to service
2025-04-11 11:59:23,216 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 11:59:23,218 - src.core.extraction.entity_extractor - INFO - Service request/response took 25.88s
2025-04-11 11:59:23,220 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.00s. Total batch time: 25.88s
2025-04-11 11:59:23,222 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=62, Parse Errors=0, Missing Outputs=0
2025-04-11 11:59:23,223 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 25.88s
2025-04-11 11:59:23,224 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 11:59:23,224 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 116 entities, 44 relationships.
2025-04-11 11:59:23,225 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 11:59:23,226 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 116 raw entities...
2025-04-11 11:59:23,258 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 11:59:23,264 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 11:59:23,373 - src.core.extraction.entity_extractor - INFO - Generated 494 candidate pairs across all types.
2025-04-11 11:59:23,374 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 11:59:23,450 - src.core.extraction.entity_extractor - INFO - Found 123 potential duplicate pairs after comparison.
2025-04-11 11:59:23,451 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 11:59:23,452 - src.core.extraction.entity_extractor - INFO - Found 67 clusters (including singletons).
2025-04-11 11:59:23,453 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 11:59:23,458 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 67.
2025-04-11 11:59:23,459 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 11:59:23,460 - src.core.extraction.entity_extractor - INFO - Updating 44 raw relationships with canonical entity IDs...
2025-04-11 11:59:23,461 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 43, Updated IDs in 33, Skipped 1 (self-loops or missing mappings).
2025-04-11 11:59:23,462 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 11:59:23,463 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 11:59:23,464 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 3 duplicates. Final count: 40.
2025-04-11 11:59:23,464 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 67 entities, 40 relationships.
2025-04-11 11:59:23,467 - src.core.extraction.entity_extractor - INFO - Saved 67 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 11:59:23,468 - src.core.extraction.entity_extractor - INFO - Saved 40 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 11:59:23,469 - __main__ - INFO - Entity extraction complete. Modified chunks: 62
2025-04-11 11:59:23,555 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-3B-Instruct
2025-04-11 11:59:23,557 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 11:59:23,558 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 11:59:23,559 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 11:59:23,560 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 11:59:23,561 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 11:59:23,562 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.59 GB, VMS: 41.72 GB
2025-04-11 11:59:23,563 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:59:23,564 - __main__ - INFO - Loading indexing model...
2025-04-11 11:59:23,564 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 11:59:23,565 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 11:59:25,066 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 11:59:25,067 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.50 seconds
2025-04-11 11:59:25,068 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.61 GB, VMS: 43.83 GB
2025-04-11 11:59:25,070 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 11:59:25,150 - __main__ - INFO - Indexing 62 chunks
2025-04-11 11:59:25,150 - src.core.indexing.document_indexer - INFO - Starting indexing process for 62 chunks...
2025-04-11 11:59:25,151 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 11:59:25,152 - src.core.indexing.document_indexer - INFO - Indexing 62 chunks to BM25
2025-04-11 11:59:25,157 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 11:59:25,208 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 11:59:25,211 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 11:59:25,214 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (62 documents).
2025-04-11 11:59:25,215 - src.core.indexing.document_indexer - INFO - Indexing 62 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 11:59:25,265 - src.core.indexing.document_indexer - INFO - Collection 'anticorruption_rag_e5_instruct' already exists. Verifying configuration...
2025-04-11 11:59:25,271 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 11:59:25,272 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 62 texts (dense, sparse, colbert)...
2025-04-11 11:59:34,658 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 11:59:34,661 - src.core.indexing.document_indexer - INFO - Embeddings generated in 9.39s
2025-04-11 11:59:34,662 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 11:59:35,342 - src.core.indexing.document_indexer - INFO - Upserting 62 points to Qdrant in 62 batches...
2025-04-11 11:59:35,581 - src.core.indexing.document_indexer - INFO - Upserted batch 1/62 (1 points)
2025-04-11 11:59:35,716 - src.core.indexing.document_indexer - INFO - Upserted batch 2/62 (1 points)
2025-04-11 11:59:35,837 - src.core.indexing.document_indexer - INFO - Upserted batch 3/62 (1 points)
2025-04-11 11:59:35,991 - src.core.indexing.document_indexer - INFO - Upserted batch 4/62 (1 points)
2025-04-11 11:59:36,079 - src.core.indexing.document_indexer - INFO - Upserted batch 5/62 (1 points)
2025-04-11 11:59:36,205 - src.core.indexing.document_indexer - INFO - Upserted batch 6/62 (1 points)
2025-04-11 11:59:36,315 - src.core.indexing.document_indexer - INFO - Upserted batch 7/62 (1 points)
2025-04-11 11:59:36,490 - src.core.indexing.document_indexer - INFO - Upserted batch 8/62 (1 points)
2025-04-11 11:59:36,576 - src.core.indexing.document_indexer - INFO - Upserted batch 9/62 (1 points)
2025-04-11 11:59:36,730 - src.core.indexing.document_indexer - INFO - Upserted batch 10/62 (1 points)
2025-04-11 11:59:36,843 - src.core.indexing.document_indexer - INFO - Upserted batch 11/62 (1 points)
2025-04-11 11:59:36,981 - src.core.indexing.document_indexer - INFO - Upserted batch 12/62 (1 points)
2025-04-11 11:59:37,113 - src.core.indexing.document_indexer - INFO - Upserted batch 13/62 (1 points)
2025-04-11 11:59:37,241 - src.core.indexing.document_indexer - INFO - Upserted batch 14/62 (1 points)
2025-04-11 11:59:37,383 - src.core.indexing.document_indexer - INFO - Upserted batch 15/62 (1 points)
2025-04-11 11:59:37,442 - src.core.indexing.document_indexer - INFO - Upserted batch 16/62 (1 points)
2025-04-11 11:59:37,555 - src.core.indexing.document_indexer - INFO - Upserted batch 17/62 (1 points)
2025-04-11 11:59:37,636 - src.core.indexing.document_indexer - INFO - Upserted batch 18/62 (1 points)
2025-04-11 11:59:37,686 - src.core.indexing.document_indexer - INFO - Upserted batch 19/62 (1 points)
2025-04-11 11:59:37,758 - src.core.indexing.document_indexer - INFO - Upserted batch 20/62 (1 points)
2025-04-11 11:59:37,849 - src.core.indexing.document_indexer - INFO - Upserted batch 21/62 (1 points)
2025-04-11 11:59:38,256 - src.core.indexing.document_indexer - ERROR - Error upserting batch 22: Unexpected Response: 422 (Unprocessable Entity)
Raw response content:
b'{"status":{"error":"Validation error in JSON body: [points[0].vector.?.data: Total size of all vectors (1052672) must be less than 1048576]"},"time":0.0}'
Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/indexing/document_indexer.py", line 503, in _index_to_qdrant
    client.upsert(
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 1567, in upsert
    return self._client.upsert(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 1908, in upsert
    http_result = self.openapi_client.points_api.upsert_points(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/points_api.py", line 987, in upsert_points
    return self._build_for_upsert_points(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/points_api.py", line 512, in _build_for_upsert_points
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 112, in send
    raise UnexpectedResponse.for_response(response)
qdrant_client.http.exceptions.UnexpectedResponse: Unexpected Response: 422 (Unprocessable Entity)
Raw response content:
b'{"status":{"error":"Validation error in JSON body: [points[0].vector.?.data: Total size of all vectors (1052672) must be less than 1048576]"},"time":0.0}'
2025-04-11 11:59:38,336 - src.core.indexing.document_indexer - INFO - Upserted batch 23/62 (1 points)
2025-04-11 11:59:38,380 - src.core.indexing.document_indexer - INFO - Upserted batch 24/62 (1 points)
2025-04-11 11:59:38,448 - src.core.indexing.document_indexer - INFO - Upserted batch 25/62 (1 points)
2025-04-11 11:59:38,491 - src.core.indexing.document_indexer - INFO - Upserted batch 26/62 (1 points)
2025-04-11 11:59:38,539 - src.core.indexing.document_indexer - INFO - Upserted batch 27/62 (1 points)
2025-04-11 11:59:38,607 - src.core.indexing.document_indexer - INFO - Upserted batch 28/62 (1 points)
2025-04-11 11:59:38,692 - src.core.indexing.document_indexer - INFO - Upserted batch 29/62 (1 points)
2025-04-11 11:59:38,758 - src.core.indexing.document_indexer - INFO - Upserted batch 30/62 (1 points)
2025-04-11 11:59:38,839 - src.core.indexing.document_indexer - INFO - Upserted batch 31/62 (1 points)
2025-04-11 11:59:38,924 - src.core.indexing.document_indexer - INFO - Upserted batch 32/62 (1 points)
2025-04-11 11:59:39,004 - src.core.indexing.document_indexer - INFO - Upserted batch 33/62 (1 points)
2025-04-11 11:59:39,068 - src.core.indexing.document_indexer - INFO - Upserted batch 34/62 (1 points)
2025-04-11 11:59:39,115 - src.core.indexing.document_indexer - INFO - Upserted batch 35/62 (1 points)
2025-04-11 11:59:39,169 - src.core.indexing.document_indexer - INFO - Upserted batch 36/62 (1 points)
2025-04-11 11:59:39,259 - src.core.indexing.document_indexer - INFO - Upserted batch 37/62 (1 points)
2025-04-11 11:59:39,325 - src.core.indexing.document_indexer - INFO - Upserted batch 38/62 (1 points)
2025-04-11 11:59:39,385 - src.core.indexing.document_indexer - INFO - Upserted batch 39/62 (1 points)
2025-04-11 11:59:39,457 - src.core.indexing.document_indexer - INFO - Upserted batch 40/62 (1 points)
2025-04-11 11:59:39,523 - src.core.indexing.document_indexer - INFO - Upserted batch 41/62 (1 points)
2025-04-11 11:59:39,591 - src.core.indexing.document_indexer - INFO - Upserted batch 42/62 (1 points)
2025-04-11 11:59:39,670 - src.core.indexing.document_indexer - INFO - Upserted batch 43/62 (1 points)
2025-04-11 11:59:39,741 - src.core.indexing.document_indexer - INFO - Upserted batch 44/62 (1 points)
2025-04-11 11:59:39,809 - src.core.indexing.document_indexer - INFO - Upserted batch 45/62 (1 points)
2025-04-11 11:59:39,858 - src.core.indexing.document_indexer - INFO - Upserted batch 46/62 (1 points)
2025-04-11 11:59:39,919 - src.core.indexing.document_indexer - INFO - Upserted batch 47/62 (1 points)
2025-04-11 11:59:39,954 - src.core.indexing.document_indexer - INFO - Upserted batch 48/62 (1 points)
2025-04-11 11:59:40,058 - src.core.indexing.document_indexer - INFO - Upserted batch 49/62 (1 points)
2025-04-11 11:59:40,113 - src.core.indexing.document_indexer - INFO - Upserted batch 50/62 (1 points)
2025-04-11 11:59:40,193 - src.core.indexing.document_indexer - INFO - Upserted batch 51/62 (1 points)
2025-04-11 11:59:40,245 - src.core.indexing.document_indexer - INFO - Upserted batch 52/62 (1 points)
2025-04-11 11:59:40,352 - src.core.indexing.document_indexer - INFO - Upserted batch 53/62 (1 points)
2025-04-11 11:59:40,397 - src.core.indexing.document_indexer - INFO - Upserted batch 54/62 (1 points)
2025-04-11 11:59:40,495 - src.core.indexing.document_indexer - INFO - Upserted batch 55/62 (1 points)
2025-04-11 11:59:40,556 - src.core.indexing.document_indexer - INFO - Upserted batch 56/62 (1 points)
2025-04-11 11:59:40,601 - src.core.indexing.document_indexer - INFO - Upserted batch 57/62 (1 points)
2025-04-11 11:59:40,655 - src.core.indexing.document_indexer - INFO - Upserted batch 58/62 (1 points)
2025-04-11 11:59:40,700 - src.core.indexing.document_indexer - INFO - Upserted batch 59/62 (1 points)
2025-04-11 11:59:40,792 - src.core.indexing.document_indexer - INFO - Upserted batch 60/62 (1 points)
2025-04-11 11:59:40,853 - src.core.indexing.document_indexer - INFO - Upserted batch 61/62 (1 points)
2025-04-11 11:59:40,932 - src.core.indexing.document_indexer - INFO - Upserted batch 62/62 (1 points)
2025-04-11 11:59:40,932 - src.core.indexing.document_indexer - INFO - Finished upserting points to Qdrant collection 'anticorruption_rag_e5_instruct'.
2025-04-11 11:59:41,047 - src.core.indexing.document_indexer - INFO - Indexing completed successfully for 62 chunks (Qdrant and BM25)
2025-04-11 11:59:41,049 - src.core.indexing.document_indexer - INFO - ===== STARTING EMBEDDING MODEL UNLOAD =====
2025-04-11 11:59:41,050 - src.core.indexing.document_indexer - INFO - Attempting to unload BGE-M3 (FlagEmbedding) model components...
2025-04-11 11:59:42,175 - src.core.indexing.document_indexer - INFO - Deleted BGE-M3 model and tokenizer references.
2025-04-11 11:59:44,864 - src.core.indexing.document_indexer - INFO - Clearing CUDA cache...
2025-04-11 11:59:44,884 - src.core.indexing.document_indexer - INFO - Running garbage collection...
2025-04-11 11:59:45,324 - src.core.indexing.document_indexer - INFO - ===== EMBEDDING MODEL UNLOAD COMPLETE =====
2025-04-11 11:59:45,337 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.67 GB, VMS: 42.29 GB
2025-04-11 11:59:45,346 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.50 GB, Total: 8.00 GB
2025-04-11 11:59:45,494 - __main__ - INFO - Document processing completed successfully!
2025-04-11 11:59:45,501 - __main__ - INFO - Document processing call completed
2025-04-11 12:00:52,434 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:00:52,801 - src.core.query_system.query_engine - INFO - Retrieved 61 chunks for exploration.
2025-04-11 12:00:52,907 - src.core.query_system.query_engine - INFO - Retrieved 61 chunks for exploration.
2025-04-11 12:00:53,077 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 12:00:53,080 - __main__ - INFO - Loaded 67 entities and 40 relationships.
2025-04-11 12:00:53,884 - __main__ - INFO - Building NetworkX graphs for analysis...
2025-04-11 12:00:53,885 - __main__ - INFO - Created entity lookup with 67 valid entities.
2025-04-11 12:00:53,886 - __main__ - INFO - Analysis graphs built: Directed (67 nodes, 40 edges), Undirected (67 nodes, 38 edges). Skipped 0 edges.
2025-04-11 12:00:53,892 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:01:03,380 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:05,026 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:05,123 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 12:01:05,424 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 12:01:06,471 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 12:01:06,472 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 12:01:06,474 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 12:01:06,475 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 12:01:06,477 - __main__ - INFO - Data clearing successful.
2025-04-11 12:01:06,535 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 12:01:06,536 - __main__ - INFO - Aphrodite service remains running after data clear.
2025-04-11 12:01:07,027 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:11,497 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:17,359 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:17,484 - __main__ - INFO - User requested Aphrodite service termination
2025-04-11 12:01:22,030 - __main__ - INFO - Aphrodite service successfully terminated
2025-04-11 12:01:20,903 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:30,021 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:37,212 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:39,004 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:01:39,093 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:01:39,097 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 12:01:39,099 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 12:01:39,102 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 12:02:08,231 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:02:08,240 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:02:08,290 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:02:08,294 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:02:08,304 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 12:02:08,304 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 12:02:08,306 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 12:02:08,307 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 12:02:08,321 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 12:02:08,321 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 12:02:08,324 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:02:08,326 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:02:08,327 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 12:02:08,328 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 12:02:08,329 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:02:08,331 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:02:08,332 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 12:02:08,333 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 12:02:08,334 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:02:08,336 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:02:08,337 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:02:08,338 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:02:08,339 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 12:02:08,340 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 12:02:08,341 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 12:02:08,342 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 12:02:08,345 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.62 GB
2025-04-11 12:02:08,356 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.62 GB
2025-04-11 12:02:08,440 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 12:02:08,441 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 12:02:08,443 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:02:08,445 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:02:12,891 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:02:19,961 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:02:21,270 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:02:21,335 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:02:21,339 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 12:02:21,341 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 12:02:21,343 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 12:02:32,220 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 12:02:32,221 - __main__ - INFO - Saved Aphrodite process info: PID=54424
2025-04-11 12:02:32,223 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 12:02:32,223 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 12:02:32,248 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 12:02:32,254 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 12:02:32,255 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 12:02:32,256 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 12:02:32,257 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 12:04:55,203 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 12:05:29,460 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 12:05:29,582 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 12:05:29,584 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 12:05:29,585 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 12:05:29,587 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.75 GB, VMS: 40.70 GB
2025-04-11 12:05:29,589 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 12:05:29,590 - __main__ - INFO - Loading chunking model...
2025-04-11 12:05:29,591 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 12:05:29,592 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 12:05:29,593 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 12:05:29,594 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 12:05:29,596 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 12:05:38,798 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 12:05:38,802 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 9.21 seconds
2025-04-11 12:05:38,805 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.89 GB, VMS: 41.97 GB
2025-04-11 12:05:38,807 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 12:05:38,808 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 12:05:38,810 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 02ed1a6d-e310-478e-9182-5038ad25fa4d, Type: .pdf)
2025-04-11 12:05:38,811 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 12:05:38,813 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 12:05:38,848 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 12:05:47,892 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 620 potential chunks.
2025-04-11 12:05:47,893 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 12:05:47,895 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 12:05:47,896 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5957) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 12:05:47,898 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 12:05:47,899 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 12:05:47,900 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 12:05:47,901 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5570) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 12:05:47,903 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 17 basic chunks.
2025-04-11 12:05:47,903 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 12:05:47,904 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 12:05:47,905 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 12:05:47,909 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 12:05:47,910 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 6 oversized chunks.
2025-04-11 12:05:47,912 - src.core.document_processing.document_chunker - INFO - Final processing created 726 chunks from text of length 608866.
2025-04-11 12:05:47,916 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 9.11s.
2025-04-11 12:05:47,918 - src.core.document_processing.document_chunker - INFO - Created 726 total chunks: 0 spreadsheet rows, 614 semantic chunks, 0 sentence fallback chunks, 112 basic fallback chunks.
2025-04-11 12:05:47,919 - src.core.document_processing.document_chunker - INFO - Average chunk size: 814.8 characters.
2025-04-11 12:05:47,920 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.88 GB, VMS: 41.96 GB
2025-04-11 12:05:47,921 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 12:05:47,923 - __main__ - INFO - Created 726 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 12:05:47,924 - __main__ - INFO - Shutting down chunking model...
2025-04-11 12:05:47,925 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 12:05:47,926 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 12:05:47,927 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 12:05:47,928 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 12:05:47,935 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 12:05:48,712 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 12:05:48,714 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.87 GB, VMS: 41.95 GB
2025-04-11 12:05:48,716 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:05:48,717 - __main__ - INFO - Total chunks generated: 726
2025-04-11 12:05:48,718 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:05:48,719 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-7B-Instruct, debug=True, using advanced deduplication.
2025-04-11 12:05:48,721 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.87 GB, VMS: 41.95 GB
2025-04-11 12:05:48,722 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:05:48,724 - __main__ - INFO - Starting entity extraction on 726 chunks (0 visual chunks)
2025-04-11 12:05:48,725 - src.core.extraction.entity_extractor - INFO - Adding 726 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 12:05:48,727 - src.core.extraction.entity_extractor - INFO - Added 726 chunks to queue. Processing now.
2025-04-11 12:05:48,728 - src.core.extraction.entity_extractor - INFO - Processing all 726 chunks...
2025-04-11 12:05:48,729 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.87 GB, VMS: 41.95 GB
2025-04-11 12:05:48,730 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:05:48,733 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:09:24,489 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:24,489 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:24,497 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:24,497 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:24,561 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:09:24,561 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:09:24,561 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:09:24,561 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:09:24,567 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 12:09:24,567 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 12:09:24,569 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 12:09:24,570 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 12:09:24,576 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 12:09:24,576 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 12:09:24,579 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:09:24,580 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:09:24,579 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:09:24,580 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:09:24,582 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 12:09:24,583 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 12:09:24,584 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:09:24,585 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:09:24,587 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 12:09:24,589 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 12:09:24,590 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:09:24,592 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:09:24,593 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:09:24,594 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:09:24,596 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 12:09:24,597 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 12:09:24,598 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 12:09:24,600 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 12:09:24,604 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.62 GB
2025-04-11 12:09:24,605 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.32 GB, VMS: 37.62 GB
2025-04-11 12:09:24,749 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 12:09:24,749 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 12:09:24,752 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:09:24,753 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:09:24,752 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:09:24,753 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:09:47,410 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:49,873 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:50,413 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:09:50,492 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:09:50,494 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 12:09:50,497 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['prose_test.pdf']
2025-04-11 12:09:50,498 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 12:10:03,436 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 12:10:03,437 - __main__ - INFO - Saved Aphrodite process info: PID=55435
2025-04-11 12:10:03,438 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 12:10:03,439 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 12:10:03,443 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 12:10:03,446 - __main__ - INFO - Loading regular document: prose_test.pdf
2025-04-11 12:10:03,447 - src.core.document_processing.document_loader - INFO - Loading document: prose_test.pdf (Type: .pdf)
2025-04-11 12:10:03,447 - src.core.document_processing.document_loader - INFO - Processing with Docling: prose_test.pdf
2025-04-11 12:10:03,448 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for prose_test.pdf...
2025-04-11 12:10:11,719 - src.core.document_processing.document_loader - INFO - Exporting prose_test.pdf content to Markdown...
2025-04-11 12:10:11,742 - src.core.document_processing.document_loader - INFO - Docling processing successful for prose_test.pdf. Word count: 217, Page count: 1
2025-04-11 12:10:11,744 - __main__ - INFO - Document loaded: prose_test.pdf, Content items: 1
2025-04-11 12:10:11,747 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 12:10:11,758 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 12:10:11,760 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.16 GB, VMS: 40.10 GB
2025-04-11 12:10:11,762 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 12:10:11,764 - __main__ - INFO - Loading chunking model...
2025-04-11 12:10:11,765 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 12:10:11,766 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 12:10:11,767 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 12:10:11,768 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 12:10:11,769 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 12:10:17,387 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 12:10:17,392 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 5.62 seconds
2025-04-11 12:10:17,394 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.54 GB, VMS: 41.62 GB
2025-04-11 12:10:17,396 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 12:10:17,397 - __main__ - INFO - Chunking document 1/1: prose_test.pdf
2025-04-11 12:10:17,398 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: prose_test.pdf (ID: 99c8d6da-4615-45ae-8244-7bbda8cccf00, Type: .pdf)
2025-04-11 12:10:17,399 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for prose_test.pdf.
2025-04-11 12:10:17,400 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 1472 chars) using Markdown Header + Semantic chunking.
2025-04-11 12:10:17,402 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 1 initial structural chunks.
2025-04-11 12:10:17,430 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 3 potential chunks.
2025-04-11 12:10:17,432 - src.core.document_processing.document_chunker - INFO - Final processing created 3 chunks from text of length 1472.
2025-04-11 12:10:17,433 - src.core.document_processing.document_chunker - INFO - Chunking for prose_test.pdf completed in 0.03s.
2025-04-11 12:10:17,434 - src.core.document_processing.document_chunker - INFO - Created 3 total chunks: 0 spreadsheet rows, 3 semantic chunks, 0 sentence fallback chunks, 0 basic fallback chunks.
2025-04-11 12:10:17,435 - src.core.document_processing.document_chunker - INFO - Average chunk size: 489.0 characters.
2025-04-11 12:10:17,436 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.54 GB, VMS: 41.62 GB
2025-04-11 12:10:17,437 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 12:10:17,438 - __main__ - INFO - Created 3 chunks for prose_test.pdf
2025-04-11 12:10:17,440 - __main__ - INFO - Shutting down chunking model...
2025-04-11 12:10:17,440 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 12:10:17,441 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 12:10:17,442 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 12:10:17,443 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 12:10:17,447 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 12:10:18,734 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 12:10:18,736 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.54 GB, VMS: 41.62 GB
2025-04-11 12:10:18,737 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:10:18,738 - __main__ - INFO - Total chunks generated: 3
2025-04-11 12:10:18,739 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:10:18,740 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-7B-Instruct, debug=True, using advanced deduplication.
2025-04-11 12:10:18,741 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.54 GB, VMS: 41.62 GB
2025-04-11 12:10:18,742 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:10:18,743 - __main__ - INFO - Starting entity extraction on 3 chunks (0 visual chunks)
2025-04-11 12:10:18,744 - src.core.extraction.entity_extractor - INFO - Adding 3 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 12:10:18,745 - src.core.extraction.entity_extractor - INFO - Added 3 chunks to queue. Processing now.
2025-04-11 12:10:18,746 - src.core.extraction.entity_extractor - INFO - Processing all 3 chunks...
2025-04-11 12:10:18,747 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.54 GB, VMS: 41.62 GB
2025-04-11 12:10:18,748 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:10:18,754 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:15:05,274 - src.core.extraction.entity_extractor - INFO - Model Qwen/Qwen2.5-7B-Instruct loaded successfully for extraction.
2025-04-11 12:15:05,281 - src.core.extraction.entity_extractor - INFO - Processing 3 chunks (0 spreadsheet rows)
2025-04-11 12:15:05,284 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 12:15:05,287 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (3 chunks)
2025-04-11 12:15:05,292 - src.core.extraction.entity_extractor - INFO - Sending batch of 3 prompts to service
2025-04-11 12:15:34,533 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 12:15:34,554 - src.core.extraction.entity_extractor - INFO - Service request/response took 29.26s
2025-04-11 12:15:34,587 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e64c2a26-02a7-406e-bee0-d550a3a3270e: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 12:15:34,593 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.04s. Total batch time: 29.30s
2025-04-11 12:15:34,595 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=3, Parse Errors=0, Missing Outputs=0
2025-04-11 12:15:34,598 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 29.31s
2025-04-11 12:16:11,270 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:16:11,290 - __main__ - INFO - Syncing Aphrodite status: Running=True, Model Loaded=True, Model=Qwen/Qwen2.5-7B-Instruct, PID=55435
2025-04-11 12:16:11,294 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:16:11,297 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 12:16:11,301 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 12:16:11,327 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 12:16:11,330 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:16:11,332 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 12:16:11,334 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:16:11,335 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 12:16:11,337 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:16:11,338 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:16:11,339 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 12:16:11,340 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 12:16:11,346 - src.core.query_system.query_engine - INFO - Process memory - RSS: 2.20 GB, VMS: 41.58 GB
2025-04-11 12:16:11,350 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:16:11,352 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:16:11,754 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 12:16:11,756 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 12:16:11,838 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 12:16:36,624 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:16:44,217 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:16:46,301 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:16:47,465 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:16:47,581 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:16:47,584 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 12:16:47,587 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['prose_test.pdf']
2025-04-11 12:16:47,590 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 12:16:47,593 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 12:16:47,601 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 12:16:47,607 - __main__ - INFO - Loading regular document: prose_test.pdf
2025-04-11 12:16:47,608 - src.core.document_processing.document_loader - INFO - Loading document: prose_test.pdf (Type: .pdf)
2025-04-11 12:16:47,609 - src.core.document_processing.document_loader - INFO - Processing with Docling: prose_test.pdf
2025-04-11 12:16:47,610 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for prose_test.pdf...
2025-04-11 12:16:57,070 - src.core.document_processing.document_loader - INFO - Exporting prose_test.pdf content to Markdown...
2025-04-11 12:16:57,073 - src.core.document_processing.document_loader - INFO - Docling processing successful for prose_test.pdf. Word count: 217, Page count: 1
2025-04-11 12:16:57,075 - __main__ - INFO - Document loaded: prose_test.pdf, Content items: 1
2025-04-11 12:16:57,077 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=90
2025-04-11 12:16:57,078 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 12:16:57,081 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.14 GB, VMS: 41.62 GB
2025-04-11 12:16:57,082 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:16:57,083 - __main__ - INFO - Loading chunking model...
2025-04-11 12:16:57,084 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 12:16:57,085 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 12:16:57,086 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 12:16:57,086 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 12:16:57,087 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 12:17:04,146 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 12:17:04,147 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 7.06 seconds
2025-04-11 12:17:04,148 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.10 GB, VMS: 41.68 GB
2025-04-11 12:17:04,149 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:17:04,150 - __main__ - INFO - Chunking document 1/1: prose_test.pdf
2025-04-11 12:17:04,151 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: prose_test.pdf (ID: c1c3be88-ecdc-44db-880f-229c267fa043, Type: .pdf)
2025-04-11 12:17:04,152 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for prose_test.pdf.
2025-04-11 12:17:04,153 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 1472 chars) using Markdown Header + Semantic chunking.
2025-04-11 12:17:04,155 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 1 initial structural chunks.
2025-04-11 12:17:04,217 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 3 potential chunks.
2025-04-11 12:17:04,219 - src.core.document_processing.document_chunker - INFO - Final processing created 3 chunks from text of length 1472.
2025-04-11 12:17:04,220 - src.core.document_processing.document_chunker - INFO - Chunking for prose_test.pdf completed in 0.07s.
2025-04-11 12:17:04,221 - src.core.document_processing.document_chunker - INFO - Created 3 total chunks: 0 spreadsheet rows, 3 semantic chunks, 0 sentence fallback chunks, 0 basic fallback chunks.
2025-04-11 12:17:04,222 - src.core.document_processing.document_chunker - INFO - Average chunk size: 489.0 characters.
2025-04-11 12:17:04,223 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.10 GB, VMS: 41.68 GB
2025-04-11 12:17:04,224 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 0.95 GB, Total: 8.00 GB
2025-04-11 12:17:04,225 - __main__ - INFO - Created 3 chunks for prose_test.pdf
2025-04-11 12:17:04,226 - __main__ - INFO - Shutting down chunking model...
2025-04-11 12:17:04,227 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 12:17:04,228 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 12:17:04,229 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 12:17:04,230 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 12:17:04,233 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 12:17:05,587 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 12:17:05,589 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.09 GB, VMS: 41.62 GB
2025-04-11 12:17:05,590 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:17:05,592 - __main__ - INFO - Total chunks generated: 3
2025-04-11 12:17:05,593 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:17:05,594 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-7B-Instruct, debug=True, using advanced deduplication.
2025-04-11 12:17:05,595 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.09 GB, VMS: 41.62 GB
2025-04-11 12:17:05,596 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:17:05,597 - __main__ - INFO - Starting entity extraction on 3 chunks (0 visual chunks)
2025-04-11 12:17:05,598 - src.core.extraction.entity_extractor - INFO - Adding 3 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 12:17:05,600 - src.core.extraction.entity_extractor - INFO - Added 3 chunks to queue. Processing now.
2025-04-11 12:17:05,600 - src.core.extraction.entity_extractor - INFO - Processing all 3 chunks...
2025-04-11 12:17:05,601 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.09 GB, VMS: 41.62 GB
2025-04-11 12:17:05,603 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:17:05,609 - src.core.extraction.entity_extractor - INFO - Extraction model Qwen/Qwen2.5-7B-Instruct already loaded.
2025-04-11 12:17:05,611 - src.core.extraction.entity_extractor - INFO - Processing 3 chunks (0 spreadsheet rows)
2025-04-11 12:17:05,612 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 12:17:05,613 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (3 chunks)
2025-04-11 12:17:05,614 - src.core.extraction.entity_extractor - INFO - Sending batch of 3 prompts to service
2025-04-11 12:17:36,095 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 12:17:36,096 - src.core.extraction.entity_extractor - INFO - Service request/response took 30.48s
2025-04-11 12:17:36,098 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 1832eab3-f16e-4a41-a59c-c81e4eb8888f: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 12:17:36,099 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.00s. Total batch time: 30.49s
2025-04-11 12:17:36,100 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=3, Parse Errors=0, Missing Outputs=0
2025-04-11 12:17:36,101 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 30.49s
2025-04-11 12:17:36,102 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 12:17:36,103 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 23 entities, 10 relationships.
2025-04-11 12:17:36,104 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 12:17:36,105 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 23 raw entities...
2025-04-11 12:17:36,152 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 12:17:36,161 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 12:17:36,246 - src.core.extraction.entity_extractor - INFO - Generated 82 candidate pairs across all types.
2025-04-11 12:17:36,247 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 12:17:36,269 - src.core.extraction.entity_extractor - INFO - Found 53 potential duplicate pairs after comparison.
2025-04-11 12:17:36,271 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 12:17:36,284 - src.core.extraction.entity_extractor - INFO - Found 8 clusters (including singletons).
2025-04-11 12:17:36,285 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 12:17:36,288 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 8.
2025-04-11 12:17:36,289 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 12:17:36,290 - src.core.extraction.entity_extractor - INFO - Updating 10 raw relationships with canonical entity IDs...
2025-04-11 12:17:36,291 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 10, Updated IDs in 8, Skipped 0 (self-loops or missing mappings).
2025-04-11 12:17:36,293 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 12:17:36,294 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 12:17:36,295 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 0 duplicates. Final count: 10.
2025-04-11 12:17:36,296 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 8 entities, 10 relationships.
2025-04-11 12:17:36,298 - src.core.extraction.entity_extractor - INFO - Saved 8 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 12:17:36,300 - src.core.extraction.entity_extractor - INFO - Saved 10 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 12:17:36,301 - __main__ - INFO - Entity extraction complete. Modified chunks: 3
2025-04-11 12:17:36,373 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-7B-Instruct
2025-04-11 12:17:36,375 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 12:17:36,377 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:17:36,377 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:17:36,378 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 12:17:36,379 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 12:17:36,380 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.09 GB, VMS: 41.62 GB
2025-04-11 12:17:36,381 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:17:36,382 - __main__ - INFO - Loading indexing model...
2025-04-11 12:17:36,383 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 12:17:36,384 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 12:17:38,209 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 12:17:38,210 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.83 seconds
2025-04-11 12:17:38,211 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.14 GB, VMS: 44.92 GB
2025-04-11 12:17:38,212 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 12:17:38,284 - __main__ - INFO - Indexing 3 chunks
2025-04-11 12:17:38,284 - src.core.indexing.document_indexer - INFO - Starting indexing process for 3 chunks...
2025-04-11 12:17:38,285 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 12:17:38,286 - src.core.indexing.document_indexer - INFO - Indexing 3 chunks to BM25
2025-04-11 12:17:38,294 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 12:17:38,316 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 12:17:38,317 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 12:17:38,320 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (3 documents).
2025-04-11 12:17:38,321 - src.core.indexing.document_indexer - INFO - Indexing 3 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 12:17:38,389 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 12:17:38,852 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 12:17:38,853 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 12:17:38,854 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 3 texts (dense, sparse, colbert)...
2025-04-11 12:17:43,966 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 12:17:43,968 - src.core.indexing.document_indexer - INFO - Embeddings generated in 5.11s
2025-04-11 12:17:43,969 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 12:17:44,013 - src.core.indexing.document_indexer - INFO - Upserting 3 points to Qdrant in 1 batches...
2025-04-11 12:17:44,503 - src.core.indexing.document_indexer - INFO - Upserted batch 1/1 (3 points)
2025-04-11 12:17:44,504 - src.core.indexing.document_indexer - INFO - Finished upserting points to Qdrant collection 'anticorruption_rag_e5_instruct'.
2025-04-11 12:17:44,512 - src.core.indexing.document_indexer - INFO - Indexing completed successfully for 3 chunks (Qdrant and BM25)
2025-04-11 12:17:44,513 - src.core.indexing.document_indexer - INFO - ===== STARTING EMBEDDING MODEL UNLOAD =====
2025-04-11 12:17:44,514 - src.core.indexing.document_indexer - INFO - Attempting to unload BGE-M3 (FlagEmbedding) model components...
2025-04-11 12:17:46,453 - src.core.indexing.document_indexer - INFO - Deleted BGE-M3 model and tokenizer references.
2025-04-11 12:17:46,931 - src.core.indexing.document_indexer - INFO - Clearing CUDA cache...
2025-04-11 12:17:46,971 - src.core.indexing.document_indexer - INFO - Running garbage collection...
2025-04-11 12:17:47,494 - src.core.indexing.document_indexer - INFO - ===== EMBEDDING MODEL UNLOAD COMPLETE =====
2025-04-11 12:17:47,498 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.80 GB, VMS: 42.81 GB
2025-04-11 12:17:47,499 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.47 GB, Reserved: 0.48 GB, Total: 8.00 GB
2025-04-11 12:17:47,693 - __main__ - INFO - Document processing completed successfully!
2025-04-11 12:17:47,697 - __main__ - INFO - Document processing call completed
2025-04-11 12:17:59,216 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:17:59,600 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:17:59,759 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:17:59,835 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 12:17:59,838 - __main__ - INFO - Loaded 8 entities and 10 relationships.
2025-04-11 12:18:00,692 - __main__ - INFO - Building NetworkX graphs for analysis...
2025-04-11 12:18:00,695 - __main__ - INFO - Created entity lookup with 8 valid entities.
2025-04-11 12:18:00,696 - __main__ - INFO - Analysis graphs built: Directed (8 nodes, 6 edges), Undirected (8 nodes, 6 edges). Skipped 0 edges.
2025-04-11 12:18:00,704 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:26:10,699 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:26:11,122 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:26:11,421 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:26:11,652 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:27:59,423 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:27:59,856 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:27:59,992 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:28:00,059 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:30:03,779 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:30:04,225 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:30:04,430 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:30:04,519 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:40:43,184 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:40:43,467 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:40:43,571 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:40:43,599 - __main__ - ERROR - Graph rendering failed: Traceback (most recent call last):
  File "/home/t/lm_rag/src/ui/app.py", line 3906, in render_relationship_graph
    render_network_overview_tab(filtered_entities, filtered_relationships)
  File "/home/t/lm_rag/src/ui/app.py", line 4160, in render_network_overview_tab
    G.add_edge(source_id, target_id, key=rel.get("id", str(uuid.uuid4())), # Use original rel ID or new UUID as key for multi-edge uniqueness
                                                           ^^^^
NameError: name 'uuid' is not defined. Did you forget to import 'uuid'

2025-04-11 12:41:22,697 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:41:22,991 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:41:23,059 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:41:23,079 - __main__ - ERROR - Graph rendering failed: Traceback (most recent call last):
  File "/home/t/lm_rag/src/ui/app.py", line 3906, in render_relationship_graph
    render_network_overview_tab(filtered_entities, filtered_relationships)
  File "/home/t/lm_rag/src/ui/app.py", line 4160, in render_network_overview_tab
    G.add_edge(source_id, target_id, key=rel.get("id", str(uuid.uuid4())), # Use original rel ID or new UUID as key for multi-edge uniqueness
                                                           ^^^^
NameError: name 'uuid' is not defined. Did you forget to import 'uuid'

2025-04-11 12:41:59,905 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:41:59,962 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 12:41:59,968 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 12:41:59,969 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 12:41:59,981 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 12:41:59,984 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 12:41:59,985 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 12:41:59,987 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 12:41:59,987 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 12:41:59,988 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:41:59,989 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 12:41:59,990 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 12:41:59,991 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 12:41:59,992 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 12:42:00,100 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 12:42:00,102 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 12:42:01,522 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:01,738 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:01,806 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:01,820 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 12:42:01,824 - __main__ - INFO - Loaded 8 entities and 10 relationships.
2025-04-11 12:42:02,418 - __main__ - INFO - Building NetworkX multi-graphs for analysis...
2025-04-11 12:42:02,419 - __main__ - INFO - Created entity lookup with 8 valid entities.
2025-04-11 12:42:02,421 - __main__ - INFO - Analysis multi-graphs built: Directed (8 nodes, 10 edges), Undirected (8 nodes, 10 edges). Skipped 0 edges.
2025-04-11 12:42:02,426 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:42:23,491 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:23,726 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:23,795 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:23,850 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:42:28,855 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:29,061 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:29,134 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:29,202 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:42:32,424 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:32,675 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:32,746 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:32,797 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:42:33,280 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:33,520 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:33,585 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:33,647 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:42:39,583 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:39,829 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:39,895 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:39,947 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:42:41,713 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:42:41,945 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:42,016 - src.core.query_system.query_engine - INFO - Retrieved 3 chunks for exploration.
2025-04-11 12:42:42,087 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 12:45:30,648 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:45:31,925 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:45:32,074 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 12:45:32,343 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 12:45:31,421 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 12:45:31,424 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 12:45:31,428 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 12:45:31,430 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 12:45:31,433 - __main__ - INFO - Data clearing successful.
2025-04-11 12:45:31,539 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 12:45:32,154 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 12:45:32,160 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:11,863 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:11,899 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 13:21:11,904 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 13:21:11,905 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 13:21:11,914 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 13:21:11,917 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 13:21:11,919 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 13:21:11,920 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 13:21:11,922 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 13:21:11,923 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:21:11,924 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 13:21:11,926 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 13:21:11,927 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 13:21:11,928 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.31 GB, VMS: 37.55 GB
2025-04-11 13:21:12,021 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 13:21:12,023 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:21:17,128 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:17,330 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 13:21:17,333 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 13:21:17,398 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 13:21:20,379 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:22,628 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:36,550 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:37,793 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:21:37,852 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 13:21:37,855 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 13:21:37,857 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['prose_test.pdf']
2025-04-11 13:21:37,859 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 13:21:50,757 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 13:21:50,759 - __main__ - INFO - Saved Aphrodite process info: PID=74120
2025-04-11 13:21:50,760 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 13:21:50,761 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 13:21:50,786 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 13:21:50,788 - __main__ - INFO - Loading regular document: prose_test.pdf
2025-04-11 13:21:50,789 - src.core.document_processing.document_loader - INFO - Loading document: prose_test.pdf (Type: .pdf)
2025-04-11 13:21:50,790 - src.core.document_processing.document_loader - INFO - Processing with Docling: prose_test.pdf
2025-04-11 13:21:50,791 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for prose_test.pdf...
2025-04-11 13:21:58,593 - src.core.document_processing.document_loader - INFO - Exporting prose_test.pdf content to Markdown...
2025-04-11 13:21:58,608 - src.core.document_processing.document_loader - INFO - Docling processing successful for prose_test.pdf. Word count: 217, Page count: 1
2025-04-11 13:21:58,609 - __main__ - INFO - Document loaded: prose_test.pdf, Content items: 1
2025-04-11 13:21:58,610 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 13:21:58,611 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 13:21:58,612 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.14 GB, VMS: 40.16 GB
2025-04-11 13:21:58,614 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 13:21:58,615 - __main__ - INFO - Loading chunking model...
2025-04-11 13:21:58,616 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 13:21:58,616 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 13:21:58,617 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 13:21:58,618 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 13:21:58,619 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 13:22:04,214 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 13:22:04,216 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 5.60 seconds
2025-04-11 13:22:04,217 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.52 GB, VMS: 41.68 GB
2025-04-11 13:22:04,218 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 13:22:04,219 - __main__ - INFO - Chunking document 1/1: prose_test.pdf
2025-04-11 13:22:04,220 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: prose_test.pdf (ID: 33ad3d2f-29c4-47a1-8cb7-62e67a0aab85, Type: .pdf)
2025-04-11 13:22:04,221 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for prose_test.pdf.
2025-04-11 13:22:04,222 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 1472 chars) using Markdown Header + Semantic chunking.
2025-04-11 13:22:04,223 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 1 initial structural chunks.
2025-04-11 13:22:04,258 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 2 potential chunks.
2025-04-11 13:22:04,260 - src.core.document_processing.document_chunker - INFO - Final processing created 2 chunks from text of length 1472.
2025-04-11 13:22:04,261 - src.core.document_processing.document_chunker - INFO - Chunking for prose_test.pdf completed in 0.04s.
2025-04-11 13:22:04,263 - src.core.document_processing.document_chunker - INFO - Created 2 total chunks: 0 spreadsheet rows, 2 semantic chunks, 0 sentence fallback chunks, 0 basic fallback chunks.
2025-04-11 13:22:04,264 - src.core.document_processing.document_chunker - INFO - Average chunk size: 734.0 characters.
2025-04-11 13:22:04,266 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.52 GB, VMS: 41.68 GB
2025-04-11 13:22:04,267 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 13:22:04,268 - __main__ - INFO - Created 2 chunks for prose_test.pdf
2025-04-11 13:22:04,270 - __main__ - INFO - Shutting down chunking model...
2025-04-11 13:22:04,270 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 13:22:04,272 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 13:22:04,273 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 13:22:04,275 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 13:22:04,279 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 13:22:05,034 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 13:22:05,036 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.52 GB, VMS: 41.68 GB
2025-04-11 13:22:05,038 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 13:22:05,039 - __main__ - INFO - Total chunks generated: 2
2025-04-11 13:22:05,040 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 13:22:05,042 - src.core.extraction.entity_extractor - INFO - Loading tokenizer for model: microsoft/phi-4
2025-04-11 13:22:14,299 - src.core.extraction.entity_extractor - INFO - Tokenizer for microsoft/phi-4 loaded successfully with chat template.
2025-04-11 13:22:14,300 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 13:22:14,302 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.52 GB, VMS: 41.68 GB
2025-04-11 13:22:14,303 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 13:22:14,304 - __main__ - INFO - Starting entity extraction on 2 chunks (0 visual chunks)
2025-04-11 13:22:14,305 - src.core.extraction.entity_extractor - INFO - Adding 2 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 13:22:14,306 - src.core.extraction.entity_extractor - INFO - Added 2 chunks to queue. Processing now.
2025-04-11 13:22:14,307 - src.core.extraction.entity_extractor - INFO - Processing all 2 chunks...
2025-04-11 13:22:14,308 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.52 GB, VMS: 41.68 GB
2025-04-11 13:22:14,309 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 13:22:14,316 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 13:52:28,401 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:52:28,437 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 13:52:28,442 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 13:52:28,443 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 13:52:28,466 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 13:52:28,468 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 13:52:28,469 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 13:52:28,470 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 13:52:28,471 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 13:52:28,472 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:52:28,473 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 13:52:28,474 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 13:52:28,475 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 13:52:28,476 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 13:52:28,569 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 13:52:28,570 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:52:29,176 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 13:52:29,179 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:52:45,473 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:52:47,483 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:52:48,595 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:52:48,676 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 13:52:48,679 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 13:52:48,680 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf']
2025-04-11 13:52:48,682 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 13:52:52,545 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 13:52:57,625 - __main__ - INFO - Syncing Aphrodite status: Running=True, Model Loaded=False, Model=None, PID=79271
2025-04-11 13:52:57,627 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 13:52:57,628 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 13:52:57,629 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 13:52:57,630 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 13:52:57,632 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 13:52:57,633 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 13:52:57,633 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 13:52:57,634 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 13:52:57,635 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:52:57,636 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 13:52:57,637 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 13:52:57,638 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 13:52:57,639 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.42 GB, VMS: 37.77 GB
2025-04-11 13:52:57,640 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 13:52:57,641 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:52:56,178 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 13:52:56,180 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 13:53:00,000 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 13:53:00,007 - __main__ - INFO - Saved Aphrodite process info: PID=79271
2025-04-11 13:53:00,010 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 13:53:00,431 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 13:53:00,503 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 13:53:00,512 - __main__ - INFO - Loading regular document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 13:53:00,515 - src.core.document_processing.document_loader - INFO - Loading document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (Type: .pdf)
2025-04-11 13:53:00,518 - src.core.document_processing.document_loader - INFO - Processing with Docling: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 13:53:00,520 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf...
2025-04-11 13:53:14,009 - src.core.document_processing.document_loader - INFO - Exporting The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf content to Markdown...
2025-04-11 13:53:14,073 - src.core.document_processing.document_loader - INFO - Docling processing successful for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf. Word count: 4135, Page count: 10
2025-04-11 13:53:14,077 - __main__ - INFO - Document loaded: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf, Content items: 1
2025-04-11 13:53:14,079 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 13:53:14,080 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 13:53:14,081 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.37 GB, VMS: 40.28 GB
2025-04-11 13:53:14,083 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 13:53:14,084 - __main__ - INFO - Loading chunking model...
2025-04-11 13:53:14,084 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 13:53:14,085 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 13:53:14,086 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 13:53:14,087 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 13:53:14,088 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 13:53:19,725 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 13:53:19,726 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 5.64 seconds
2025-04-11 13:53:19,727 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.74 GB, VMS: 41.81 GB
2025-04-11 13:53:19,728 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 13:53:19,729 - __main__ - INFO - Chunking document 1/1: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 13:53:19,730 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf (ID: 5edf7ce3-f927-482e-a189-305b44bd7770, Type: .pdf)
2025-04-11 13:53:19,731 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf.
2025-04-11 13:53:19,732 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 28181 chars) using Markdown Header + Semantic chunking.
2025-04-11 13:53:19,734 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 7 initial structural chunks.
2025-04-11 13:53:20,126 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 25 potential chunks.
2025-04-11 13:53:20,127 - src.core.document_processing.document_chunker - WARNING - Chunk (length 16110) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 13:53:20,129 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 39 basic chunks.
2025-04-11 13:53:20,129 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 1 oversized chunks.
2025-04-11 13:53:20,130 - src.core.document_processing.document_chunker - INFO - Final processing created 63 chunks from text of length 28181.
2025-04-11 13:53:20,131 - src.core.document_processing.document_chunker - INFO - Chunking for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf completed in 0.40s.
2025-04-11 13:53:20,132 - src.core.document_processing.document_chunker - INFO - Created 63 total chunks: 0 spreadsheet rows, 24 semantic chunks, 0 sentence fallback chunks, 39 basic fallback chunks.
2025-04-11 13:53:20,133 - src.core.document_processing.document_chunker - INFO - Average chunk size: 449.7 characters.
2025-04-11 13:53:20,135 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.74 GB, VMS: 41.81 GB
2025-04-11 13:53:20,136 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.20 GB, Total: 8.00 GB
2025-04-11 13:53:20,136 - __main__ - INFO - Created 63 chunks for The annual report for the fiscal year ending 2023 presented a decidedly mixed bag.pdf
2025-04-11 13:53:20,137 - __main__ - INFO - Shutting down chunking model...
2025-04-11 13:53:20,138 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 13:53:20,139 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 13:53:20,140 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 13:53:20,140 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 13:53:20,145 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 13:53:20,735 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 13:53:20,737 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.74 GB, VMS: 41.81 GB
2025-04-11 13:53:20,738 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 13:53:20,738 - __main__ - INFO - Total chunks generated: 63
2025-04-11 13:53:20,739 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 13:53:20,740 - src.core.extraction.entity_extractor - INFO - Loading tokenizer for model: microsoft/phi-4
2025-04-11 13:53:21,076 - src.core.extraction.entity_extractor - INFO - Tokenizer for microsoft/phi-4 loaded successfully with chat template.
2025-04-11 13:53:21,078 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 13:53:21,079 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.74 GB, VMS: 41.81 GB
2025-04-11 13:53:21,080 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 13:53:21,081 - __main__ - INFO - Starting entity extraction on 63 chunks (0 visual chunks)
2025-04-11 13:53:21,082 - src.core.extraction.entity_extractor - INFO - Adding 63 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 13:53:21,083 - src.core.extraction.entity_extractor - INFO - Added 63 chunks to queue. Processing now.
2025-04-11 13:53:21,084 - src.core.extraction.entity_extractor - INFO - Processing all 63 chunks...
2025-04-11 13:53:21,085 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.74 GB, VMS: 41.81 GB
2025-04-11 13:53:21,086 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 13:53:21,089 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 14:04:15,733 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 14:04:15,747 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 14:04:15,811 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 14:04:15,816 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 14:04:15,819 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 14:04:15,825 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 14:04:15,836 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:04:15,841 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:04:15,844 - __main__ - INFO - Entity extraction complete. Modified chunks: 63
2025-04-11 14:04:16,622 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 14:04:16,625 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 14:04:16,633 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 14:04:16,639 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:04:16,641 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:04:16,642 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 14:04:16,644 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 14:04:16,655 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.69 GB, VMS: 41.81 GB
2025-04-11 14:04:16,672 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:04:16,675 - __main__ - INFO - Loading indexing model...
2025-04-11 14:04:16,678 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 14:04:16,681 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 14:04:18,402 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 14:04:18,404 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.72 seconds
2025-04-11 14:04:18,404 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.77 GB, VMS: 45.05 GB
2025-04-11 14:04:18,406 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:04:18,474 - __main__ - INFO - Indexing 63 chunks
2025-04-11 14:04:18,475 - src.core.indexing.document_indexer - INFO - Starting indexing process for 63 chunks...
2025-04-11 14:04:18,476 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 14:04:18,477 - src.core.indexing.document_indexer - INFO - Indexing 63 chunks to BM25
2025-04-11 14:04:18,500 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 14:04:18,563 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 14:04:18,566 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:04:18,576 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (63 documents).
2025-04-11 14:04:18,578 - src.core.indexing.document_indexer - INFO - Indexing 63 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:04:18,641 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:04:19,141 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 14:04:19,143 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 14:04:19,144 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 63 texts (dense, sparse, colbert)...
2025-04-11 14:04:30,048 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 14:04:30,050 - src.core.indexing.document_indexer - INFO - Embeddings generated in 10.91s
2025-04-11 14:04:30,056 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 14:04:30,836 - src.core.indexing.document_indexer - INFO - Upserting 63 points to Qdrant in 8 batches...
2025-04-11 14:04:31,734 - src.core.indexing.document_indexer - INFO - Upserted batch 1/8 (8 points)
2025-04-11 14:04:32,417 - src.core.indexing.document_indexer - INFO - Upserted batch 2/8 (8 points)
2025-04-11 14:04:32,845 - src.core.indexing.document_indexer - INFO - Upserted batch 3/8 (8 points)
2025-04-11 14:04:33,685 - src.core.indexing.document_indexer - INFO - Upserted batch 4/8 (8 points)
2025-04-11 14:04:34,251 - src.core.indexing.document_indexer - INFO - Upserted batch 5/8 (8 points)
2025-04-11 14:04:34,855 - src.core.indexing.document_indexer - INFO - Upserted batch 6/8 (8 points)
2025-04-11 14:04:35,357 - src.core.indexing.document_indexer - INFO - Upserted batch 7/8 (8 points)
2025-04-11 14:04:35,814 - src.core.indexing.document_indexer - INFO - Upserted batch 8/8 (7 points)
2025-04-11 14:04:35,816 - src.core.indexing.document_indexer - INFO - Finished upserting points to Qdrant collection 'anticorruption_rag_e5_instruct'.
2025-04-11 14:04:35,933 - src.core.indexing.document_indexer - INFO - Indexing completed successfully for 63 chunks (Qdrant and BM25)
2025-04-11 14:04:35,938 - src.core.indexing.document_indexer - INFO - ===== STARTING EMBEDDING MODEL UNLOAD =====
2025-04-11 14:04:35,940 - src.core.indexing.document_indexer - INFO - Attempting to unload BGE-M3 (FlagEmbedding) model components...
2025-04-11 14:04:37,047 - src.core.indexing.document_indexer - INFO - Deleted BGE-M3 model and tokenizer references.
2025-04-11 14:04:44,375 - src.core.indexing.document_indexer - INFO - Clearing CUDA cache...
2025-04-11 14:04:44,421 - src.core.indexing.document_indexer - INFO - Running garbage collection...
2025-04-11 14:04:44,916 - src.core.indexing.document_indexer - INFO - ===== EMBEDDING MODEL UNLOAD COMPLETE =====
2025-04-11 14:04:44,919 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 3.55 GB, VMS: 42.94 GB
2025-04-11 14:04:44,920 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.50 GB, Total: 8.00 GB
2025-04-11 14:04:45,154 - __main__ - INFO - Document processing completed successfully!
2025-04-11 14:04:45,332 - __main__ - INFO - Document processing call completed
2025-04-11 14:09:26,489 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:09:26,530 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:09:26,534 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:09:26,535 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:09:26,545 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:09:26,548 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:09:26,549 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:09:26,549 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:09:26,550 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:09:26,551 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:09:26,552 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:09:26,552 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:09:26,553 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:09:26,555 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 14:09:26,644 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:09:26,646 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:09:27,349 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:09:27,351 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:17:20,696 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:17:20,718 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:17:21,209 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:17:21,303 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 14:17:21,305 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 14:17:21,308 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 14:17:21,310 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 14:17:43,203 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 14:17:43,204 - __main__ - INFO - Saved Aphrodite process info: PID=98434
2025-04-11 14:17:43,205 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 14:17:43,206 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 14:17:43,211 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 14:17:43,221 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:17:43,222 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 14:17:43,223 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:17:43,224 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 14:20:03,987 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 14:20:33,040 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 14:20:33,162 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 14:20:33,165 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 14:20:33,166 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 14:20:33,167 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.81 GB, VMS: 40.77 GB
2025-04-11 14:20:33,169 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 14:20:33,170 - __main__ - INFO - Loading chunking model...
2025-04-11 14:20:33,170 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:20:33,171 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 14:20:33,172 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 14:20:33,173 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 14:20:33,174 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 14:20:37,749 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 14:20:37,751 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.58 seconds
2025-04-11 14:20:37,752 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.93 GB, VMS: 42.04 GB
2025-04-11 14:20:37,753 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 14:20:37,754 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:20:37,755 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: ac74a892-07fa-40f1-856a-ebc084851e80, Type: .pdf)
2025-04-11 14:20:37,756 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 14:20:37,757 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 14:20:37,779 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 14:20:45,685 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 14:20:45,687 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,688 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:20:45,689 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,690 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:20:45,691 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,693 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:20:45,694 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,695 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:20:45,696 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,697 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 14:20:45,698 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,699 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:20:45,699 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,700 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 14:20:45,701 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,704 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 14:20:45,705 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,706 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 14:20:45,707 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:20:45,708 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 14:20:45,709 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 14:20:45,710 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 14:20:45,714 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.96s.
2025-04-11 14:20:45,715 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 14:20:45,716 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 14:20:45,717 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.93 GB, VMS: 42.03 GB
2025-04-11 14:20:45,718 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 14:20:45,719 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:20:45,720 - __main__ - INFO - Shutting down chunking model...
2025-04-11 14:20:45,721 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:20:45,722 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 14:20:45,722 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 14:20:45,723 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 14:20:45,730 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 14:20:46,333 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 14:20:46,335 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.92 GB, VMS: 42.02 GB
2025-04-11 14:20:46,337 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:20:46,337 - __main__ - INFO - Total chunks generated: 672
2025-04-11 14:20:46,339 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 14:20:46,339 - src.core.extraction.entity_extractor - INFO - Loading tokenizer for model: microsoft/phi-4
2025-04-11 14:20:46,684 - src.core.extraction.entity_extractor - INFO - Tokenizer for microsoft/phi-4 loaded successfully with chat template.
2025-04-11 14:20:46,685 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 14:20:46,686 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.92 GB, VMS: 42.02 GB
2025-04-11 14:20:46,687 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:20:46,688 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 14:20:46,689 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 14:20:46,690 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 14:20:46,691 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 14:20:46,692 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.92 GB, VMS: 42.02 GB
2025-04-11 14:20:46,693 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:20:46,698 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 14:20:51,032 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 14:20:51,033 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 14:20:51,036 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 14:20:51,037 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 14:20:51,037 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 14:20:51,038 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 14:20:51,040 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:20:51,041 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:20:51,042 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 14:20:51,105 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 14:20:51,107 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 14:20:51,108 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 14:20:51,109 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:20:51,110 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:20:51,111 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 14:20:51,111 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 14:20:51,112 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.92 GB, VMS: 42.01 GB
2025-04-11 14:20:51,114 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:20:51,114 - __main__ - INFO - Loading indexing model...
2025-04-11 14:20:51,115 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 14:20:51,116 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 14:20:52,418 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 14:20:52,419 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.30 seconds
2025-04-11 14:20:52,420 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.98 GB, VMS: 45.06 GB
2025-04-11 14:20:52,421 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:20:52,494 - __main__ - INFO - Indexing 672 chunks
2025-04-11 14:20:52,494 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 14:20:52,495 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 14:20:52,496 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 14:20:52,500 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 14:20:52,888 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 14:20:52,903 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:20:52,953 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 14:20:52,957 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:20:53,014 - src.core.indexing.document_indexer - INFO - Collection 'anticorruption_rag_e5_instruct' already exists. Verifying configuration...
2025-04-11 14:20:53,020 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 14:20:53,021 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 14:21:05,779 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 14:21:05,781 - src.core.indexing.document_indexer - INFO - Embeddings generated in 12.76s
2025-04-11 14:21:05,782 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 14:21:21,032 - src.core.indexing.document_indexer - INFO - Upserting 672 points to Qdrant in 84 batches...
2025-04-11 14:21:21,493 - src.core.indexing.document_indexer - INFO - Upserted batch 1/84 (8 points)
2025-04-11 14:21:21,908 - src.core.indexing.document_indexer - INFO - Upserted batch 2/84 (8 points)
2025-04-11 14:21:22,859 - src.core.indexing.document_indexer - INFO - Upserted batch 3/84 (8 points)
2025-04-11 14:23:21,578 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:23:21,619 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:23:21,627 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:23:21,628 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:23:21,639 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:23:21,641 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:23:21,642 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:23:21,643 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:23:21,643 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:23:21,644 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:23:21,645 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:23:21,646 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:23:21,647 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:23:21,648 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 14:23:21,739 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:23:21,741 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:23:22,384 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:23:22,386 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:24:27,237 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:24:27,273 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:24:27,277 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:24:27,278 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:24:27,281 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:24:27,284 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:24:27,285 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:24:27,287 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:24:27,288 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:24:27,289 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:24:27,290 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:24:27,291 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:24:27,292 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:24:27,293 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 14:24:27,376 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:24:27,377 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:24:27,905 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:24:27,909 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:24:32,708 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:24:33,076 - src.core.query_system.query_engine - INFO - Retrieved 87 chunks for exploration.
2025-04-11 14:24:33,239 - src.core.query_system.query_engine - INFO - Retrieved 87 chunks for exploration.
2025-04-11 14:24:33,373 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 14:24:33,376 - __main__ - INFO - Loaded 0 entities and 0 relationships.
2025-04-11 14:24:34,247 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:24:37,978 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:24:38,307 - src.core.query_system.query_engine - INFO - Retrieved 87 chunks for exploration.
2025-04-11 14:24:38,452 - src.core.query_system.query_engine - INFO - Retrieved 87 chunks for exploration.
2025-04-11 14:24:43,922 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:24:44,021 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 14:24:44,382 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 14:24:45,384 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:24:45,386 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 14:24:45,388 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:24:45,389 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:24:45,391 - __main__ - INFO - Data clearing successful.
2025-04-11 14:24:45,445 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 14:24:45,893 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:24:46,071 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:24:46,072 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 14:24:46,131 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:24:46,571 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:25:02,012 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 14:25:02,014 - __main__ - INFO - Saved Aphrodite process info: PID=100074
2025-04-11 14:25:02,742 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:25:03,046 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:25:03,049 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 14:25:03,126 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:25:03,768 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:25:11,651 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:25:12,921 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:25:14,431 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:25:14,499 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 14:25:14,502 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 14:25:14,504 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 14:25:14,506 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 14:25:14,507 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-2
2025-04-11 14:25:14,533 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 14:25:14,540 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:25:14,542 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 14:25:14,543 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:25:14,544 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 14:27:37,305 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 14:28:06,124 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 14:28:06,252 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 14:28:06,255 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 14:28:06,256 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 14:28:06,258 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.81 GB, VMS: 40.76 GB
2025-04-11 14:28:06,259 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 14:28:06,260 - __main__ - INFO - Loading chunking model...
2025-04-11 14:28:06,261 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:28:06,262 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 14:28:06,262 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 14:28:06,263 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 14:28:06,264 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 14:28:11,527 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 14:28:11,529 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 5.26 seconds
2025-04-11 14:28:11,530 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.96 GB, VMS: 42.05 GB
2025-04-11 14:28:11,531 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 14:28:11,532 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:28:11,533 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 0dbf34c6-2be1-4a0e-a4b9-25493624edf3, Type: .pdf)
2025-04-11 14:28:11,534 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 14:28:11,535 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 14:28:11,556 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 14:28:19,625 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 14:28:19,627 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,628 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:28:19,629 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,630 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:28:19,631 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,633 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:28:19,634 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,635 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:28:19,636 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,637 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 14:28:19,638 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,639 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:28:19,640 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,641 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 14:28:19,642 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,645 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 14:28:19,646 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,647 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 14:28:19,648 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:28:19,649 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 14:28:19,650 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 14:28:19,650 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 14:28:19,654 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 8.12s.
2025-04-11 14:28:19,655 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 14:28:19,656 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 14:28:19,657 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.97 GB, VMS: 42.04 GB
2025-04-11 14:28:19,658 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 14:28:19,659 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:28:19,660 - __main__ - INFO - Shutting down chunking model...
2025-04-11 14:28:19,661 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:28:19,662 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 14:28:19,662 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 14:28:19,663 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 14:28:19,672 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 14:28:20,292 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 14:28:20,293 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.95 GB, VMS: 42.03 GB
2025-04-11 14:28:20,295 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:28:20,296 - __main__ - INFO - Total chunks generated: 672
2025-04-11 14:28:20,297 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 14:28:20,298 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 14:28:20,299 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.95 GB, VMS: 42.03 GB
2025-04-11 14:28:20,300 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:28:20,301 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 14:28:20,302 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 14:28:20,304 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 14:28:20,305 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 14:28:20,306 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.95 GB, VMS: 42.03 GB
2025-04-11 14:28:20,307 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:28:20,311 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 14:28:24,772 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 14:28:24,773 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 14:28:24,775 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 14:28:24,776 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 14:28:24,777 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 14:28:24,778 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 14:28:24,779 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:28:24,780 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:28:24,780 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 14:28:24,837 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 14:28:24,838 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 14:28:24,840 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 14:28:24,840 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:28:24,841 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:28:24,842 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 14:28:24,843 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 14:28:24,844 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.95 GB, VMS: 42.02 GB
2025-04-11 14:28:24,845 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:28:24,846 - __main__ - INFO - Loading indexing model...
2025-04-11 14:28:24,846 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 14:28:24,847 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 14:28:26,130 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 14:28:26,132 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.28 seconds
2025-04-11 14:28:26,133 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 3.01 GB, VMS: 45.44 GB
2025-04-11 14:28:26,134 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:28:26,188 - __main__ - INFO - Indexing 672 chunks
2025-04-11 14:28:26,189 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 14:28:26,190 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 14:28:26,191 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 14:28:26,209 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 14:28:26,599 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 14:28:26,615 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:28:26,631 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 14:28:26,635 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:28:26,687 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:28:27,118 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 14:28:27,119 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 14:28:27,120 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 14:28:39,441 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 14:28:39,442 - src.core.indexing.document_indexer - INFO - Embeddings generated in 12.32s
2025-04-11 14:28:39,443 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 14:28:49,557 - src.core.indexing.document_indexer - INFO - Upserting 672 points to Qdrant in 84 batches...
2025-04-11 14:28:50,234 - src.core.indexing.document_indexer - INFO - Upserted batch 1/84 (8 points)
2025-04-11 14:28:50,531 - src.core.indexing.document_indexer - INFO - Upserted batch 2/84 (8 points)
2025-04-11 14:28:50,847 - src.core.indexing.document_indexer - INFO - Upserted batch 3/84 (8 points)
2025-04-11 14:30:43,287 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:30:43,324 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:30:43,331 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:30:43,332 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:30:43,342 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:30:43,345 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:30:43,346 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:30:43,346 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:30:43,347 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:30:43,348 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:30:43,349 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:30:43,350 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:30:43,351 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:30:43,352 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 14:30:43,434 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:30:43,435 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:30:44,078 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:30:44,081 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:31:55,080 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:31:55,082 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:31:55,085 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:31:55,086 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:31:55,088 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:31:55,090 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:31:55,091 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:31:55,092 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:31:55,094 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:31:55,095 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:31:55,095 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:31:55,097 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:31:55,098 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:31:55,099 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.41 GB, VMS: 37.63 GB
2025-04-11 14:31:55,100 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:31:55,101 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:31:55,516 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:31:55,519 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:32:19,419 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:32:18,864 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:32:19,520 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:32:19,607 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 14:32:19,609 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 14:32:19,611 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 14:32:19,614 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 14:32:32,615 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 14:32:32,616 - __main__ - INFO - Saved Aphrodite process info: PID=122755
2025-04-11 14:32:32,617 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 14:32:32,618 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 14:32:32,622 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 14:32:32,627 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:32:32,628 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 14:32:32,628 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:32:32,629 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 14:34:50,419 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 14:35:20,115 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 14:35:20,240 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 14:35:20,242 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 14:35:20,243 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 14:35:20,245 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.80 GB, VMS: 40.80 GB
2025-04-11 14:35:20,246 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 14:35:20,247 - __main__ - INFO - Loading chunking model...
2025-04-11 14:35:20,248 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:35:20,249 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 14:35:20,250 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 14:35:20,251 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 14:35:20,252 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 14:35:24,494 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 14:35:24,496 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.24 seconds
2025-04-11 14:35:24,497 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.94 GB, VMS: 42.08 GB
2025-04-11 14:35:24,498 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 14:35:24,499 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:35:24,500 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 81966bef-86e1-432b-85b4-ac01bfd501e3, Type: .pdf)
2025-04-11 14:35:24,501 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 14:35:24,502 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 14:35:24,523 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 14:35:32,462 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 14:35:32,463 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,465 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:35:32,466 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,467 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:35:32,468 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,470 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:35:32,472 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,473 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:35:32,474 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,475 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 14:35:32,475 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,476 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:35:32,477 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,478 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 14:35:32,479 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,482 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 14:35:32,483 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,484 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 14:35:32,485 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:35:32,486 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 14:35:32,486 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 14:35:32,488 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 14:35:32,492 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.99s.
2025-04-11 14:35:32,493 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 14:35:32,494 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 14:35:32,495 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.94 GB, VMS: 42.07 GB
2025-04-11 14:35:32,496 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 14:35:32,497 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:35:32,498 - __main__ - INFO - Shutting down chunking model...
2025-04-11 14:35:32,499 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:35:32,500 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 14:35:32,501 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 14:35:32,502 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 14:35:32,510 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 14:35:33,146 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 14:35:33,149 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.93 GB, VMS: 42.06 GB
2025-04-11 14:35:33,150 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:35:33,151 - __main__ - INFO - Total chunks generated: 672
2025-04-11 14:35:33,152 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 14:35:33,153 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 14:35:33,154 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.93 GB, VMS: 42.06 GB
2025-04-11 14:35:33,155 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:35:33,156 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 14:35:33,157 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 14:35:33,158 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 14:35:33,159 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 14:35:33,160 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.93 GB, VMS: 42.06 GB
2025-04-11 14:35:33,161 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:35:33,163 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 14:35:38,897 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 14:35:38,898 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 14:35:38,901 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 14:35:38,902 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 14:35:38,903 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 14:35:38,903 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 14:35:38,904 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:35:38,906 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:35:38,906 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 14:35:38,971 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 14:35:38,972 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 14:35:38,973 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 14:35:38,974 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:35:38,975 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:35:38,976 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 14:35:38,976 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 14:35:38,977 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.93 GB, VMS: 42.06 GB
2025-04-11 14:35:38,979 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:35:38,980 - __main__ - INFO - Loading indexing model...
2025-04-11 14:35:38,981 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 14:35:38,981 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 14:35:40,257 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 14:35:40,258 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.28 seconds
2025-04-11 14:35:40,259 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.95 GB, VMS: 44.17 GB
2025-04-11 14:35:40,260 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:35:40,319 - __main__ - INFO - Indexing 672 chunks
2025-04-11 14:35:40,319 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 14:35:40,320 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 14:35:40,321 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 14:35:40,324 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 14:35:40,718 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 14:35:40,734 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:35:40,749 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 14:35:40,753 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:35:40,804 - src.core.indexing.document_indexer - INFO - Collection 'anticorruption_rag_e5_instruct' already exists. Verifying configuration...
2025-04-11 14:35:40,808 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 14:35:40,809 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 14:35:50,754 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 14:35:50,756 - src.core.indexing.document_indexer - INFO - Embeddings generated in 9.95s
2025-04-11 14:35:50,757 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 14:36:02,265 - src.core.indexing.document_indexer - INFO - Upserting 672 points to Qdrant in 84 batches...
2025-04-11 14:36:02,866 - src.core.indexing.document_indexer - INFO - Upserted batch 1/84 (8 points)
2025-04-11 14:36:03,110 - src.core.indexing.document_indexer - INFO - Upserted batch 2/84 (8 points)
2025-04-11 14:36:03,430 - src.core.indexing.document_indexer - INFO - Upserted batch 3/84 (8 points)
2025-04-11 14:36:46,787 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:36:46,823 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:36:46,825 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:36:46,834 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:36:46,834 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:36:46,836 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:36:46,838 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:36:46,857 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:36:46,857 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:36:46,859 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:36:46,861 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:36:46,862 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:36:46,863 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:36:46,865 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:36:46,866 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:36:46,867 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:36:46,868 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:36:46,869 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:36:46,871 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:36:46,872 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:36:46,873 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:36:46,874 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:36:46,875 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:36:46,876 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:36:46,877 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:36:46,880 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.62 GB
2025-04-11 14:36:46,880 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.62 GB
2025-04-11 14:36:46,969 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:36:46,969 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:36:46,971 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:36:46,972 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:36:47,646 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:36:47,958 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:36:47,960 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:36:47,962 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:36:49,164 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:36:49,532 - src.core.query_system.query_engine - INFO - Retrieved 48 chunks for exploration.
2025-04-11 14:36:49,663 - src.core.query_system.query_engine - INFO - Retrieved 48 chunks for exploration.
2025-04-11 14:36:49,744 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 14:36:49,753 - __main__ - INFO - Loaded 0 entities and 0 relationships.
2025-04-11 14:36:51,563 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:36:51,737 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 14:36:52,078 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 14:36:53,082 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:36:53,083 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 14:36:53,085 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:36:53,087 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:36:53,088 - __main__ - INFO - Data clearing successful.
2025-04-11 14:36:53,147 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 14:36:53,599 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:36:53,795 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:36:53,796 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 14:36:53,853 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:36:54,986 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:36:56,890 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:37:03,754 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:37:05,523 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:37:05,605 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 14:37:05,607 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 14:37:05,610 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 14:37:05,612 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 14:37:19,139 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 14:37:19,140 - __main__ - INFO - Saved Aphrodite process info: PID=127027
2025-04-11 14:37:19,141 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 14:37:19,142 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 14:37:19,146 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 14:37:19,150 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:37:19,151 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 14:37:19,152 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:37:19,153 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 14:39:37,931 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 14:40:06,255 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 14:40:06,380 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 14:40:06,383 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 14:40:06,384 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 14:40:06,385 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.81 GB, VMS: 40.78 GB
2025-04-11 14:40:06,386 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 14:40:06,387 - __main__ - INFO - Loading chunking model...
2025-04-11 14:40:06,388 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:40:06,389 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 14:40:06,390 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 14:40:06,391 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 14:40:06,392 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 14:40:11,518 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 14:40:11,520 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 5.13 seconds
2025-04-11 14:40:11,521 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.99 GB, VMS: 42.08 GB
2025-04-11 14:40:11,522 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 14:40:11,523 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:40:11,524 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 66823bd3-d20a-4fdd-9511-110d629eb0c2, Type: .pdf)
2025-04-11 14:40:11,525 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 14:40:11,526 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 14:40:11,547 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 14:40:17,175 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 14:40:17,176 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,178 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:40:17,179 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,180 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:40:17,181 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,183 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:40:17,183 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,184 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:40:17,185 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,187 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 14:40:17,187 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,188 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:40:17,189 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,190 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 14:40:17,191 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,194 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 14:40:17,195 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,196 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 14:40:17,197 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:40:17,198 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 14:40:17,199 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 14:40:17,200 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 14:40:17,204 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 5.68s.
2025-04-11 14:40:17,205 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 14:40:17,206 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 14:40:17,207 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.98 GB, VMS: 42.07 GB
2025-04-11 14:40:17,208 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 14:40:17,209 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:40:17,210 - __main__ - INFO - Shutting down chunking model...
2025-04-11 14:40:17,211 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:40:17,211 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 14:40:17,212 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 14:40:17,213 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 14:40:17,221 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 14:40:17,847 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 14:40:17,850 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.97 GB, VMS: 42.06 GB
2025-04-11 14:40:17,851 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:40:17,852 - __main__ - INFO - Total chunks generated: 672
2025-04-11 14:40:17,853 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 14:40:17,854 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 14:40:17,855 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.97 GB, VMS: 42.06 GB
2025-04-11 14:40:17,856 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:40:17,858 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 14:40:17,859 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 14:40:17,861 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 14:40:17,862 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 14:40:17,863 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.97 GB, VMS: 42.06 GB
2025-04-11 14:40:17,864 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:40:17,866 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 14:40:27,353 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 14:40:27,354 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 14:40:27,357 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 14:40:27,358 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 14:40:27,359 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 14:40:27,360 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 14:40:27,362 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:40:27,363 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:40:27,364 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 14:40:27,432 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 14:40:27,436 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 14:40:27,438 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 14:40:27,440 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:40:27,442 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:40:27,443 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 14:40:27,444 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 14:40:27,446 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.97 GB, VMS: 42.05 GB
2025-04-11 14:40:27,447 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:40:27,448 - __main__ - INFO - Loading indexing model...
2025-04-11 14:40:27,449 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 14:40:27,450 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 14:40:28,969 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 14:40:28,971 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.52 seconds
2025-04-11 14:40:28,973 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.99 GB, VMS: 44.41 GB
2025-04-11 14:40:28,975 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:40:29,040 - __main__ - INFO - Indexing 672 chunks
2025-04-11 14:40:29,042 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 14:40:29,043 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 14:40:29,044 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 14:40:29,060 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 14:40:29,489 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 14:40:29,506 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:40:29,525 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 14:40:29,530 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:40:29,614 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:40:30,057 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 14:40:30,058 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 14:40:30,059 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 14:40:42,609 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 14:40:42,611 - src.core.indexing.document_indexer - INFO - Embeddings generated in 12.55s
2025-04-11 14:40:42,611 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 14:40:52,698 - src.core.indexing.document_indexer - INFO - Upserting 672 points to Qdrant in 84 batches...
2025-04-11 14:40:53,019 - src.core.indexing.document_indexer - INFO - Upserted batch 1/84 (8 points)
2025-04-11 14:40:53,310 - src.core.indexing.document_indexer - INFO - Upserted batch 2/84 (8 points)
2025-04-11 14:40:53,576 - src.core.indexing.document_indexer - INFO - Upserted batch 3/84 (8 points)
2025-04-11 14:45:16,851 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:45:16,885 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:45:16,889 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:45:16,890 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:45:16,904 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:45:16,907 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:45:16,908 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:45:16,909 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:45:16,910 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:45:16,911 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:45:16,912 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:45:16,912 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:45:16,913 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:45:16,914 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 14:45:16,994 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:45:16,995 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:45:17,644 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:45:17,646 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:45:51,343 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:45:51,345 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:45:51,348 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:45:51,350 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:45:51,353 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:45:51,355 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:45:51,356 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:45:51,358 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:45:51,359 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:45:51,360 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:45:51,361 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:45:51,362 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:45:51,363 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:45:51,364 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.40 GB, VMS: 37.63 GB
2025-04-11 14:45:51,365 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:45:51,367 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:45:51,851 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:45:51,853 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:46:03,132 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:04,409 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:06,722 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:06,788 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 14:46:06,965 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 14:46:07,967 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:46:07,969 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 14:46:07,970 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:46:07,971 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:46:07,973 - __main__ - INFO - Data clearing successful.
2025-04-11 14:46:08,044 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 14:46:08,704 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:17,060 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:17,264 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:46:17,267 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 14:46:17,343 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 14:46:17,837 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:19,850 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:26,600 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:27,326 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:46:27,402 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 14:46:27,405 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 14:46:27,407 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 14:46:27,408 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 14:46:40,542 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 14:46:40,544 - __main__ - INFO - Saved Aphrodite process info: PID=141152
2025-04-11 14:46:40,545 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 14:46:40,546 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 14:46:40,549 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 14:46:40,554 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:46:40,555 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 14:46:40,555 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:46:40,556 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 14:49:02,313 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 14:49:30,839 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 14:49:30,942 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 14:49:30,943 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 14:49:30,944 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 14:49:30,946 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.77 GB, VMS: 40.75 GB
2025-04-11 14:49:30,948 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 14:49:30,948 - __main__ - INFO - Loading chunking model...
2025-04-11 14:49:30,949 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:49:30,950 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 14:49:30,951 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 14:49:30,952 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 14:49:30,953 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 14:49:35,297 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 14:49:35,298 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.34 seconds
2025-04-11 14:49:35,299 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.96 GB, VMS: 42.07 GB
2025-04-11 14:49:35,301 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 14:49:35,302 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:49:35,303 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: ca13331e-5bed-4ae9-b164-da8dfd5144c5, Type: .pdf)
2025-04-11 14:49:35,304 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 14:49:35,305 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 14:49:35,325 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 14:49:42,384 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 14:49:42,386 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,387 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:49:42,388 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,389 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:49:42,390 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,392 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:49:42,393 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,394 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 14:49:42,395 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,396 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 14:49:42,396 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,397 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 14:49:42,398 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,399 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 14:49:42,400 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,403 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 14:49:42,404 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,405 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 14:49:42,406 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 14:49:42,407 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 14:49:42,408 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 14:49:42,409 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 14:49:42,412 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.11s.
2025-04-11 14:49:42,413 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 14:49:42,414 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 14:49:42,415 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.96 GB, VMS: 42.06 GB
2025-04-11 14:49:42,416 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 14:49:42,416 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:49:42,417 - __main__ - INFO - Shutting down chunking model...
2025-04-11 14:49:42,418 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 14:49:42,419 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 14:49:42,420 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 14:49:42,420 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 14:49:42,428 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 14:49:43,104 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 14:49:43,107 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.95 GB, VMS: 42.06 GB
2025-04-11 14:49:43,108 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:49:43,109 - __main__ - INFO - Total chunks generated: 672
2025-04-11 14:49:43,110 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 14:49:43,111 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 14:49:43,112 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.95 GB, VMS: 42.05 GB
2025-04-11 14:49:43,113 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:49:43,114 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 14:49:43,115 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 14:49:43,116 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 14:49:43,117 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 14:49:43,118 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.95 GB, VMS: 42.05 GB
2025-04-11 14:49:43,118 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:49:43,120 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 14:50:33,485 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 14:50:33,494 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 14:50:33,571 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 14:50:33,576 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 14:50:33,577 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 14:50:33,580 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 14:50:33,598 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 14:50:33,602 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 14:50:33,604 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 14:50:34,372 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 14:50:34,375 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 14:50:34,382 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 14:50:34,387 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:50:34,388 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:50:34,390 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 14:50:34,391 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 14:50:34,411 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.10 GB, VMS: 42.05 GB
2025-04-11 14:50:34,429 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:50:34,431 - __main__ - INFO - Loading indexing model...
2025-04-11 14:50:34,433 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 14:50:34,434 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 14:50:36,856 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 14:50:36,857 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 2.42 seconds
2025-04-11 14:50:36,859 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.14 GB, VMS: 44.47 GB
2025-04-11 14:50:36,860 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 14:50:36,932 - __main__ - INFO - Indexing 672 chunks
2025-04-11 14:50:36,933 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 14:50:36,935 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 14:50:36,936 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 14:50:36,989 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 14:50:37,391 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 14:50:37,409 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 14:50:37,425 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 14:50:37,429 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:50:37,512 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 14:50:38,054 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 14:50:38,055 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 14:50:38,056 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 14:50:55,483 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 14:50:55,492 - src.core.indexing.document_indexer - INFO - Embeddings generated in 17.44s
2025-04-11 14:50:55,493 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 14:57:33,847 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:57:33,852 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:57:33,887 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 14:57:34,534 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 14:57:34,536 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 14:57:34,558 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 14:57:34,561 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 14:57:34,562 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 14:57:34,563 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 14:57:34,564 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 14:57:34,564 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:57:34,565 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 14:57:34,566 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 14:57:34,567 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 14:57:34,568 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.62 GB
2025-04-11 14:57:34,644 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 14:57:34,646 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:57:35,278 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 14:57:35,282 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 14:58:10,039 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:58:14,913 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:58:17,329 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 14:58:17,429 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 14:58:17,430 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 14:58:17,433 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 14:58:17,435 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 14:58:33,503 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 14:58:33,505 - __main__ - INFO - Saved Aphrodite process info: PID=151400
2025-04-11 14:58:33,506 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 14:58:33,507 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 14:58:33,535 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 14:58:33,542 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:58:33,543 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 14:58:33,544 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 14:58:33,546 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 15:01:08,450 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 15:01:38,325 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 15:01:38,445 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 15:01:38,447 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 15:01:38,449 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 15:01:38,450 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.75 GB, VMS: 40.72 GB
2025-04-11 15:01:38,451 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 15:01:38,452 - __main__ - INFO - Loading chunking model...
2025-04-11 15:01:38,453 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 15:01:38,454 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 15:01:38,455 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 15:01:38,456 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 15:01:38,456 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 15:01:42,523 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 15:01:42,524 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.07 seconds
2025-04-11 15:01:42,525 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.90 GB, VMS: 42.01 GB
2025-04-11 15:01:42,526 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.13 GB, Total: 8.00 GB
2025-04-11 15:01:42,527 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:01:42,528 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 3ec6806a-3e80-4b02-aa13-29960d2cce5b, Type: .pdf)
2025-04-11 15:01:42,529 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 15:01:42,529 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 15:01:42,549 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 15:01:50,045 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 15:01:50,046 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,048 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:01:50,049 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,050 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:01:50,050 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,052 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 15:01:50,053 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,054 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:01:50,055 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,056 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 15:01:50,057 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,058 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 15:01:50,058 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,059 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 15:01:50,060 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,063 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 15:01:50,064 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,065 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 15:01:50,066 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:01:50,067 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 15:01:50,068 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 15:01:50,069 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 15:01:50,072 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.54s.
2025-04-11 15:01:50,073 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 15:01:50,074 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 15:01:50,075 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.90 GB, VMS: 42.00 GB
2025-04-11 15:01:50,076 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.90 GB, Reserved: 1.47 GB, Total: 8.00 GB
2025-04-11 15:01:50,077 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:01:50,078 - __main__ - INFO - Shutting down chunking model...
2025-04-11 15:01:50,079 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 15:01:50,079 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 15:01:50,080 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 15:01:50,081 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 15:01:50,088 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 15:01:50,681 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 15:01:50,683 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.90 GB, VMS: 42.00 GB
2025-04-11 15:01:50,684 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 15:01:50,685 - __main__ - INFO - Total chunks generated: 672
2025-04-11 15:01:50,686 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 15:01:50,687 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 15:01:50,688 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.90 GB, VMS: 42.00 GB
2025-04-11 15:01:50,689 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 15:01:50,690 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 15:01:50,691 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 15:01:50,692 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 15:01:50,693 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 15:01:50,694 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.90 GB, VMS: 42.00 GB
2025-04-11 15:01:50,695 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 15:01:50,701 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 15:02:42,476 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 15:02:42,485 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 15:02:42,617 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 15:02:42,621 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 15:02:42,623 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 15:02:42,625 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 15:02:42,643 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 15:02:42,646 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 15:02:42,648 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 15:02:43,412 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 15:02:43,415 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 15:02:43,420 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 15:02:43,423 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:02:43,424 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:02:43,425 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 15:02:43,426 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 15:02:43,446 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.31 GB, VMS: 41.99 GB
2025-04-11 15:02:43,462 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.93 GB, Total: 8.00 GB
2025-04-11 15:02:43,464 - __main__ - INFO - Loading indexing model...
2025-04-11 15:02:43,465 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 15:02:43,466 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 15:03:55,801 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:03:55,845 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 15:03:55,852 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 15:03:55,853 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 15:03:55,873 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 15:03:55,876 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 15:03:55,878 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 15:03:55,878 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:03:55,879 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 15:03:55,880 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:03:55,881 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:03:55,882 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 15:03:55,882 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 15:03:55,883 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 15:03:55,963 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 15:03:55,964 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:03:56,632 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 15:03:56,635 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:10:02,491 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:10:02,522 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 15:10:02,525 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 15:10:02,526 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 15:10:02,529 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 15:10:02,531 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 15:10:02,532 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 15:10:02,533 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:10:02,534 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 15:10:02,535 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:10:02,536 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:10:02,537 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 15:10:02,538 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 15:10:02,539 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 15:10:02,614 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 15:10:02,615 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:10:03,128 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 15:10:03,130 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:10:14,783 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:10:15,861 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:10:16,345 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:10:16,432 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 15:10:16,434 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 15:10:16,435 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 15:10:16,437 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 15:10:30,281 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 15:10:30,282 - __main__ - INFO - Saved Aphrodite process info: PID=153108
2025-04-11 15:10:30,283 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 15:10:30,284 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 15:10:30,287 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 15:10:30,313 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:10:30,314 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 15:10:30,315 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:10:30,316 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 15:12:58,090 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 15:13:27,472 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 15:13:27,636 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 15:13:27,638 - __main__ - INFO - All documents loaded. Shutting down document loader (Docling) to free resources...
2025-04-11 15:13:27,639 - src.core.document_processing.document_loader - INFO - ===== SHUTTING DOWN DocumentLoader and Unloading Docling Models =====
2025-04-11 15:13:27,640 - __main__ - ERROR - Fatal error processing documents: log_memory_usage() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/t/lm_rag/src/ui/app.py", line 751, in process_documents_with_spreadsheet_options
    document_loader.shutdown()
  File "/home/t/lm_rag/src/core/document_processing/document_loader.py", line 136, in shutdown
    log_memory_usage(logger, "Memory usage before Docling shutdown") # Optional: log memory
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: log_memory_usage() takes 1 positional argument but 2 were given
2025-04-11 15:13:27,648 - __main__ - INFO - Document processing call completed
2025-04-11 15:15:24,780 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:15:24,812 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 15:15:24,815 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 15:15:24,816 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 15:15:24,819 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 15:15:24,821 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 15:15:24,822 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 15:15:24,823 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:15:24,824 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 15:15:24,825 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:15:24,826 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:15:24,827 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 15:15:24,828 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 15:15:24,830 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 15:15:24,900 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 15:15:24,901 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:15:25,381 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 15:15:25,383 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:15:39,793 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:15:46,290 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:15:48,133 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:15:48,203 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 15:15:48,205 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 15:15:48,208 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 15:15:48,209 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 15:16:00,866 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 15:16:00,866 - __main__ - INFO - Saved Aphrodite process info: PID=153934
2025-04-11 15:16:00,867 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 15:16:00,868 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 15:16:00,871 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 15:16:00,876 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:16:00,877 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 15:16:00,878 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:16:00,879 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 15:18:19,608 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 15:18:48,540 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 15:18:48,665 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 15:18:48,669 - __main__ - INFO - All documents loaded. Shutting down document loader (Docling) to free resources...
2025-04-11 15:18:48,670 - src.core.document_processing.document_loader - INFO - ===== SHUTTING DOWN DocumentLoader and Unloading Docling Models =====
2025-04-11 15:18:48,671 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.76 GB, VMS: 40.77 GB
2025-04-11 15:18:48,672 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 15:18:48,673 - src.core.document_processing.document_loader - INFO - Unloading Docling DocumentConverter instance...
2025-04-11 15:18:48,676 - src.core.document_processing.document_loader - INFO - Docling converter reference removed.
2025-04-11 15:18:48,677 - src.core.document_processing.document_loader - INFO - Running garbage collection...
2025-04-11 15:18:49,087 - src.core.document_processing.document_loader - INFO - Garbage collection finished.
2025-04-11 15:18:49,088 - src.core.document_processing.document_loader - INFO - CUDA is available. Clearing PyTorch CUDA cache...
2025-04-11 15:18:49,109 - src.core.document_processing.document_loader - INFO - PyTorch CUDA cache cleared.
2025-04-11 15:18:49,111 - src.core.document_processing.document_loader - INFO - Docling models should now be unloaded from memory.
2025-04-11 15:18:49,112 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.71 GB, VMS: 40.72 GB
2025-04-11 15:18:49,113 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 15:18:49,114 - src.core.document_processing.document_loader - INFO - DocumentLoader shutdown complete.
2025-04-11 15:18:49,490 - __main__ - INFO - Document loader shut down complete.
2025-04-11 15:18:49,491 - __main__ - INFO - Process memory - RSS: 2.71 GB, VMS: 40.72 GB
2025-04-11 15:18:49,493 - __main__ - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 15:18:49,494 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 15:18:49,495 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 15:18:49,496 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.71 GB, VMS: 40.72 GB
2025-04-11 15:18:49,497 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 15:18:49,498 - __main__ - INFO - Loading chunking model...
2025-04-11 15:18:49,499 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 15:18:49,499 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 15:18:49,500 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 15:18:49,501 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 15:18:49,502 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 15:18:56,154 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 15:18:56,155 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 6.65 seconds
2025-04-11 15:18:56,156 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.86 GB, VMS: 42.01 GB
2025-04-11 15:18:56,158 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:18:56,158 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:18:56,159 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: fb42887e-c785-4e3c-8e39-cc988ff8442f, Type: .pdf)
2025-04-11 15:18:56,160 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 15:18:56,161 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 15:18:56,180 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 15:19:03,499 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 15:19:03,500 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,501 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:19:03,502 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,503 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:19:03,504 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,506 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 15:19:03,506 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,507 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:19:03,508 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,509 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 15:19:03,510 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,511 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 15:19:03,512 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,513 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 15:19:03,513 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,516 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 15:19:03,517 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,518 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 15:19:03,519 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:19:03,519 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 15:19:03,520 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 15:19:03,521 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 15:19:03,525 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.37s.
2025-04-11 15:19:03,526 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 15:19:03,527 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 15:19:03,528 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.86 GB, VMS: 41.99 GB
2025-04-11 15:19:03,529 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.97 GB, Total: 8.00 GB
2025-04-11 15:19:03,530 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:19:03,531 - __main__ - INFO - Shutting down chunking model...
2025-04-11 15:19:03,532 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 15:19:03,533 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 15:19:03,534 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 15:19:03,535 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 15:19:03,541 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 15:19:04,111 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 15:19:04,114 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.86 GB, VMS: 41.99 GB
2025-04-11 15:19:04,115 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:19:04,116 - __main__ - INFO - Total chunks generated: 672
2025-04-11 15:19:04,117 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 15:19:04,118 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 15:19:04,119 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.86 GB, VMS: 41.99 GB
2025-04-11 15:19:04,120 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:19:04,121 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 15:19:04,122 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 15:19:04,123 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 15:19:04,124 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 15:19:04,124 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.86 GB, VMS: 41.99 GB
2025-04-11 15:19:04,125 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:19:04,128 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 15:19:58,376 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model microsoft/phi-4
2025-04-11 15:19:58,387 - src.core.extraction.entity_extractor - ERROR - Failed to load extraction model (microsoft/phi-4). Adding empty chunks.
2025-04-11 15:19:58,481 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 15:19:58,485 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 15:19:58,488 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 15:19:58,491 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 15:19:58,510 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 15:19:58,512 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 15:19:58,515 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 15:19:59,300 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 15:19:59,303 - __main__ - WARNING - Failed to update process info after extraction.
2025-04-11 15:19:59,312 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 15:19:59,317 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:19:59,319 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:19:59,320 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 15:19:59,321 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 15:19:59,337 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.16 GB, VMS: 41.99 GB
2025-04-11 15:19:59,358 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:19:59,359 - __main__ - INFO - Loading indexing model...
2025-04-11 15:19:59,361 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 15:19:59,362 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 15:20:02,058 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 15:20:02,060 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 2.70 seconds
2025-04-11 15:20:02,061 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.23 GB, VMS: 45.16 GB
2025-04-11 15:20:02,062 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:20:02,168 - __main__ - INFO - Indexing 672 chunks
2025-04-11 15:20:02,170 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 15:20:02,171 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 15:20:02,173 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 15:20:02,208 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 15:20:02,592 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 15:20:02,608 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 15:20:02,632 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 15:20:02,636 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 15:20:02,717 - src.core.indexing.document_indexer - INFO - Collection 'anticorruption_rag_e5_instruct' already exists. Verifying configuration...
2025-04-11 15:20:02,728 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 15:20:02,730 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 15:20:21,966 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 15:20:21,969 - src.core.indexing.document_indexer - INFO - Embeddings generated in 19.24s
2025-04-11 15:20:21,971 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
2025-04-11 15:20:36,701 - src.core.indexing.document_indexer - INFO - Upserting 672 points to Qdrant in 84 batches...
2025-04-11 15:20:38,144 - src.core.indexing.document_indexer - INFO - Upserted batch 1/84 (8 points)
2025-04-11 15:20:38,866 - src.core.indexing.document_indexer - INFO - Upserted batch 2/84 (8 points)
2025-04-11 15:20:39,842 - src.core.indexing.document_indexer - INFO - Upserted batch 3/84 (8 points)
2025-04-11 15:23:36,224 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:23:36,259 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 15:23:36,268 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 15:23:36,269 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 15:23:36,285 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 15:23:36,287 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 15:23:36,288 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 15:23:36,289 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:23:36,290 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 15:23:36,290 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:23:36,291 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:23:36,292 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 15:23:36,293 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 15:23:36,294 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.33 GB, VMS: 37.55 GB
2025-04-11 15:23:36,359 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 15:23:36,360 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:23:36,936 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 15:23:36,939 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:24:06,678 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:24:06,681 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 15:24:06,682 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 15:24:06,683 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 15:24:06,686 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 15:24:06,688 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 15:24:06,689 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 15:24:06,690 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:24:06,691 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 15:24:06,693 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:24:06,694 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:24:06,695 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 15:24:06,696 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 15:24:06,697 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.40 GB, VMS: 37.63 GB
2025-04-11 15:24:06,699 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 15:24:06,700 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:24:07,134 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 15:24:07,136 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:24:27,067 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:24:27,158 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 15:24:27,556 - src.core.query_system.query_engine - INFO - Qdrant collection 'anticorruption_rag_e5_instruct' deleted
2025-04-11 15:24:28,558 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 15:24:28,559 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 15:24:28,561 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 15:24:28,562 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 15:24:28,564 - __main__ - INFO - Data clearing successful.
2025-04-11 15:24:28,628 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 15:24:29,333 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:24:37,404 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:24:39,208 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:24:39,660 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:24:39,727 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 15:24:39,729 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 15:24:39,731 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 15:24:39,733 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 15:24:53,127 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 15:24:53,128 - __main__ - INFO - Saved Aphrodite process info: PID=159588
2025-04-11 15:24:53,129 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 15:24:53,130 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 15:24:53,133 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 15:24:53,138 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:24:53,139 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 15:24:53,140 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:24:53,141 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 15:28:52,630 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:28:52,672 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 15:28:52,677 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 15:28:52,679 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 15:28:52,694 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 15:28:52,698 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 15:28:52,699 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 15:28:52,700 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 15:28:52,701 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 15:28:52,702 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:28:52,703 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 15:28:52,704 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 15:28:52,705 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 15:28:52,706 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 15:28:52,789 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 15:28:52,790 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:28:53,415 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 15:28:53,417 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 15:30:21,432 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:30:26,128 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:30:26,586 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 15:30:26,644 - __main__ - INFO - Storing selected LLM for session: microsoft/phi-4
2025-04-11 15:30:26,647 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 15:30:26,649 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 15:30:26,650 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 15:30:39,616 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 15:30:39,618 - __main__ - INFO - Saved Aphrodite process info: PID=12387
2025-04-11 15:30:39,619 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 15:30:39,619 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 15:30:39,624 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 15:30:39,628 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:30:39,629 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 15:30:39,630 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:30:39,631 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 15:33:04,666 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 15:33:35,045 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 15:33:35,155 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 15:33:35,157 - __main__ - INFO - All documents loaded. Shutting down document loader (Docling) to free resources...
2025-04-11 15:33:35,158 - src.core.document_processing.document_loader - INFO - ===== SHUTTING DOWN DocumentLoader and Unloading Docling Models =====
2025-04-11 15:33:35,160 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.78 GB, VMS: 40.80 GB
2025-04-11 15:33:35,161 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 15:33:35,162 - src.core.document_processing.document_loader - INFO - Unloading Docling DocumentConverter instance...
2025-04-11 15:33:35,164 - src.core.document_processing.document_loader - INFO - Docling converter reference removed.
2025-04-11 15:33:35,165 - src.core.document_processing.document_loader - INFO - Running garbage collection...
2025-04-11 15:33:35,598 - src.core.document_processing.document_loader - INFO - Garbage collection finished.
2025-04-11 15:33:35,600 - src.core.document_processing.document_loader - INFO - CUDA is available. Clearing PyTorch CUDA cache...
2025-04-11 15:33:35,624 - src.core.document_processing.document_loader - INFO - PyTorch CUDA cache cleared.
2025-04-11 15:33:35,625 - src.core.document_processing.document_loader - INFO - Docling models should now be unloaded from memory.
2025-04-11 15:33:35,626 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.74 GB, VMS: 40.76 GB
2025-04-11 15:33:35,627 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 15:33:35,628 - src.core.document_processing.document_loader - INFO - DocumentLoader shutdown complete.
2025-04-11 15:33:36,015 - __main__ - INFO - Document loader shut down complete.
2025-04-11 15:33:36,016 - __main__ - INFO - Process memory - RSS: 2.74 GB, VMS: 40.76 GB
2025-04-11 15:33:36,018 - __main__ - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 15:33:36,019 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 15:33:36,020 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 15:33:36,021 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.74 GB, VMS: 40.76 GB
2025-04-11 15:33:36,022 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 15:33:36,023 - __main__ - INFO - Loading chunking model...
2025-04-11 15:33:36,024 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 15:33:36,025 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 15:33:36,026 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 15:33:36,026 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 15:33:36,027 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 15:33:39,943 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 15:33:39,944 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 3.92 seconds
2025-04-11 15:33:39,945 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.88 GB, VMS: 42.03 GB
2025-04-11 15:33:39,946 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:33:39,947 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:33:39,948 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 7c60ea93-ddd5-4967-93f7-b5b26965b8c2, Type: .pdf)
2025-04-11 15:33:39,949 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 15:33:39,950 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 15:33:39,969 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 15:33:47,435 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 15:33:47,437 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,438 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:33:47,439 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,440 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:33:47,441 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,443 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 15:33:47,444 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,445 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 15:33:47,446 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,447 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 15:33:47,448 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,450 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 15:33:47,451 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,452 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 15:33:47,452 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,455 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 15:33:47,457 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,458 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 15:33:47,460 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 15:33:47,461 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 15:33:47,463 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 15:33:47,464 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 15:33:47,469 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.52s.
2025-04-11 15:33:47,471 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 15:33:47,473 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 15:33:47,475 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.88 GB, VMS: 42.02 GB
2025-04-11 15:33:47,476 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.97 GB, Total: 8.00 GB
2025-04-11 15:33:47,478 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 15:33:47,479 - __main__ - INFO - Shutting down chunking model...
2025-04-11 15:33:47,481 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 15:33:47,482 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 15:33:47,483 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 15:33:47,484 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 15:33:47,492 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 15:33:48,094 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 15:33:48,097 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.88 GB, VMS: 42.02 GB
2025-04-11 15:33:48,098 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:33:48,099 - __main__ - INFO - Total chunks generated: 672
2025-04-11 15:33:48,100 - __main__ - INFO - Creating entity extractor with model microsoft/phi-4
2025-04-11 15:33:48,101 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=microsoft/phi-4, debug=True, using advanced deduplication.
2025-04-11 15:33:48,102 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.88 GB, VMS: 42.02 GB
2025-04-11 15:33:48,103 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:33:48,104 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 15:33:48,105 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 15:33:48,107 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 15:33:48,108 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 15:33:48,109 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.88 GB, VMS: 42.02 GB
2025-04-11 15:33:48,110 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 15:33:48,112 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: microsoft/phi-4
2025-04-11 16:21:51,362 - src.core.extraction.entity_extractor - INFO - Model microsoft/phi-4 loaded successfully for extraction.
2025-04-11 16:21:51,387 - src.core.extraction.entity_extractor - INFO - Processing 672 chunks (0 spreadsheet rows)
2025-04-11 16:21:51,392 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 16:21:51,398 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (672 chunks)
2025-04-11 16:21:51,592 - src.core.extraction.entity_extractor - INFO - Sending batch of 672 prompts to service
2025-04-11 18:01:51,991 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 18:01:51,993 - src.core.extraction.entity_extractor - INFO - Service request/response took 6000.40s
2025-04-11 18:01:51,996 - src.core.extraction.entity_extractor - ERROR - Aphrodite service error during extraction: Timeout waiting for response (extract_entities)
2025-04-11 18:01:52,074 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 6000.68s
2025-04-11 18:01:52,103 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 18:01:52,106 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 0 entities, 0 relationships.
2025-04-11 18:01:52,110 - src.core.extraction.entity_extractor - WARNING - No raw data to deduplicate or save.
2025-04-11 18:01:52,111 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 0 entities, 0 relationships.
2025-04-11 18:01:52,120 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 18:01:52,123 - src.core.extraction.entity_extractor - INFO - Saved 0 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 18:01:52,125 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 18:01:57,582 - __main__ - INFO - QueryEngine LLM model updated to: microsoft/phi-4
2025-04-11 19:38:48,943 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:38:48,944 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:38:48,943 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:38:48,944 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:38:48,984 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 19:38:48,984 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 19:38:48,984 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 19:38:48,984 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 19:38:48,989 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 19:38:48,989 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 19:38:48,990 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 19:38:48,991 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 19:38:49,008 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 19:38:49,008 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 19:38:49,010 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 19:38:49,012 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 19:38:49,010 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 19:38:49,012 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 19:38:49,013 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 19:38:49,014 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 19:38:49,015 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 19:38:49,017 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 19:38:49,018 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 19:38:49,019 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 19:38:49,021 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,022 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,023 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 19:38:49,024 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 19:38:49,025 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 19:38:49,026 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 19:38:49,027 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 19:38:49,028 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 19:38:49,030 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.62 GB
2025-04-11 19:38:49,030 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.62 GB
2025-04-11 19:38:49,111 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 19:38:49,112 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 19:38:49,113 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,114 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,638 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 19:38:49,915 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 19:38:49,917 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,917 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,918 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:38:49,918 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 19:39:10,760 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:39:15,776 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:39:17,236 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 19:39:17,285 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 19:39:17,287 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 19:39:17,290 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 19:39:17,291 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 19:39:29,599 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 19:39:29,600 - __main__ - INFO - Saved Aphrodite process info: PID=13807
2025-04-11 19:39:29,601 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 19:39:29,602 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 19:39:29,605 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 19:39:29,611 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 19:39:29,613 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 19:39:29,614 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 19:39:29,615 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 19:42:00,359 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 19:42:29,370 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 19:42:29,516 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 19:42:29,519 - __main__ - INFO - All documents loaded. Shutting down document loader (Docling) to free resources...
2025-04-11 19:42:29,520 - src.core.document_processing.document_loader - INFO - ===== SHUTTING DOWN DocumentLoader and Unloading Docling Models =====
2025-04-11 19:42:29,522 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.81 GB, VMS: 40.75 GB
2025-04-11 19:42:29,523 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 19:42:29,524 - src.core.document_processing.document_loader - INFO - Unloading Docling DocumentConverter instance...
2025-04-11 19:42:29,527 - src.core.document_processing.document_loader - INFO - Docling converter reference removed.
2025-04-11 19:42:29,528 - src.core.document_processing.document_loader - INFO - Running garbage collection...
2025-04-11 19:42:29,985 - src.core.document_processing.document_loader - INFO - Garbage collection finished.
2025-04-11 19:42:29,986 - src.core.document_processing.document_loader - INFO - CUDA is available. Clearing PyTorch CUDA cache...
2025-04-11 19:42:30,009 - src.core.document_processing.document_loader - INFO - PyTorch CUDA cache cleared.
2025-04-11 19:42:30,011 - src.core.document_processing.document_loader - INFO - Docling models should now be unloaded from memory.
2025-04-11 19:42:30,012 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.77 GB, VMS: 40.71 GB
2025-04-11 19:42:30,013 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 19:42:30,014 - src.core.document_processing.document_loader - INFO - DocumentLoader shutdown complete.
2025-04-11 19:42:30,410 - __main__ - INFO - Document loader shut down complete.
2025-04-11 19:42:30,412 - __main__ - INFO - Process memory - RSS: 2.77 GB, VMS: 40.71 GB
2025-04-11 19:42:30,413 - __main__ - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 19:42:30,415 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 19:42:30,416 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 19:42:30,417 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.77 GB, VMS: 40.71 GB
2025-04-11 19:42:30,418 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 19:42:30,419 - __main__ - INFO - Loading chunking model...
2025-04-11 19:42:30,420 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 19:42:30,420 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 19:42:30,421 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 19:42:30,422 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 19:42:30,423 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 19:42:34,485 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 19:42:34,487 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.06 seconds
2025-04-11 19:42:34,488 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.92 GB, VMS: 41.99 GB
2025-04-11 19:42:34,489 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 19:42:34,490 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 19:42:34,491 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: ade8f1f3-7987-4b14-8436-a3facc8ea90c, Type: .pdf)
2025-04-11 19:42:34,492 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 19:42:34,493 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 19:42:34,514 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 19:42:41,974 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 19:42:41,975 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,976 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 19:42:41,977 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,978 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 19:42:41,979 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,981 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 19:42:41,981 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,982 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 19:42:41,983 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,984 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 19:42:41,985 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,986 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 19:42:41,987 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,987 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 19:42:41,988 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,992 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 19:42:41,993 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,994 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 19:42:41,995 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 19:42:41,996 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 19:42:41,996 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 19:42:41,997 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 19:42:42,001 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.51s.
2025-04-11 19:42:42,002 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 19:42:42,003 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 19:42:42,004 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.92 GB, VMS: 41.98 GB
2025-04-11 19:42:42,005 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.97 GB, Total: 8.00 GB
2025-04-11 19:42:42,006 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 19:42:42,007 - __main__ - INFO - Shutting down chunking model...
2025-04-11 19:42:42,008 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 19:42:42,009 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 19:42:42,010 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 19:42:42,011 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 19:42:42,017 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 19:42:42,609 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 19:42:42,612 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.92 GB, VMS: 41.98 GB
2025-04-11 19:42:42,613 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 19:42:42,614 - __main__ - INFO - Total chunks generated: 672
2025-04-11 19:42:42,615 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-7B-Instruct
2025-04-11 19:42:42,616 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-7B-Instruct, debug=True, using advanced deduplication.
2025-04-11 19:42:42,617 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.92 GB, VMS: 41.98 GB
2025-04-11 19:42:42,618 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 19:42:42,619 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 19:42:42,620 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 19:42:42,621 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 19:42:42,622 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 19:42:42,623 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.92 GB, VMS: 41.97 GB
2025-04-11 19:42:42,624 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 19:42:42,627 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-7B-Instruct
2025-04-11 19:46:50,783 - src.core.extraction.entity_extractor - INFO - Model Qwen/Qwen2.5-7B-Instruct loaded successfully for extraction.
2025-04-11 19:46:50,785 - src.core.extraction.entity_extractor - INFO - Processing 672 chunks (0 spreadsheet rows)
2025-04-11 19:46:50,786 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 19:46:50,787 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (672 chunks)
2025-04-11 19:46:50,791 - src.core.extraction.entity_extractor - INFO - Sending batch of 672 prompts to service
2025-04-11 20:23:02,514 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 20:23:02,520 - src.core.extraction.entity_extractor - INFO - Service request/response took 2171.73s
2025-04-11 20:23:02,533 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4650fb77-9ae0-40b8-a6e9-913a640741ac: from_entity_type='LOCATION' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='UK' to_entity_type='LOCATION'
2025-04-11 20:23:02,535 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4650fb77-9ae0-40b8-a6e9-913a640741ac: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='indefinite leave to remain' to_entity_type='ASSET'
2025-04-11 20:23:02,537 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4650fb77-9ae0-40b8-a6e9-913a640741ac: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='June 2015' to_entity_type='ASSET'
2025-04-11 20:23:02,539 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 6f5ce798-7fec-427e-8d81-4ed5191d6139: Unterminated string starting at: line 1 column 7120 (char 7119). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "NCA", ...'
2025-04-11 20:23:02,541 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 663daa1b-bef2-427b-9af9-3c19fcc820a4: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,542 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 663daa1b-bef2-427b-9af9-3c19fcc820a4: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='judge' to_entity_type='POSITION'
2025-04-11 20:23:02,543 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 663daa1b-bef2-427b-9af9-3c19fcc820a4: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='PFO' to_entity_type='ASSET'
2025-04-11 20:23:02,544 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 663daa1b-bef2-427b-9af9-3c19fcc820a4: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Disclosure Order' to_entity_type='ASSET'
2025-04-11 20:23:02,545 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 663daa1b-bef2-427b-9af9-3c19fcc820a4: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='financial institutions, law firms and other relevant third parties' to_entity_type='LOCATION'
2025-04-11 20:23:02,547 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk cc38af51-56b9-4fd2-85cd-21d52b140b22: Unterminated string starting at: line 1 column 8084 (char 8083). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "...'
2025-04-11 20:23:02,550 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 8abc3a84-4fe7-4faa-9a93-b7021a56802e: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,553 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 8abc3a84-4fe7-4faa-9a93-b7021a56802e: from_entity_type='ASSET' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,555 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 0a07a897-9c6f-45a9-92b8-2b97ace931dc: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type='LOCATED_IN' relationship_description='Used to hold bank accounts' to_entity_name='a number of jurisdictions' to_entity_type='LOCATION'
2025-04-11 20:23:02,558 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c8703e91-bc24-4ab3-8758-82b0d2b57780: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,561 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk bef7199b-7029-4225-b057-6e41451b55eb: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='income' to_entity_type='ASSET'
2025-04-11 20:23:02,563 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 44641985-9b42-46cf-9b22-c5cf744e0225: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='the KB Companies presentation' to_entity_type='ASSET'
2025-04-11 20:23:02,567 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 3412ae6e-8995-4c71-a11d-096f977c4ca7: Unterminated string starting at: line 1 column 7502 (char 7501). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mr Bashirov", "...'
2025-04-11 20:23:02,569 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk c5048680-4e78-4fd5-a376-4bdfba5b87c5: Expecting value: line 1 column 7360 (char 7359). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "My clients", "r...'
2025-04-11 20:23:02,571 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 71ebd87a-9347-4dad-b47b-3f6c160b4eb2: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Azerbaijan' to_entity_type='LOCATION'
2025-04-11 20:23:02,573 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 303c8dd6-507c-4bad-905f-60b72010e76a: Unterminated string starting at: line 1 column 8137 (char 8136). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "NCA", ...'
2025-04-11 20:23:02,574 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 150255df-807f-437e-8a25-61491daf1f4c: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,575 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 150255df-807f-437e-8a25-61491daf1f4c: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,577 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk bb369bc9-e574-4a6b-84fb-edd6a26659b2: Expecting ',' delimiter: line 1 column 7736 (char 7735). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mr Bashirov", "...'
2025-04-11 20:23:02,578 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 99b5e2d1-745b-4f7a-b982-0ae793374af6: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,581 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 324a97e9-021a-46cf-9160-cca84375b338: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description='correspond to the dates and amounts of promissory notes and loan agreements' to_entity_name='promissory notes and loan agreements' to_entity_type='ASSET'
2025-04-11 20:23:02,585 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e6ca8bdc-c6c1-451c-bcc7-22757b5f2ce3: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,589 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 65792730-95c7-4375-9c5b-fd571de50adb: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,590 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 65792730-95c7-4375-9c5b-fd571de50adb: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,592 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 419f67ab-f01f-4ffa-914b-1fce2fcffe58: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,595 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 0dfd5309-63ac-4f68-bf6c-0f32460c9967: Unterminated string starting at: line 1 column 8084 (char 8083). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "...'
2025-04-11 20:23:02,597 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk aca73a5a-5935-45db-9a8f-c1ba4f7836ba: Unterminated string starting at: line 1 column 7728 (char 7727). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "OCCRP"...'
2025-04-11 20:23:02,600 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 6b7bfacd-245f-4e96-8371-bb15fdc4ab6e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='OCCRP' to_entity_type='NGO'
2025-04-11 20:23:02,603 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 0b3a17da-226f-4ae0-aaa6-ee73f4089f18: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,605 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk baf9465a-fafe-4a00-bbdc-4466e8e42a9d: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,607 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk baf9465a-fafe-4a00-bbdc-4466e8e42a9d: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,608 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 0e408c75-bb08-45ad-8d4c-23716ad8755d: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,610 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 0e408c75-bb08-45ad-8d4c-23716ad8755d: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,613 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk da6735d5-7865-4273-9b37-eb50d1d2642d: Unterminated string starting at: line 1 column 8193 (char 8192). Content: '{"entity_relationship_list": [{"from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "rel...'
2025-04-11 20:23:02,614 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk c516d070-b0f2-4930-9744-33f9a8d2800e: Expecting property name enclosed in double quotes: line 1 column 7882 (char 7881). Content: '{ "entity_relationship_list": [ { "from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "GBP 6,...'
2025-04-11 20:23:02,617 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ac4f75d5-0429-4327-9b39-aea9f8944344: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='FATF' to_entity_type='GOVERNMENT_BODY'
2025-04-11 20:23:02,618 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ac4f75d5-0429-4327-9b39-aea9f8944344: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='OECD' to_entity_type='GOVERNMENT_BODY'
2025-04-11 20:23:02,619 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ac4f75d5-0429-4327-9b39-aea9f8944344: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='NCA' to_entity_type='GOVERNMENT_BODY'
2025-04-11 20:23:02,620 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ac4f75d5-0429-4327-9b39-aea9f8944344: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Companies House' to_entity_type='GOVERNMENT_BODY'
2025-04-11 20:23:02,624 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 4d56bec3-2ae3-4a5a-b447-4073df8527cb: Unterminated string starting at: line 1 column 7636 (char 7635). Content: '{ "entity_relationship_list": [ { "from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "USD 5,...'
2025-04-11 20:23:02,628 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 530516d8-a636-4694-8ce0-601a286a0a55: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='loan' to_entity_type='MONEY'
2025-04-11 20:23:02,630 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c8a45fa3-2c3f-4621-a8ea-d40d023dbc1f: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,633 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a992622b-c676-4393-8365-6bc8075333a6: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,635 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5e110975-f0c9-4fda-a32a-615692ee3a85: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,636 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ca4b4224-cc3a-47b2-bafc-e1759e6ec377: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,640 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a504b93c-80b1-45b6-b5ca-2292c6062676: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='DH Leasing' to_entity_type='COMMERCIAL_COMPANY'
2025-04-11 20:23:02,641 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk d1334bc8-15c9-4ca0-98a8-bbf52de173c8: Unterminated string starting at: line 1 column 8160 (char 8159). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mr Bashirov", "...'
2025-04-11 20:23:02,643 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk b5615946-7bd4-475c-8ce7-e5ffa3609490: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Isle of Man' to_entity_type='LOCATION'
2025-04-11 20:23:02,648 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk af2428b5-b874-423a-aa7d-d9c37e853588: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='IBA-Moscow' to_entity_type='COMMERCIAL_COMPANY'
2025-04-11 20:23:02,651 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk af2428b5-b874-423a-aa7d-d9c37e853588: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='transactions' to_entity_type='ASSET'
2025-04-11 20:23:02,656 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 8ba1f708-7d58-48b7-850a-8e5a84803877: Expecting value: line 1 column 7655 (char 7654). Content: '{ "entity_relationship_list": [ { "from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "EUR 2,...'
2025-04-11 20:23:02,661 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e6a9b022-0172-4f87-970b-5a0bde501438: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type='WORKS_FOR' relationship_description='Regulated firms were required to carry out due diligence' to_entity_name='regulated firms' to_entity_type='COMMERCIAL_COMPANY'
2025-04-11 20:23:02,663 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e6a9b022-0172-4f87-970b-5a0bde501438: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description='Source of funds and source of wealth' to_entity_name='Mr Hajiyev' to_entity_type='PERSON'
2025-04-11 20:23:02,664 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e6a9b022-0172-4f87-970b-5a0bde501438: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description='Income' to_entity_name='Mr Hajiyev' to_entity_type='PERSON'
2025-04-11 20:23:02,665 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 042c8b96-9006-4607-a1eb-4d387374da55: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type='WORKS_FOR' relationship_description='Employed' to_entity_name='Tab C1' to_entity_type='LOCATION'
2025-04-11 20:23:02,670 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 95f15207-b274-48ff-9d01-b41e4fd0e5c3: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,673 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk cc3d3246-84c4-420d-9e6d-9c0246f12a8c: Expecting ',' delimiter: line 1 column 7614 (char 7613). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 20:23:02,674 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk df16df41-537d-4bbd-91ed-9067ae78d92d: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,675 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk a164ce2c-315e-442b-81f6-f467d30c078f: Unterminated string starting at: line 1 column 7527 (char 7526). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 20:23:02,677 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk b1ddc883-3f4b-472b-83c4-9b59c5c32e13: Unterminated string starting at: line 1 column 7146 (char 7145). Content: '{ "entity_relationship_list": [ { "from_entity_type": "COMMERCIAL_COMPANY", "from_entity_name": "Glo...'
2025-04-11 20:23:02,679 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='Tea Construction' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,682 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='Eroil' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,684 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='Mea Oil' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,685 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='TPD Trading Petrol and Drilling' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,686 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='Tiara' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,687 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='Migao Corporation' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,688 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a7edf328-a2f9-4b7a-80fa-6f71e223ac7e: from_entity_type=None from_entity_name='Anglo Asian Mining Plc' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,690 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk e9d65954-7fbe-470b-839f-e8c9bf956ac8: Unterminated string starting at: line 1 column 6734 (char 6733). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 20:23:02,692 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 2657cef0-f969-4ebc-9dfe-754a2988018a: Unterminated string starting at: line 1 column 8328 (char 8327). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 20:23:02,694 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 8bdef19d-7802-49ff-91b6-2493da22a1d8: Unterminated string starting at: line 1 column 7445 (char 7444). Content: '{"entity_relationship_list": [{"from_entity_type": "ASSET", "from_entity_name": "7.9 12-14 Walton St...'
2025-04-11 20:23:02,695 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk bf4363ab-9707-440f-864b-b746f8763a4d: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='BVI' to_entity_type='LOCATION'
2025-04-11 20:23:02,697 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5a6a6efd-770f-4c05-ae66-076fcd187434: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,698 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5a6a6efd-770f-4c05-ae66-076fcd187434: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,700 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 20ec5073-5ed9-4d26-b004-44b7ba0a6b0c: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,701 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ae80ad68-59dd-4ab5-92d0-037d307ec93b: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Azerbaijan' to_entity_type='LOCATION'
2025-04-11 20:23:02,706 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 01f6a8e2-80f1-4b78-925d-e97719909528: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,711 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 59260ca1-dcc5-4c85-97d2-e09c841a9215: from_entity_type='PERSON' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,713 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 59260ca1-dcc5-4c85-97d2-e09c841a9215: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,715 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4475d900-db3a-4f16-a2a9-487073934f1b: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,717 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4475d900-db3a-4f16-a2a9-487073934f1b: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,719 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c290a412-323f-47c5-a724-2cca586f92ca: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,721 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk dc2f1d32-fbca-434a-8477-6debb47a08c4: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,722 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 538cd642-9a8c-4d23-8108-323dcb6c11d2: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,726 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk ebe8d346-27c8-47fb-9f27-a08d7c693afe: Unterminated string starting at: line 1 column 8004 (char 8003). Content: '{"entity_relationship_list": [{"from_entity_type": "LOCATION", "from_entity_name": "Guernsey", "rela...'
2025-04-11 20:23:02,728 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 97af8068-d315-49a1-8cfb-d97a0f287927: Unterminated string starting at: line 1 column 7469 (char 7468). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "...'
2025-04-11 20:23:02,729 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk ee226391-b85c-476b-85c3-7ad177aec2ba: Unterminated string starting at: line 1 column 7134 (char 7133). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Ms Mateos", "re...'
2025-04-11 20:23:02,730 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 04bcbed4-2442-4932-943a-a5df8ece59b6: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,732 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 04bcbed4-2442-4932-943a-a5df8ece59b6: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,733 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk bb8af1bd-9531-4bbd-bd8d-de11c977eb08: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,734 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk bb8af1bd-9531-4bbd-bd8d-de11c977eb08: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,736 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2f70278b-d67e-4141-b995-c71922e6b2b1: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,737 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2f70278b-d67e-4141-b995-c71922e6b2b1: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,738 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 49918128-cf79-4f9a-a9ad-852aa9d60052: Unterminated string starting at: line 1 column 7803 (char 7802). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Ms Georgiou", "...'
2025-04-11 20:23:02,740 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4a4e3c18-444e-4141-88a9-578d35507d02: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,743 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4a4e3c18-444e-4141-88a9-578d35507d02: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Mill Ride Golf Club' to_entity_type='ASSET'
2025-04-11 20:23:02,744 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4a4e3c18-444e-4141-88a9-578d35507d02: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type='LOCATED_IN' relationship_description='Offshore trust structure' to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,745 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 34494d0e-7aca-4fe3-9014-9883613c9725: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,747 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 8233cfbc-3fec-4d59-a8e2-970e1db91a46: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,748 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 8233cfbc-3fec-4d59-a8e2-970e1db91a46: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,750 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 700ab1a7-13e9-4b84-a12b-6bc7b599f748: Unterminated string starting at: line 1 column 6271 (char 6270). Content: '{"entity_relationship_list": [{"from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "GBP 620,0...'
2025-04-11 20:23:02,751 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 2faf951a-c5b5-435c-b780-9c7609369b65: Expecting value: line 1 column 7868 (char 7867). Content: '{"entity_relationship_list": [{"from_entity_type": "COMMERCIAL_COMPANY", "from_entity_name": "Semfra...'
2025-04-11 20:23:02,753 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 6c8fa4e4-dba9-4b89-89d3-e889d4b2c702: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='account number LU190023192776665200' to_entity_type='ASSET'
2025-04-11 20:23:02,754 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c9c9e92c-4050-4789-9342-a1560c8216ab: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,755 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c9c9e92c-4050-4789-9342-a1560c8216ab: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,758 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 1edfa7ea-0757-4440-873e-5126461e1587: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,760 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 1edfa7ea-0757-4440-873e-5126461e1587: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,762 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ad5490a5-311d-4f68-aaeb-1988794dac15: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,763 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ad5490a5-311d-4f68-aaeb-1988794dac15: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 20:23:02,765 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 7dfcac50-1f56-44e6-98ec-0146dc8d3969: Unterminated string starting at: line 1 column 7459 (char 7458). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "NCA", ...'
2025-04-11 20:23:02,766 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.24s. Total batch time: 2171.98s
2025-04-11 20:23:02,767 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=646, Parse Errors=26, Missing Outputs=0
2025-04-11 20:23:02,776 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 2171.99s
2025-04-11 20:23:02,783 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 20:23:02,785 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 4700 entities, 1345 relationships.
2025-04-11 20:23:02,786 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 20:23:02,787 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 4700 raw entities...
2025-04-11 20:23:02,836 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 20:23:02,947 - src.core.extraction.entity_extractor - WARNING - Removed 16 entities with empty normalized names.
2025-04-11 20:23:02,948 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 20:23:03,272 - src.core.extraction.entity_extractor - INFO - Generated 171254 candidate pairs across all types.
2025-04-11 20:23:03,274 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 20:23:20,178 - src.core.extraction.entity_extractor - INFO - Found 142009 potential duplicate pairs after comparison.
2025-04-11 20:23:20,179 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 20:23:25,462 - src.core.extraction.entity_extractor - INFO - Found 1356 clusters (including singletons).
2025-04-11 20:23:25,464 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 20:23:25,641 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 1356.
2025-04-11 20:23:25,676 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 20:23:25,678 - src.core.extraction.entity_extractor - INFO - Updating 1345 raw relationships with canonical entity IDs...
2025-04-11 20:23:25,680 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 1322, Updated IDs in 1240, Skipped 23 (self-loops or missing mappings).
2025-04-11 20:23:25,681 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 20:23:25,681 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 20:23:25,683 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 119 duplicates. Final count: 1203.
2025-04-11 20:23:25,684 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 1356 entities, 1203 relationships.
2025-04-11 20:23:25,713 - src.core.extraction.entity_extractor - INFO - Saved 1356 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 20:23:25,728 - src.core.extraction.entity_extractor - INFO - Saved 1203 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 20:23:25,730 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 20:23:25,841 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-7B-Instruct
2025-04-11 20:23:25,849 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 20:23:25,850 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 20:23:25,851 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 20:23:25,852 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 20:23:25,853 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 20:23:25,855 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.91 GB, VMS: 41.97 GB
2025-04-11 20:23:25,857 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 20:23:25,858 - __main__ - INFO - Loading indexing model...
2025-04-11 20:23:25,859 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 20:23:25,860 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 20:23:27,544 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 20:23:27,546 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 1.69 seconds
2025-04-11 20:23:27,547 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.93 GB, VMS: 44.34 GB
2025-04-11 20:23:27,548 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 20:23:27,591 - __main__ - INFO - Indexing 672 chunks
2025-04-11 20:23:27,592 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 20:23:27,593 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 20:23:27,593 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 20:23:27,601 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 20:23:27,262 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 20:23:27,278 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 20:23:27,305 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 20:23:27,310 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 20:23:27,360 - src.core.indexing.document_indexer - ERROR - Error checking/creating/recreating Qdrant collection: [Errno 111] Connection refused
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/indexing/document_indexer.py", line 352, in _index_to_qdrant
    collections = client.get_collections().collections
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 2140, in get_collections
    return self._client.get_collections(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 2568, in get_collections
    self.http.collections_api.get_collections().result
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 330, in get_collections
    return self._build_for_get_collections()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 159, in _build_for_get_collections
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: [Errno 111] Connection refused
2025-04-11 20:23:27,389 - src.core.indexing.document_indexer - WARNING - Indexing completed with fallback mode (BM25 only) due to Qdrant failure.
2025-04-11 20:23:27,391 - src.core.indexing.document_indexer - INFO - ===== STARTING EMBEDDING MODEL UNLOAD =====
2025-04-11 20:23:27,392 - src.core.indexing.document_indexer - INFO - Attempting to unload BGE-M3 (FlagEmbedding) model components...
2025-04-11 20:23:27,574 - src.core.indexing.document_indexer - INFO - Deleted BGE-M3 model and tokenizer references.
2025-04-11 20:23:28,861 - src.core.indexing.document_indexer - INFO - Clearing CUDA cache...
2025-04-11 20:23:29,512 - src.core.indexing.document_indexer - INFO - Running garbage collection...
2025-04-11 20:23:29,924 - src.core.indexing.document_indexer - INFO - ===== EMBEDDING MODEL UNLOAD COMPLETE =====
2025-04-11 20:23:29,925 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 2.93 GB, VMS: 41.97 GB
2025-04-11 20:23:29,931 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 20:23:30,021 - __main__ - INFO - Document processing completed successfully!
2025-04-11 20:23:30,022 - __main__ - INFO - Document processing call completed
2025-04-11 22:00:11,341 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:00:11,546 - src.core.query_system.query_engine - ERROR - Error retrieving chunks: [Errno 111] Connection refused
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/query_system/query_engine.py", line 400, in get_chunks
    collections = client.get_collections().collections
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 2140, in get_collections
    return self._client.get_collections(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 2568, in get_collections
    self.http.collections_api.get_collections().result
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 330, in get_collections
    return self._build_for_get_collections()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 159, in _build_for_get_collections
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: [Errno 111] Connection refused
2025-04-11 22:00:11,562 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 22:00:11,615 - src.core.query_system.query_engine - ERROR - Error retrieving chunks: [Errno 111] Connection refused
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/query_system/query_engine.py", line 400, in get_chunks
    collections = client.get_collections().collections
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 2140, in get_collections
    return self._client.get_collections(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 2568, in get_collections
    self.http.collections_api.get_collections().result
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 330, in get_collections
    return self._build_for_get_collections()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 159, in _build_for_get_collections
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: [Errno 111] Connection refused
2025-04-11 22:00:11,695 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 22:00:11,719 - __main__ - INFO - Loaded 1356 entities and 1203 relationships.
2025-04-11 22:00:12,416 - __main__ - INFO - Building NetworkX multi-graphs for analysis...
2025-04-11 22:00:12,419 - __main__ - INFO - Created entity lookup with 1356 valid entities.
2025-04-11 22:00:12,435 - __main__ - INFO - Analysis multi-graphs built: Directed (1356 nodes, 1203 edges), Undirected (1356 nodes, 1203 edges). Skipped 0 edges.
2025-04-11 22:00:12,502 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 22:42:49,027 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:42:49,065 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 22:42:49,069 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 22:42:49,070 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 22:42:49,077 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 22:42:49,080 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 22:42:49,081 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 22:42:49,082 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 22:42:49,083 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 22:42:49,084 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 22:42:49,085 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 22:42:49,086 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 22:42:49,087 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 22:42:49,089 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 22:42:49,176 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 22:42:49,177 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 22:42:49,807 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 22:42:49,810 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 22:42:58,655 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:42:58,919 - src.core.query_system.query_engine - ERROR - Error retrieving chunks: [Errno 111] Connection refused
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/query_system/query_engine.py", line 400, in get_chunks
    collections = client.get_collections().collections
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 2140, in get_collections
    return self._client.get_collections(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 2568, in get_collections
    self.http.collections_api.get_collections().result
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 330, in get_collections
    return self._build_for_get_collections()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 159, in _build_for_get_collections
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: [Errno 111] Connection refused
2025-04-11 22:42:58,951 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 22:42:59,026 - src.core.query_system.query_engine - ERROR - Error retrieving chunks: [Errno 111] Connection refused
Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 116, in send_inner
    response = self._client.send(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/t/lm_rag/src/core/query_system/query_engine.py", line 400, in get_chunks
    collections = client.get_collections().collections
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_client.py", line 2140, in get_collections
    return self._client.get_collections(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/qdrant_remote.py", line 2568, in get_collections
    self.http.collections_api.get_collections().result
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 330, in get_collections
    return self._build_for_get_collections()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api/collections_api.py", line 159, in _build_for_get_collections
    return self.api_client.request(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 89, in request
    return self.send(request, type_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 106, in send
    response = self.middleware(request, self.send_inner)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 215, in __call__
    return call_next(request)
           ^^^^^^^^^^^^^^^^^^
  File "/home/t/lm_rag/venv/lib/python3.12/site-packages/qdrant_client/http/api_client.py", line 118, in send_inner
    raise ResponseHandlingException(e)
qdrant_client.http.exceptions.ResponseHandlingException: [Errno 111] Connection refused
2025-04-11 22:42:59,112 - __main__ - INFO - Loading relationships and entities from disk...
2025-04-11 22:42:59,130 - __main__ - INFO - Loaded 1356 entities and 1203 relationships.
2025-04-11 22:42:59,898 - __main__ - INFO - Building NetworkX multi-graphs for analysis...
2025-04-11 22:42:59,904 - __main__ - INFO - Created entity lookup with 1356 valid entities.
2025-04-11 22:42:59,937 - __main__ - INFO - Analysis multi-graphs built: Directed (1356 nodes, 1203 edges), Undirected (1356 nodes, 1203 edges). Skipped 0 edges.
2025-04-11 22:43:00,041 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 22:43:10,797 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:12,069 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:12,252 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 22:43:12,253 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 22:43:12,310 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 22:43:12,467 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 22:43:15,662 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:15,795 - src.utils.deepseek_manager - INFO - DeepSeek manager initialized with model: deepseek-reasoner
2025-04-11 22:43:16,606 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:16,829 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 22:43:16,830 - __main__ - WARNING - No document names found in retrieved chunks metadata.
2025-04-11 22:43:16,901 - src.core.query_system.query_engine - WARNING - Collection anticorruption_rag_e5_instruct does not exist
2025-04-11 22:43:17,071 - __main__ - WARNING - Eigenvector prep error: `eigenvector_centrality_numpy` does not give consistent results for disconnected graphs. Assigning 0.
2025-04-11 22:43:20,910 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:26,744 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:28,491 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:28,953 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:43:29,008 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 22:43:29,009 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 22:43:29,011 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 22:43:29,013 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 22:43:41,675 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 22:43:41,676 - __main__ - INFO - Saved Aphrodite process info: PID=15021
2025-04-11 22:43:41,677 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 22:43:41,678 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 22:43:41,692 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 22:43:41,698 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 22:43:41,699 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 22:43:41,700 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 22:43:41,701 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 22:44:30,676 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:44:30,711 - __main__ - INFO - Initializing ConversationStore...
2025-04-11 22:44:30,714 - src.utils.conversation_store - INFO - Conversation storage initialized at: /home/t/lm_rag/data/conversations
2025-04-11 22:44:30,715 - src.utils.conversation_store - INFO - Loading conversations from: /home/t/lm_rag/data/conversations
2025-04-11 22:44:30,717 - src.utils.conversation_store - INFO - Successfully loaded 12 conversations into memory.
2025-04-11 22:44:30,719 - __main__ - INFO - Creating new QueryEngine instance.
2025-04-11 22:44:30,720 - src.core.query_system.query_engine - INFO - Initializing QueryEngine:
2025-04-11 22:44:30,721 - src.core.query_system.query_engine - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 22:44:30,721 - src.core.query_system.query_engine - INFO -   - Reranking Model: BAAI/bge-reranker-v2-m3
2025-04-11 22:44:30,722 - src.core.query_system.query_engine - INFO -   - LLM (Chat) Model: Qwen/Qwen2.5-3B-Instruct
2025-04-11 22:44:30,723 - src.core.query_system.query_engine - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 22:44:30,724 - src.core.query_system.query_engine - INFO -   - Cross-Encoder Reranking Enabled: True
2025-04-11 22:44:30,725 - src.core.query_system.query_engine - INFO -   - BGE-M3 Prefetch Limit: 100
2025-04-11 22:44:30,726 - src.core.query_system.query_engine - INFO - Process memory - RSS: 1.34 GB, VMS: 37.55 GB
2025-04-11 22:44:30,763 - src.core.query_system.query_engine - INFO - GPU memory - Allocated: 0.00 GB, Reserved: 0.00 GB, Total: 8.00 GB
2025-04-11 22:44:30,764 - src.core.query_system.query_engine - INFO - Loading chat tokenizer for LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 22:44:31,323 - src.core.query_system.query_engine - INFO - Chat tokenizer for Qwen/Qwen2.5-3B-Instruct loaded successfully.
2025-04-11 22:44:31,326 - __main__ - INFO - QueryEngine created, using default LLM: Qwen/Qwen2.5-3B-Instruct
2025-04-11 22:44:36,022 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:44:36,090 - __main__ - INFO - Clearing all indexed and extracted data...
2025-04-11 22:44:36,217 - src.core.query_system.query_engine - WARNING - Qdrant collection 'anticorruption_rag_e5_instruct' does not exist, skipping deletion.
2025-04-11 22:44:36,221 - src.core.query_system.query_engine - INFO - BM25 index file deleted: /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 22:44:36,225 - src.core.query_system.query_engine - INFO - Stopwords file deleted: /home/t/lm_rag/data/bm25/stopwords.pkl
2025-04-11 22:44:36,230 - src.core.query_system.query_engine - INFO - Entities file deleted: /home/t/lm_rag/data/extracted/entities.json
2025-04-11 22:44:36,233 - src.core.query_system.query_engine - INFO - Relationships file deleted: /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 22:44:36,236 - __main__ - INFO - Data clearing successful.
2025-04-11 22:44:36,298 - __main__ - INFO - Collection info after clearing: {'exists': False}
2025-04-11 22:44:36,700 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:44:41,532 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:44:42,889 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:44:43,334 - __main__ - INFO - Multiprocessing start method already set to 'spawn'.
2025-04-11 22:44:43,390 - __main__ - INFO - Storing selected LLM for session: Qwen/Qwen2.5-7B-Instruct
2025-04-11 22:44:43,393 - __main__ - INFO - Starting document processing for 1 files
2025-04-11 22:44:43,395 - __main__ - INFO - Starting document processing with spreadsheet options. Files: ['Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf']
2025-04-11 22:44:43,397 - __main__ - INFO - Starting Aphrodite service for document processing
2025-04-11 22:44:56,431 - __main__ - INFO - Aphrodite service started successfully
2025-04-11 22:44:56,432 - __main__ - INFO - Saved Aphrodite process info: PID=15588
2025-04-11 22:44:56,433 - src.core.document_processing.document_loader - INFO - Initializing DocumentLoader
2025-04-11 22:44:56,434 - src.core.document_processing.document_loader - INFO - Configuring Docling: Artifacts Path='None', Device='AcceleratorDevice.AUTO', Threads=-1
2025-04-11 22:44:56,440 - src.core.document_processing.document_loader - INFO - Docling DocumentConverter initialized successfully.
2025-04-11 22:44:56,445 - __main__ - INFO - Loading regular document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 22:44:56,446 - src.core.document_processing.document_loader - INFO - Loading document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (Type: .pdf)
2025-04-11 22:44:56,447 - src.core.document_processing.document_loader - INFO - Processing with Docling: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 22:44:56,448 - src.core.document_processing.document_loader - INFO - Starting Docling conversion for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf...
2025-04-11 22:47:14,317 - src.core.document_processing.document_loader - INFO - Exporting Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf content to Markdown...
2025-04-11 22:47:43,709 - src.core.document_processing.document_loader - INFO - Docling processing successful for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf. Word count: 94174, Page count: 246
2025-04-11 22:47:43,813 - __main__ - INFO - Document loaded: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf, Content items: 1
2025-04-11 22:47:43,815 - __main__ - INFO - All documents loaded. Shutting down document loader (Docling) to free resources...
2025-04-11 22:47:43,816 - src.core.document_processing.document_loader - INFO - ===== SHUTTING DOWN DocumentLoader and Unloading Docling Models =====
2025-04-11 22:47:43,817 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.72 GB, VMS: 40.69 GB
2025-04-11 22:47:43,818 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.46 GB, Reserved: 0.76 GB, Total: 8.00 GB
2025-04-11 22:47:43,819 - src.core.document_processing.document_loader - INFO - Unloading Docling DocumentConverter instance...
2025-04-11 22:47:43,822 - src.core.document_processing.document_loader - INFO - Docling converter reference removed.
2025-04-11 22:47:43,823 - src.core.document_processing.document_loader - INFO - Running garbage collection...
2025-04-11 22:47:44,237 - src.core.document_processing.document_loader - INFO - Garbage collection finished.
2025-04-11 22:47:44,238 - src.core.document_processing.document_loader - INFO - CUDA is available. Clearing PyTorch CUDA cache...
2025-04-11 22:47:44,262 - src.core.document_processing.document_loader - INFO - PyTorch CUDA cache cleared.
2025-04-11 22:47:44,263 - src.core.document_processing.document_loader - INFO - Docling models should now be unloaded from memory.
2025-04-11 22:47:44,264 - src.core.document_processing.document_loader - INFO - Process memory - RSS: 2.67 GB, VMS: 40.64 GB
2025-04-11 22:47:44,265 - src.core.document_processing.document_loader - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 22:47:44,266 - src.core.document_processing.document_loader - INFO - DocumentLoader shutdown complete.
2025-04-11 22:47:44,642 - __main__ - INFO - Document loader shut down complete.
2025-04-11 22:47:44,644 - __main__ - INFO - Process memory - RSS: 2.67 GB, VMS: 40.64 GB
2025-04-11 22:47:44,645 - __main__ - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 22:47:44,646 - src.core.document_processing.document_chunker - INFO - Initializing DocumentChunker with chunk_size=512, chunk_overlap=100, embedding_model=intfloat/multilingual-e5-small, semantic_threshold=95
2025-04-11 22:47:44,648 - src.core.document_processing.document_chunker - INFO - Markdown headers to split on: [('#', 'header_1'), ('##', 'header_2'), ('###', 'header_3'), ('####', 'header_4'), ('#####', 'header_5'), ('######', 'header_6')]
2025-04-11 22:47:44,649 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.67 GB, VMS: 40.64 GB
2025-04-11 22:47:44,650 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.02 GB, Total: 8.00 GB
2025-04-11 22:47:44,651 - __main__ - INFO - Loading chunking model...
2025-04-11 22:47:44,652 - src.core.document_processing.document_chunker - INFO - ===== LOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 22:47:44,653 - src.core.document_processing.document_chunker - INFO - Loading embedding model for semantic chunking: intfloat/multilingual-e5-small...
2025-04-11 22:47:44,654 - src.core.document_processing.document_chunker - INFO - Using Hugging Face cache directory: /home/t/.cache/huggingface
2025-04-11 22:47:44,655 - src.core.document_processing.document_chunker - INFO - Using Transformers cache directory: /home/t/.cache/huggingface/hub
2025-04-11 22:47:44,656 - src.core.document_processing.document_chunker - INFO - Using device: cuda
2025-04-11 22:47:49,046 - src.core.document_processing.document_chunker - INFO - Test embedding generated successfully.
2025-04-11 22:47:49,048 - src.core.document_processing.document_chunker - INFO - Semantic chunking embedding model loaded successfully in 4.39 seconds
2025-04-11 22:47:49,049 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.81 GB, VMS: 41.93 GB
2025-04-11 22:47:49,050 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 22:47:49,051 - __main__ - INFO - Chunking document 1/1: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 22:47:49,052 - src.core.document_processing.document_chunker - INFO - Starting chunking for document: Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf (ID: 3928b8bf-3114-4644-a80a-5070d7965c8f, Type: .pdf)
2025-04-11 22:47:49,053 - src.core.document_processing.document_chunker - INFO - Processing 1 content item(s) for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf.
2025-04-11 22:47:49,055 - src.core.document_processing.document_chunker - INFO - Processing content item 1/1 (length: 608866 chars) using Markdown Header + Semantic chunking.
2025-04-11 22:47:49,076 - src.core.document_processing.document_chunker - INFO - MarkdownHeaderTextSplitter created 244 initial structural chunks.
2025-04-11 22:47:56,463 - src.core.document_processing.document_chunker - INFO - Markdown header + semantic splitting resulted in 502 potential chunks.
2025-04-11 22:47:56,464 - src.core.document_processing.document_chunker - WARNING - Chunk (length 8299) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,466 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 22:47:56,467 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6564) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,468 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 22:47:56,469 - src.core.document_processing.document_chunker - WARNING - Chunk (length 6017) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,471 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 22:47:56,472 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5972) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,474 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 18 basic chunks.
2025-04-11 22:47:56,475 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7518) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,476 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 21 basic chunks.
2025-04-11 22:47:56,477 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7098) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,478 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 22 basic chunks.
2025-04-11 22:47:56,478 - src.core.document_processing.document_chunker - WARNING - Chunk (length 7084) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,479 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 19 basic chunks.
2025-04-11 22:47:56,480 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5166) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,483 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 15 basic chunks.
2025-04-11 22:47:56,484 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5469) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,485 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 14 basic chunks.
2025-04-11 22:47:56,486 - src.core.document_processing.document_chunker - WARNING - Chunk (length 5139) still exceeds size limit (5120) after semantic split. Applying basic chunking fallback.
2025-04-11 22:47:56,487 - src.core.document_processing.document_chunker - INFO - RecursiveCharacterTextSplitter created 13 basic chunks.
2025-04-11 22:47:56,487 - src.core.document_processing.document_chunker - INFO - Applied basic chunking fallback to 10 oversized chunks.
2025-04-11 22:47:56,488 - src.core.document_processing.document_chunker - INFO - Final processing created 672 chunks from text of length 608866.
2025-04-11 22:47:56,492 - src.core.document_processing.document_chunker - INFO - Chunking for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf completed in 7.44s.
2025-04-11 22:47:56,493 - src.core.document_processing.document_chunker - INFO - Created 672 total chunks: 0 spreadsheet rows, 492 semantic chunks, 0 sentence fallback chunks, 180 basic fallback chunks.
2025-04-11 22:47:56,494 - src.core.document_processing.document_chunker - INFO - Average chunk size: 881.6 characters.
2025-04-11 22:47:56,494 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.82 GB, VMS: 41.92 GB
2025-04-11 22:47:56,496 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.45 GB, Reserved: 0.97 GB, Total: 8.00 GB
2025-04-11 22:47:56,497 - __main__ - INFO - Created 672 chunks for Witness_Statement_of_Nicola_Bartlett_dated_12_June_2023.pdf
2025-04-11 22:47:56,498 - __main__ - INFO - Shutting down chunking model...
2025-04-11 22:47:56,498 - src.core.document_processing.document_chunker - INFO - ===== UNLOADING SEMANTIC CHUNKING MODEL =====
2025-04-11 22:47:56,499 - src.core.document_processing.document_chunker - INFO - Model was on device: cuda
2025-04-11 22:47:56,500 - src.core.document_processing.document_chunker - INFO - Deleting model reference...
2025-04-11 22:47:56,501 - src.core.document_processing.document_chunker - INFO - Clearing CUDA cache...
2025-04-11 22:47:56,507 - src.core.document_processing.document_chunker - INFO - Running garbage collection...
2025-04-11 22:47:57,072 - src.core.document_processing.document_chunker - INFO - Semantic chunking model unloaded.
2025-04-11 22:47:57,075 - src.core.document_processing.document_chunker - INFO - Process memory - RSS: 2.82 GB, VMS: 41.92 GB
2025-04-11 22:47:57,076 - src.core.document_processing.document_chunker - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 22:47:57,077 - __main__ - INFO - Total chunks generated: 672
2025-04-11 22:47:57,078 - __main__ - INFO - Creating entity extractor with model Qwen/Qwen2.5-7B-Instruct
2025-04-11 22:47:57,079 - src.core.extraction.entity_extractor - INFO - Initialized EntityExtractor with model=Qwen/Qwen2.5-7B-Instruct, debug=True, using advanced deduplication.
2025-04-11 22:47:57,080 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.82 GB, VMS: 41.92 GB
2025-04-11 22:47:57,081 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 22:47:57,082 - __main__ - INFO - Starting entity extraction on 672 chunks (0 visual chunks)
2025-04-11 22:47:57,083 - src.core.extraction.entity_extractor - INFO - Adding 672 chunks for batch processing (0 spreadsheet rows, 0 visual)
2025-04-11 22:47:57,084 - src.core.extraction.entity_extractor - INFO - Added 672 chunks to queue. Processing now.
2025-04-11 22:47:57,085 - src.core.extraction.entity_extractor - INFO - Processing all 672 chunks...
2025-04-11 22:47:57,086 - src.core.extraction.entity_extractor - INFO - Process memory - RSS: 2.82 GB, VMS: 41.92 GB
2025-04-11 22:47:57,087 - src.core.extraction.entity_extractor - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 22:47:57,089 - src.core.extraction.entity_extractor - INFO - Loading designated extraction model: Qwen/Qwen2.5-7B-Instruct
2025-04-11 22:52:15,451 - src.core.extraction.entity_extractor - INFO - Model Qwen/Qwen2.5-7B-Instruct loaded successfully for extraction.
2025-04-11 22:52:15,457 - src.core.extraction.entity_extractor - INFO - Processing 672 chunks (0 spreadsheet rows)
2025-04-11 22:52:15,459 - src.core.extraction.entity_extractor - INFO - Processing in 1 batches of size 1024
2025-04-11 22:52:15,460 - src.core.extraction.entity_extractor - INFO - Processing batch 1/1 (672 chunks)
2025-04-11 22:52:15,494 - src.core.extraction.entity_extractor - INFO - Sending batch of 672 prompts to service
2025-04-11 23:27:54,514 - src.core.extraction.entity_extractor - INFO - Received response from service
2025-04-11 23:27:54,540 - src.core.extraction.entity_extractor - INFO - Service request/response took 2139.04s
2025-04-11 23:27:54,575 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk b3f96735-c370-4d60-a020-15d60a9879d5: from_entity_type='LOCATION' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='UK' to_entity_type='LOCATION'
2025-04-11 23:27:54,578 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk b3f96735-c370-4d60-a020-15d60a9879d5: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='indefinite leave to remain' to_entity_type='ASSET'
2025-04-11 23:27:54,580 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk b3f96735-c370-4d60-a020-15d60a9879d5: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='June 2015' to_entity_type='ASSET'
2025-04-11 23:27:54,584 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 876123c5-e6b5-4a98-b47a-b36acac465bb: Unterminated string starting at: line 1 column 7120 (char 7119). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "NCA", ...'
2025-04-11 23:27:54,588 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ddb35fdc-4d7d-4b32-9fc8-e7a6e2fb7662: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,590 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ddb35fdc-4d7d-4b32-9fc8-e7a6e2fb7662: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='judge' to_entity_type='POSITION'
2025-04-11 23:27:54,591 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ddb35fdc-4d7d-4b32-9fc8-e7a6e2fb7662: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='PFO' to_entity_type='ASSET'
2025-04-11 23:27:54,593 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ddb35fdc-4d7d-4b32-9fc8-e7a6e2fb7662: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Disclosure Order' to_entity_type='ASSET'
2025-04-11 23:27:54,594 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk ddb35fdc-4d7d-4b32-9fc8-e7a6e2fb7662: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='financial institutions, law firms and other relevant third parties' to_entity_type='LOCATION'
2025-04-11 23:27:54,597 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 1741573c-381d-4505-8e15-2866cdd3d835: Unterminated string starting at: line 1 column 8084 (char 8083). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "...'
2025-04-11 23:27:54,599 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk f650e878-efdb-4c56-85b2-f0d1a53ed66e: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,601 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk f650e878-efdb-4c56-85b2-f0d1a53ed66e: from_entity_type='ASSET' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,602 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5062b8e5-75c5-4990-9e03-74bfa21ab7cd: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type='LOCATED_IN' relationship_description='Used to hold bank accounts' to_entity_name='a number of jurisdictions' to_entity_type='LOCATION'
2025-04-11 23:27:54,608 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 45f888fb-3ece-4bb5-8638-d44c189b59b2: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,612 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c47fe82c-2dfb-4ec9-989f-d013f3d49ba1: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='income' to_entity_type='ASSET'
2025-04-11 23:27:54,615 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 6e4e2e1c-e2ac-4e7e-a513-488f1dd5bdf8: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='the KB Companies presentation' to_entity_type='ASSET'
2025-04-11 23:27:54,619 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk b5705244-fdcd-4cb2-93f6-acdc8aa82080: Unterminated string starting at: line 1 column 7502 (char 7501). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mr Bashirov", "...'
2025-04-11 23:27:54,623 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 043903f5-8fc6-49b4-b8c3-e7c45a54250d: Expecting value: line 1 column 7360 (char 7359). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "My clients", "r...'
2025-04-11 23:27:54,627 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 30fc67e6-d154-474b-8990-3fc96f7cdaf3: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Azerbaijan' to_entity_type='LOCATION'
2025-04-11 23:27:54,631 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 822546cc-efac-41fe-b9e1-365dc8043f96: Unterminated string starting at: line 1 column 8137 (char 8136). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "NCA", ...'
2025-04-11 23:27:54,632 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk fd4abdec-22ea-4930-9fbf-bf4f7fc79ca2: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,634 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk fd4abdec-22ea-4930-9fbf-bf4f7fc79ca2: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,636 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 70b3c98a-e62e-4fa7-953a-24841c7750aa: Expecting ',' delimiter: line 1 column 7736 (char 7735). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mr Bashirov", "...'
2025-04-11 23:27:54,637 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4b6a8649-7677-4785-8427-99366af934fd: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,641 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 34faa3c8-10a7-43d3-a477-b67419f48394: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description='correspond to the dates and amounts of promissory notes and loan agreements' to_entity_name='promissory notes and loan agreements' to_entity_type='ASSET'
2025-04-11 23:27:54,649 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e201173d-851a-4678-8f92-649da2ee622c: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,655 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a95dbefb-b6f8-407b-8e4f-e5e726162e39: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,657 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a95dbefb-b6f8-407b-8e4f-e5e726162e39: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,659 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 7e957d9b-c079-4c9d-83d3-dcb2a05b200b: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,662 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk d3754b09-24d7-49aa-b5a5-f4c6dab1ec86: Unterminated string starting at: line 1 column 8084 (char 8083). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "...'
2025-04-11 23:27:54,666 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk dc303e70-2e06-4b9f-9104-c854447ebcce: Unterminated string starting at: line 1 column 7728 (char 7727). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "OCCRP"...'
2025-04-11 23:27:54,669 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 4479a5c2-6091-475c-bc52-909a2efb2076: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='OCCRP' to_entity_type='NGO'
2025-04-11 23:27:54,673 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 8b060f29-82c3-42d4-afd0-18247bf96de5: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,677 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e9c41b64-973f-4f8f-bbd3-6401c9a12047: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,678 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e9c41b64-973f-4f8f-bbd3-6401c9a12047: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,680 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk f3dde785-5510-4721-8089-d43431ca09e2: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,681 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk f3dde785-5510-4721-8089-d43431ca09e2: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,686 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk b2782688-cc37-4abe-a455-7164c21fd110: Unterminated string starting at: line 1 column 8193 (char 8192). Content: '{"entity_relationship_list": [{"from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "rel...'
2025-04-11 23:27:54,687 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 7053d48a-e842-4ada-84cf-37a4d79f6c1c: Expecting property name enclosed in double quotes: line 1 column 7882 (char 7881). Content: '{ "entity_relationship_list": [ { "from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "GBP 6,...'
2025-04-11 23:27:54,690 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c88d398f-3440-47ac-a67a-c3bcd5651b0e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='FATF' to_entity_type='GOVERNMENT_BODY'
2025-04-11 23:27:54,692 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c88d398f-3440-47ac-a67a-c3bcd5651b0e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='OECD' to_entity_type='GOVERNMENT_BODY'
2025-04-11 23:27:54,693 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c88d398f-3440-47ac-a67a-c3bcd5651b0e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='NCA' to_entity_type='GOVERNMENT_BODY'
2025-04-11 23:27:54,694 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c88d398f-3440-47ac-a67a-c3bcd5651b0e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Companies House' to_entity_type='GOVERNMENT_BODY'
2025-04-11 23:27:54,696 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk df2d8669-c790-4c06-a802-ae569047539b: Unterminated string starting at: line 1 column 7636 (char 7635). Content: '{ "entity_relationship_list": [ { "from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "USD 5,...'
2025-04-11 23:27:54,701 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2b76f0f8-5fae-4e5f-8a3b-a7abae18a8ae: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='loan' to_entity_type='MONEY'
2025-04-11 23:27:54,704 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk cf2b9a88-52e6-4e2f-8064-853a3869d655: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,708 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 52dd9f6b-0758-440f-a6a8-3091b0b6794f: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,710 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 02cf7136-77a8-403a-9ca7-f1f6c59abfc5: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,712 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 88739695-6119-45f3-b35c-019a34b02099: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,715 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 63ee0269-0d82-413f-8fb4-356cc1a2baa1: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='DH Leasing' to_entity_type='COMMERCIAL_COMPANY'
2025-04-11 23:27:54,716 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk f0d667da-83e0-4214-936f-57c023b1dda3: Unterminated string starting at: line 1 column 8160 (char 8159). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mr Bashirov", "...'
2025-04-11 23:27:54,719 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2e7a02bc-fced-4dfa-ae2c-ed6b7ce7fbe7: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Isle of Man' to_entity_type='LOCATION'
2025-04-11 23:27:54,723 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk b238e064-c24a-4b4a-aa92-01833cdd8c84: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='IBA-Moscow' to_entity_type='COMMERCIAL_COMPANY'
2025-04-11 23:27:54,725 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk b238e064-c24a-4b4a-aa92-01833cdd8c84: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='transactions' to_entity_type='ASSET'
2025-04-11 23:27:54,729 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk e1dda523-608f-493b-98ea-98aa6f014a71: Expecting value: line 1 column 7655 (char 7654). Content: '{ "entity_relationship_list": [ { "from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "EUR 2,...'
2025-04-11 23:27:54,731 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 6f9ce7cd-07e0-450e-9271-7320a67c8023: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type='WORKS_FOR' relationship_description='Regulated firms were required to carry out due diligence' to_entity_name='regulated firms' to_entity_type='COMMERCIAL_COMPANY'
2025-04-11 23:27:54,733 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 6f9ce7cd-07e0-450e-9271-7320a67c8023: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description='Source of funds and source of wealth' to_entity_name='Mr Hajiyev' to_entity_type='PERSON'
2025-04-11 23:27:54,734 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 6f9ce7cd-07e0-450e-9271-7320a67c8023: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description='Income' to_entity_name='Mr Hajiyev' to_entity_type='PERSON'
2025-04-11 23:27:54,735 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk c80b2845-cac1-4a9c-86ee-e6edd3cef2a0: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type='WORKS_FOR' relationship_description='Employed' to_entity_name='Tab C1' to_entity_type='LOCATION'
2025-04-11 23:27:54,741 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 65ba8af0-9369-4363-9b99-0c36311dca61: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,746 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk b8230209-7e3a-4e96-a4f7-f68be3fcf7ab: Expecting ',' delimiter: line 1 column 7614 (char 7613). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 23:27:54,747 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 182a7e47-c02d-44ca-9df1-79e38774155c: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,749 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 0a243a6f-efa6-4c7b-b9dc-29a0087a08cb: Unterminated string starting at: line 1 column 7527 (char 7526). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 23:27:54,751 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk bd03aa2b-ab4f-404b-92af-f63e7a5304ce: Unterminated string starting at: line 1 column 7146 (char 7145). Content: '{ "entity_relationship_list": [ { "from_entity_type": "COMMERCIAL_COMPANY", "from_entity_name": "Glo...'
2025-04-11 23:27:54,754 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='Tea Construction' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,757 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='Eroil' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,758 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='Mea Oil' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,759 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='TPD Trading Petrol and Drilling' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,760 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='Tiara' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,761 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='Migao Corporation' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,762 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da98d4da-b2cc-4b02-880f-ffe7b5441697: from_entity_type=None from_entity_name='Anglo Asian Mining Plc' relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,765 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk f9367cdc-09c5-439d-84f6-3ca89c8b8cc6: Unterminated string starting at: line 1 column 6734 (char 6733). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 23:27:54,768 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 5908d3bf-df56-4178-8aff-a017b4f25f5d: Unterminated string starting at: line 1 column 8328 (char 8327). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Mrs Hajiyeva", ...'
2025-04-11 23:27:54,770 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk b5504ea3-4e65-4bdb-9373-1765bb008712: Unterminated string starting at: line 1 column 7445 (char 7444). Content: '{"entity_relationship_list": [{"from_entity_type": "ASSET", "from_entity_name": "7.9 12-14 Walton St...'
2025-04-11 23:27:54,771 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2f2c3745-2602-4070-aaf0-a74f49fd4a85: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='BVI' to_entity_type='LOCATION'
2025-04-11 23:27:54,774 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 33e82fb2-a771-414b-828c-f85991af664e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,776 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 33e82fb2-a771-414b-828c-f85991af664e: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,778 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk f701da6b-9d9a-42b8-a689-80a4b109e96a: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,780 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk d8279f62-7f84-48e1-9de3-d68cf04ad291: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Azerbaijan' to_entity_type='LOCATION'
2025-04-11 23:27:54,786 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk db731c50-62db-435f-b615-24d80ec6d1f0: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,794 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2ebf6bd8-c691-42d1-9e32-72a809fd11cc: from_entity_type='PERSON' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,796 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 2ebf6bd8-c691-42d1-9e32-72a809fd11cc: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,798 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk d76afff5-f270-4de7-a012-17c2f2becb45: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,800 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk d76afff5-f270-4de7-a012-17c2f2becb45: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,801 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5a6eb2af-ddc7-48bc-a1a3-68e4d2f8cba7: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,803 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 1274ddd3-5298-45c4-b272-63153d549101: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,805 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 54abb58b-c2f0-470c-97ae-d01854d7e4a3: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,809 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk cdf647ec-3ac0-46a9-9318-c1669a5d9803: Unterminated string starting at: line 1 column 8004 (char 8003). Content: '{"entity_relationship_list": [{"from_entity_type": "LOCATION", "from_entity_name": "Guernsey", "rela...'
2025-04-11 23:27:54,812 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 413cc5e4-21b0-48c3-bc44-a2681a12da7c: Unterminated string starting at: line 1 column 7469 (char 7468). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": null, "...'
2025-04-11 23:27:54,813 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk b2d5a639-614f-4d58-ae1a-67120f13c46e: Unterminated string starting at: line 1 column 7134 (char 7133). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Ms Mateos", "re...'
2025-04-11 23:27:54,815 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk d14ca58d-29eb-42e5-b277-34e3d3371c27: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,816 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk d14ca58d-29eb-42e5-b277-34e3d3371c27: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,817 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 29a93931-59d9-4ca3-ae31-2c75cc22ef63: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,819 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 29a93931-59d9-4ca3-ae31-2c75cc22ef63: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,820 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 70e1a6ae-e998-40cd-8ff9-f3a350dfe171: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,821 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 70e1a6ae-e998-40cd-8ff9-f3a350dfe171: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,822 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 7b0b5cd4-1ce6-48fa-b4c0-0ba6d2d849f8: Unterminated string starting at: line 1 column 7803 (char 7802). Content: '{ "entity_relationship_list": [ { "from_entity_type": "PERSON", "from_entity_name": "Ms Georgiou", "...'
2025-04-11 23:27:54,824 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 7ef487df-9b7f-45ce-83fd-ebf0e9611c1f: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,825 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 7ef487df-9b7f-45ce-83fd-ebf0e9611c1f: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='Mill Ride Golf Club' to_entity_type='ASSET'
2025-04-11 23:27:54,826 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 7ef487df-9b7f-45ce-83fd-ebf0e9611c1f: from_entity_type='COMMERCIAL_COMPANY' from_entity_name=None relationship_type='LOCATED_IN' relationship_description='Offshore trust structure' to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,827 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 1d678511-fc4b-48d0-81fc-e9451da3cbac: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,829 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a4e4534d-6689-4e59-89de-6b38da0aac81: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,831 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a4e4534d-6689-4e59-89de-6b38da0aac81: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,832 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 828e6085-1a42-49f0-b5bb-f7bf1f47c0c3: Unterminated string starting at: line 1 column 6271 (char 6270). Content: '{"entity_relationship_list": [{"from_entity_type": "MONETARY_AMOUNT", "from_entity_name": "GBP 620,0...'
2025-04-11 23:27:54,834 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk f404ce1b-1322-46d1-86fa-c466459d269c: Expecting value: line 1 column 7868 (char 7867). Content: '{"entity_relationship_list": [{"from_entity_type": "COMMERCIAL_COMPANY", "from_entity_name": "Semfra...'
2025-04-11 23:27:54,836 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk a43d9463-a5ba-4c5b-8c7b-84db1ebee510: from_entity_type='MONETARY_AMOUNT' from_entity_name=None relationship_type=None relationship_description=None to_entity_name='account number LU190023192776665200' to_entity_type='ASSET'
2025-04-11 23:27:54,838 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5481e564-4966-43c9-a330-c740f8658038: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,839 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk 5481e564-4966-43c9-a330-c740f8658038: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,849 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da2b8293-7499-4b01-89e2-9879853491d6: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,851 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk da2b8293-7499-4b01-89e2-9879853491d6: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,860 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e9f2df0b-a39c-4af6-abe1-7c2b553e7a3c: from_entity_type='NGO' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,864 - src.core.extraction.entity_extractor - WARNING - Skipping item with missing from_entity details in chunk e9f2df0b-a39c-4af6-abe1-7c2b553e7a3c: from_entity_type='GOVERNMENT_BODY' from_entity_name=None relationship_type=None relationship_description=None to_entity_name=None to_entity_type=None
2025-04-11 23:27:54,866 - src.core.extraction.entity_extractor - WARNING - Error parsing result for chunk 97a2d527-7bdf-457e-aec6-3b0335554469: Unterminated string starting at: line 1 column 7459 (char 7458). Content: '{ "entity_relationship_list": [ { "from_entity_type": "GOVERNMENT_BODY", "from_entity_name": "NCA", ...'
2025-04-11 23:27:54,868 - src.core.extraction.entity_extractor - INFO - Processed batch results in 0.33s. Total batch time: 2139.41s
2025-04-11 23:27:54,868 - src.core.extraction.entity_extractor - INFO - Batch Stats: Success=646, Parse Errors=26, Missing Outputs=0
2025-04-11 23:27:54,898 - src.core.extraction.entity_extractor - INFO - All batch processing completed in 2139.44s
2025-04-11 23:27:54,909 - src.core.extraction.entity_extractor - INFO - Starting final processing and saving...
2025-04-11 23:27:54,910 - src.core.extraction.entity_extractor - INFO - Raw counts before deduplication: 4700 entities, 1345 relationships.
2025-04-11 23:27:54,911 - src.core.extraction.entity_extractor - INFO - Running enhanced entity deduplication...
2025-04-11 23:27:54,912 - src.core.extraction.entity_extractor - INFO - Starting enhanced entity deduplication on 4700 raw entities...
2025-04-11 23:27:55,012 - src.core.extraction.entity_extractor - INFO - Normalizing entity names...
2025-04-11 23:27:55,137 - src.core.extraction.entity_extractor - WARNING - Removed 16 entities with empty normalized names.
2025-04-11 23:27:55,139 - src.core.extraction.entity_extractor - INFO - Generating candidate pairs using blocking...
2025-04-11 23:27:55,676 - src.core.extraction.entity_extractor - INFO - Generated 171254 candidate pairs across all types.
2025-04-11 23:27:55,677 - src.core.extraction.entity_extractor - INFO - Comparing candidate pairs...
2025-04-11 23:28:11,355 - src.core.extraction.entity_extractor - INFO - Found 142009 potential duplicate pairs after comparison.
2025-04-11 23:28:11,357 - src.core.extraction.entity_extractor - INFO - Clustering duplicate pairs...
2025-04-11 23:28:16,588 - src.core.extraction.entity_extractor - INFO - Found 1356 clusters (including singletons).
2025-04-11 23:28:16,589 - src.core.extraction.entity_extractor - INFO - Choosing canonical entities and merging context...
2025-04-11 23:28:16,769 - src.core.extraction.entity_extractor - INFO - Enhanced entity deduplication complete. Final entity count: 1356.
2025-04-11 23:28:16,798 - src.core.extraction.entity_extractor - INFO - Updating relationship IDs based on entity deduplication map...
2025-04-11 23:28:16,800 - src.core.extraction.entity_extractor - INFO - Updating 1345 raw relationships with canonical entity IDs...
2025-04-11 23:28:16,802 - src.core.extraction.entity_extractor - INFO - Relationship ID update complete. Kept 1322, Updated IDs in 1247, Skipped 23 (self-loops or missing mappings).
2025-04-11 23:28:16,803 - src.core.extraction.entity_extractor - INFO - Running relationship deduplication...
2025-04-11 23:28:16,803 - src.core.extraction.entity_extractor - INFO - Starting relationship deduplication...
2025-04-11 23:28:16,805 - src.core.extraction.entity_extractor - INFO - Relationship deduplication complete. Removed 119 duplicates. Final count: 1203.
2025-04-11 23:28:16,805 - src.core.extraction.entity_extractor - INFO - Final counts after deduplication: 1356 entities, 1203 relationships.
2025-04-11 23:28:16,837 - src.core.extraction.entity_extractor - INFO - Saved 1356 deduplicated entities to /home/t/lm_rag/data/extracted/entities.json
2025-04-11 23:28:16,853 - src.core.extraction.entity_extractor - INFO - Saved 1203 deduplicated relationships to /home/t/lm_rag/data/extracted/relationships.json
2025-04-11 23:28:16,855 - __main__ - INFO - Entity extraction complete. Modified chunks: 672
2025-04-11 23:28:17,105 - __main__ - INFO - QueryEngine LLM model updated to: Qwen/Qwen2.5-7B-Instruct
2025-04-11 23:28:17,109 - src.core.indexing.document_indexer - INFO - Initializing DocumentIndexer:
2025-04-11 23:28:17,111 - src.core.indexing.document_indexer - INFO -   - Embedding Model: BAAI/bge-m3 (BGE-M3 Mode)
2025-04-11 23:28:17,112 - src.core.indexing.document_indexer - INFO -   - Qdrant: localhost:6333, Collection: anticorruption_rag_e5_instruct
2025-04-11 23:28:17,113 - src.core.indexing.document_indexer - INFO -   - Expected Vector Size: 1024
2025-04-11 23:28:17,113 - src.core.indexing.document_indexer - INFO -   - Debug Mode: False
2025-04-11 23:28:17,119 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 3.03 GB, VMS: 41.92 GB
2025-04-11 23:28:17,124 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 23:28:17,125 - __main__ - INFO - Loading indexing model...
2025-04-11 23:28:17,126 - src.core.indexing.document_indexer - INFO - ===== LOADING EMBEDDING MODEL: BAAI/bge-m3 =====
2025-04-11 23:28:17,127 - src.core.indexing.document_indexer - INFO - Using device: cuda
2025-04-11 23:28:19,672 - src.core.indexing.document_indexer - INFO - Loaded BGE-M3 model using FlagEmbedding.
2025-04-11 23:28:19,674 - src.core.indexing.document_indexer - INFO - Embedding model loaded in 2.55 seconds
2025-04-11 23:28:19,675 - src.core.indexing.document_indexer - INFO - Process memory - RSS: 3.06 GB, VMS: 44.04 GB
2025-04-11 23:28:19,677 - src.core.indexing.document_indexer - INFO - GPU memory - Allocated: 0.01 GB, Reserved: 0.47 GB, Total: 8.00 GB
2025-04-11 23:28:19,731 - __main__ - INFO - Indexing 672 chunks
2025-04-11 23:28:19,732 - src.core.indexing.document_indexer - INFO - Starting indexing process for 672 chunks...
2025-04-11 23:28:19,733 - src.core.indexing.document_indexer - INFO - Embedding model (BAAI/bge-m3) already loaded.
2025-04-11 23:28:19,734 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to BM25
2025-04-11 23:28:19,750 - src.core.indexing.document_indexer - INFO - Tokenizing enhanced texts for BM25...
2025-04-11 23:28:20,201 - src.core.indexing.document_indexer - INFO - Creating BM25 index...
2025-04-11 23:28:20,217 - src.core.indexing.document_indexer - INFO - Saving BM25 index and metadata to /home/t/lm_rag/data/bm25/index.pkl
2025-04-11 23:28:20,240 - src.core.indexing.document_indexer - INFO - BM25 index saved successfully (672 documents).
2025-04-11 23:28:20,244 - src.core.indexing.document_indexer - INFO - Indexing 672 chunks to Qdrant collection 'anticorruption_rag_e5_instruct'...
2025-04-11 23:28:20,302 - src.core.indexing.document_indexer - INFO - Creating collection 'anticorruption_rag_e5_instruct'...
2025-04-11 23:28:20,765 - src.core.indexing.document_indexer - INFO - Collection created successfully.
2025-04-11 23:28:20,766 - src.core.indexing.document_indexer - INFO - Generating embeddings for chunks...
2025-04-11 23:28:20,768 - src.core.indexing.document_indexer - INFO - Generating BGE-M3 embeddings for 672 texts (dense, sparse, colbert)...
2025-04-11 23:28:37,014 - src.core.indexing.document_indexer - INFO - BGE-M3 embeddings generated.
2025-04-11 23:28:37,025 - src.core.indexing.document_indexer - INFO - Embeddings generated in 16.26s
2025-04-11 23:28:37,026 - src.core.indexing.document_indexer - INFO - Preparing points for Qdrant upsert...
